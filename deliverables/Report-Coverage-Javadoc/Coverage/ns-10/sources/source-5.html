


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > GuiBoardController</title>
  <style type="text/css">
    @import "../../.css/coverage.css";
    @import "../../.css/highlight-idea.css";
  </style>
  <script type="text/javascript" src="../../.js/highlight.pack.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">it.polimi.ingsw.View.User</a>
</div>

<h1>Coverage Summary for Class: GuiBoardController (it.polimi.ingsw.View.User)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">GuiBoardController</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/56)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/979)
  </span>
</td>
</tr>
  <tr>
    <td class="name">GuiBoardController$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GuiBoardController$10</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/33)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GuiBoardController$11</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/34)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GuiBoardController$12</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/35)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GuiBoardController$13</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GuiBoardController$14</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/20)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GuiBoardController$15</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GuiBoardController$16</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/20)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GuiBoardController$17</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/13)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GuiBoardController$18</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/13)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GuiBoardController$19</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/13)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GuiBoardController$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GuiBoardController$20</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/13)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GuiBoardController$21</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/13)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GuiBoardController$22</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/13)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GuiBoardController$23</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GuiBoardController$24</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GuiBoardController$25</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GuiBoardController$26</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GuiBoardController$27</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GuiBoardController$3</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/9)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GuiBoardController$4</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/9)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GuiBoardController$5</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/8)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GuiBoardController$6</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/8)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GuiBoardController$7</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GuiBoardController$8</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GuiBoardController$9</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/110)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1318)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<div class="sourceCode" id="sourceCode"><i class="no-highlight">1</i>&nbsp;package it.polimi.ingsw.View.User;
<i class="no-highlight">2</i>&nbsp;
<i class="no-highlight">3</i>&nbsp;import it.polimi.ingsw.Controller.Actions.*;
<i class="no-highlight">4</i>&nbsp;import it.polimi.ingsw.Model.Enums.GameType;
<i class="no-highlight">5</i>&nbsp;import it.polimi.ingsw.Model.Enums.LeaderCardAction;
<i class="no-highlight">6</i>&nbsp;import it.polimi.ingsw.Model.Enums.ResourceType;
<i class="no-highlight">7</i>&nbsp;import it.polimi.ingsw.Model.Exceptions.ModelException;
<i class="no-highlight">8</i>&nbsp;import it.polimi.ingsw.View.Client.Client;
<i class="no-highlight">9</i>&nbsp;import it.polimi.ingsw.View.Client.ClientConnection;
<i class="no-highlight">10</i>&nbsp;import it.polimi.ingsw.View.ReducedModel.*;
<i class="no-highlight">11</i>&nbsp;import javafx.application.Platform;
<i class="no-highlight">12</i>&nbsp;import javafx.collections.FXCollections;
<i class="no-highlight">13</i>&nbsp;import javafx.collections.ObservableList;
<i class="no-highlight">14</i>&nbsp;import javafx.event.ActionEvent;
<i class="no-highlight">15</i>&nbsp;import javafx.event.EventHandler;
<i class="no-highlight">16</i>&nbsp;import javafx.fxml.FXML;
<i class="no-highlight">17</i>&nbsp;import javafx.fxml.FXMLLoader;
<i class="no-highlight">18</i>&nbsp;import javafx.geometry.HPos;
<i class="no-highlight">19</i>&nbsp;import javafx.geometry.VPos;
<i class="no-highlight">20</i>&nbsp;import javafx.scene.Cursor;
<i class="no-highlight">21</i>&nbsp;import javafx.scene.Node;
<i class="no-highlight">22</i>&nbsp;import javafx.scene.Parent;
<i class="no-highlight">23</i>&nbsp;import javafx.scene.Scene;
<i class="no-highlight">24</i>&nbsp;import javafx.scene.control.Button;
<i class="no-highlight">25</i>&nbsp;import javafx.scene.control.ChoiceBox;
<i class="no-highlight">26</i>&nbsp;import javafx.scene.control.Label;
<i class="no-highlight">27</i>&nbsp;import javafx.scene.control.RadioButton;
<i class="no-highlight">28</i>&nbsp;import javafx.scene.image.Image;
<i class="no-highlight">29</i>&nbsp;import javafx.scene.image.ImageView;
<i class="no-highlight">30</i>&nbsp;import javafx.scene.input.*;
<i class="no-highlight">31</i>&nbsp;import javafx.scene.layout.GridPane;
<i class="no-highlight">32</i>&nbsp;import javafx.scene.text.Text;
<i class="no-highlight">33</i>&nbsp;import javafx.stage.Modality;
<i class="no-highlight">34</i>&nbsp;import javafx.stage.Stage;
<i class="no-highlight">35</i>&nbsp;import java.io.IOException;
<i class="no-highlight">36</i>&nbsp;import java.util.ArrayList;
<i class="no-highlight">37</i>&nbsp;import java.util.HashMap;
<i class="no-highlight">38</i>&nbsp;import java.util.Locale;
<i class="no-highlight">39</i>&nbsp;import java.util.concurrent.atomic.AtomicReference;
<i class="no-highlight">40</i>&nbsp;/**
<i class="no-highlight">41</i>&nbsp; * GuiBoardController handles all the gui interactions related with the user&#39;s interaction with the Game via the Board.
<i class="no-highlight">42</i>&nbsp; */
<i class="no-highlight">43</i>&nbsp;
<i class="no-highlight">44</i>&nbsp;public class GuiBoardController extends GuiInitController{
<i class="no-highlight">45</i>&nbsp;    private Stage cardPicker,chooser,market,leaderSelection,resourcePicker,xtraBoard;
<i class="no-highlight">46</i>&nbsp;    @FXML private Text cardTitle;
<i class="no-highlight">47</i>&nbsp;    @FXML private GridPane cardPane;
<i class="no-highlight">48</i>&nbsp;    private ImageView[][] card;
<i class="no-highlight">49</i>&nbsp;    private int cardColumn,cardRow;
<i class="no-highlight">50</i>&nbsp;    protected ActionEvent event;
<i class="no-highlight">51</i>&nbsp;    private RedDevelopmentCard temporaryCard;
<i class="no-highlight">52</i>&nbsp;    @FXML GridPane marketPane;
<i class="no-highlight">53</i>&nbsp;    @FXML RadioButton marketRow1,marketRow2,marketRow3;
<i class="no-highlight">54</i>&nbsp;    @FXML RadioButton marketColumn1,marketColumn2,marketColumn3,marketColumn4;
<i class="no-highlight">55</i>&nbsp;    @FXML Button submitMarket,submit;
<i class="no-highlight">56</i>&nbsp;    @FXML ImageView extraMarble;
<i class="no-highlight">57</i>&nbsp;    private ImageView[][] activeMarket;
<i class="no-highlight">58</i>&nbsp;    @FXML private Text resourcesTitle;
<i class="no-highlight">59</i>&nbsp;    @FXML private Label remStones,remShields,remCoins,remServants;
<i class="no-highlight">60</i>&nbsp;    @FXML private Label strongboxStones,strongboxShields,strongboxServants,strongboxCoins;
<i class="no-highlight">61</i>&nbsp;    @FXML private Button resetPayment,cancelPayment,confirmPayment;
<i class="no-highlight">62</i>&nbsp;    @FXML private ImageView inkwell;
<i class="no-highlight">63</i>&nbsp;    @FXML private ImageView warehouse1,warehouse21,warehouse22,warehouse31,warehouse32,warehouse33;
<i class="no-highlight">64</i>&nbsp;    @FXML private ImageView leader1,leader2;
<i class="no-highlight">65</i>&nbsp;    @FXML private ImageView leader1resource1,leader1resource2,leader2resource1,leader2resource2;
<i class="no-highlight">66</i>&nbsp;    @FXML private ImageView dev11,dev12,dev13,dev21,dev22,dev23,dev31,dev32,dev33;
<i class="no-highlight">67</i>&nbsp;    @FXML private ImageView shields,servants,stones,coins;
<i class="no-highlight">68</i>&nbsp;    @FXML private ImageView firstFloor,secondFloor,thirdFloor;
<i class="no-highlight">69</i>&nbsp;    @FXML private ImageView pope2,pope3,pope4;
<i class="no-highlight">70</i>&nbsp;    @FXML private Button button;
<i class="no-highlight">71</i>&nbsp;    @FXML protected Button production,nextTurn,payResBtn,cardTableBtn,marketBtn,storeResBtn;
<i class="no-highlight">72</i>&nbsp;    @FXML protected ImageView strongboxStonesClickable,strongboxShieldsClickable,strongboxServantsClickable,strongboxCoinsClickable;
<i class="no-highlight">73</i>&nbsp;    @FXML protected GridPane faithPane, otherBoards, chooserPane;
<i class="no-highlight">74</i>&nbsp;    @FXML protected RadioButton switch1,switch2,switch3;
<b class="nc"><i class="no-highlight">75</i>&nbsp;    private Boolean[] productionOutput = new Boolean[3];</b>
<i class="no-highlight">76</i>&nbsp;    private int resourceNumber;
<i class="no-highlight">77</i>&nbsp;    @FXML private Text cardTitle1,cardTitle2,cardTitle3;
<i class="no-highlight">78</i>&nbsp;    @FXML private RadioButton slotZero,slotOne,slotTwo,slotThree,slotFour,slotFive;
<i class="no-highlight">79</i>&nbsp;
<i class="no-highlight">80</i>&nbsp;    /**
<i class="no-highlight">81</i>&nbsp;     * Constructor for the GuiBoardController class
<i class="no-highlight">82</i>&nbsp;     * @param client                    the client for getting the UI
<i class="no-highlight">83</i>&nbsp;     * @param clientConnection          the clientConnection for network handling
<i class="no-highlight">84</i>&nbsp;     * @param clientExceptionHandler    the clientExcepionHandler
<i class="no-highlight">85</i>&nbsp;     */
<i class="no-highlight">86</i>&nbsp;    protected GuiBoardController(Client client,ClientConnection clientConnection,ClientExceptionHandler clientExceptionHandler) {
<b class="nc"><i class="no-highlight">87</i>&nbsp;        super(client,clientConnection,clientExceptionHandler);</b>
<i class="no-highlight">88</i>&nbsp;    }
<i class="no-highlight">89</i>&nbsp;
<i class="no-highlight">90</i>&nbsp;    /**
<i class="no-highlight">91</i>&nbsp;     * Gets the initial number of resources and sets them in the class
<i class="no-highlight">92</i>&nbsp;     */
<i class="no-highlight">93</i>&nbsp;    private void getInitResource(){
<b class="nc"><i class="no-highlight">94</i>&nbsp;        this.resourceNumber=this.client.getUserInteraction().getInitNumberOfResources();</b>
<i class="no-highlight">95</i>&nbsp;    }
<i class="no-highlight">96</i>&nbsp;
<i class="no-highlight">97</i>&nbsp;    /**
<i class="no-highlight">98</i>&nbsp;     * Method called when the user gets an inital resource.
<i class="no-highlight">99</i>&nbsp;     * When called the resource number is decreased and the labels are set accordingly
<i class="no-highlight">100</i>&nbsp;     */
<i class="no-highlight">101</i>&nbsp;    private void gotInitResource(){
<b class="nc"><i class="no-highlight">102</i>&nbsp;        resourceNumber--;</b>
<b class="nc"><i class="no-highlight">103</i>&nbsp;        remServants.setText(String.valueOf(resourceNumber));</b>
<b class="nc"><i class="no-highlight">104</i>&nbsp;        remStones.setText(String.valueOf(resourceNumber));</b>
<b class="nc"><i class="no-highlight">105</i>&nbsp;        remCoins.setText(String.valueOf(resourceNumber));</b>
<b class="nc"><i class="no-highlight">106</i>&nbsp;        remShields.setText(String.valueOf(resourceNumber));</b>
<i class="no-highlight">107</i>&nbsp;    }
<i class="no-highlight">108</i>&nbsp;
<i class="no-highlight">109</i>&nbsp;    /**
<i class="no-highlight">110</i>&nbsp;     * Method called when the user successfully gets a resource.
<i class="no-highlight">111</i>&nbsp;     * When called the resource number is decreased and the labels are set accordingly
<i class="no-highlight">112</i>&nbsp;     */
<i class="no-highlight">113</i>&nbsp;    private void gotResource(String resource){
<b class="nc"><i class="no-highlight">114</i>&nbsp;        resourceNumber--;</b>
<b class="nc"><i class="no-highlight">115</i>&nbsp;        ResourceType resourceType=stringToResource(resource);</b>
<b class="nc"><i class="no-highlight">116</i>&nbsp;        if (resourceType.equals(ResourceType.SERVANTS))</b>
<b class="nc"><i class="no-highlight">117</i>&nbsp;            remServants.setText(String.valueOf((Integer.parseInt(remServants.getText())-1)));</b>
<b class="nc"><i class="no-highlight">118</i>&nbsp;        else if (resourceType.equals(ResourceType.COINS))</b>
<b class="nc"><i class="no-highlight">119</i>&nbsp;            remCoins.setText(String.valueOf((Integer.parseInt(remCoins.getText())-1)));</b>
<b class="nc"><i class="no-highlight">120</i>&nbsp;        else if (resourceType.equals(ResourceType.SHIELDS))</b>
<b class="nc"><i class="no-highlight">121</i>&nbsp;            remShields.setText(String.valueOf((Integer.parseInt(remShields.getText())-1)));</b>
<b class="nc"><i class="no-highlight">122</i>&nbsp;        else if (resourceType.equals(ResourceType.STONES))</b>
<b class="nc"><i class="no-highlight">123</i>&nbsp;            remStones.setText(String.valueOf((Integer.parseInt(remStones.getText())-1)));</b>
<i class="no-highlight">124</i>&nbsp;    }
<i class="no-highlight">125</i>&nbsp;
<i class="no-highlight">126</i>&nbsp;    /**
<i class="no-highlight">127</i>&nbsp;     * Method used to quickly get One&#39;s player reference
<i class="no-highlight">128</i>&nbsp;     * @return  the player whose board is opened
<i class="no-highlight">129</i>&nbsp;     */
<i class="no-highlight">130</i>&nbsp;    protected Player myPlayer(){
<b class="nc"><i class="no-highlight">131</i>&nbsp;        return this.client.getUserInteraction().getGame().getMyPlayer();</b>
<i class="no-highlight">132</i>&nbsp;    }
<i class="no-highlight">133</i>&nbsp;
<i class="no-highlight">134</i>&nbsp;    /**
<i class="no-highlight">135</i>&nbsp;     * Allows the player to store the resources in his depots, if it has any, by drag-dropping for both the in-game phase and the initial resources.
<i class="no-highlight">136</i>&nbsp;     * Once there are 0 resources left to store or when the player ends the transaction beforehand the board is reloaded to update the resources shown.
<i class="no-highlight">137</i>&nbsp;     * @param initialResources      If the Player gets the initial resources or from other sources
<i class="no-highlight">138</i>&nbsp;     * @throws IOException          If there are errors while loading the FXML
<i class="no-highlight">139</i>&nbsp;     */
<i class="no-highlight">140</i>&nbsp;    protected void getResources(boolean initialResources) throws IOException {
<b class="nc"><i class="no-highlight">141</i>&nbsp;        HashMap&lt;Integer, ArrayList&lt;ResourceType&gt;&gt; depotResource = new HashMap&lt;&gt;();</b>
<b class="nc"><i class="no-highlight">142</i>&nbsp;        ArrayList&lt;ResourceType&gt; firstDepot = new ArrayList&lt;&gt;();</b>
<b class="nc"><i class="no-highlight">143</i>&nbsp;        ArrayList&lt;ResourceType&gt; secondDepot = new ArrayList&lt;&gt;();</b>
<b class="nc"><i class="no-highlight">144</i>&nbsp;        ArrayList&lt;ResourceType&gt; thirdDepot = new ArrayList&lt;&gt;();</b>
<i class="no-highlight">145</i>&nbsp;
<i class="no-highlight">146</i>&nbsp;        Parent getResources;
<b class="nc"><i class="no-highlight">147</i>&nbsp;        if(initialResources){</b>
<b class="nc"><i class="no-highlight">148</i>&nbsp;            getInitResource();</b>
<b class="nc"><i class="no-highlight">149</i>&nbsp;            if(resourceNumber&lt;=0){</b>
<b class="nc"><i class="no-highlight">150</i>&nbsp;                displayError(&quot;No resources to chose from&quot;);</b>
<b class="nc"><i class="no-highlight">151</i>&nbsp;                depotResource.put(0, new ArrayList&lt;&gt;());</b>
<b class="nc"><i class="no-highlight">152</i>&nbsp;                depotResource.put(1, new ArrayList&lt;&gt;());</b>
<b class="nc"><i class="no-highlight">153</i>&nbsp;                depotResource.put(2, new ArrayList&lt;&gt;());</b>
<b class="nc"><i class="no-highlight">154</i>&nbsp;                sendAction(new InitChooseResources(depotResource));</b>
<i class="no-highlight">155</i>&nbsp;                return;
<i class="no-highlight">156</i>&nbsp;            }
<b class="nc"><i class="no-highlight">157</i>&nbsp;            String remaining = String.valueOf(resourceNumber);</b>
<b class="nc"><i class="no-highlight">158</i>&nbsp;            FXMLLoader loader = new FXMLLoader(getClass().getResource(&quot;Assets/Fxml/GetResources.fxml&quot;));</b>
<b class="nc"><i class="no-highlight">159</i>&nbsp;            loader.setController(this);</b>
<b class="nc"><i class="no-highlight">160</i>&nbsp;            getResources = loader.load();</b>
<b class="nc"><i class="no-highlight">161</i>&nbsp;            Scene scene = new Scene(getResources);</b>
<i class="no-highlight">162</i>&nbsp;
<b class="nc"><i class="no-highlight">163</i>&nbsp;            setResourceData(getResourceData(myPlayer()));</b>
<i class="no-highlight">164</i>&nbsp;
<b class="nc"><i class="no-highlight">165</i>&nbsp;            Stage window = getStage();</b>
<b class="nc"><i class="no-highlight">166</i>&nbsp;            window.setScene(scene);</b>
<i class="no-highlight">167</i>&nbsp;
<b class="nc"><i class="no-highlight">168</i>&nbsp;            resourcesTitle.setText(&quot;Drag any resource on the warehouse depot&quot;);</b>
<b class="nc"><i class="no-highlight">169</i>&nbsp;            remStones.setText(remaining);             remCoins.setText(remaining);</b>
<b class="nc"><i class="no-highlight">170</i>&nbsp;            remShields.setText(remaining);            remServants.setText(remaining);</b>
<b class="nc"><i class="no-highlight">171</i>&nbsp;            leader1resource1.setImage(null);            leader1resource2.setImage(null);</b>
<b class="nc"><i class="no-highlight">172</i>&nbsp;            leader2resource1.setImage(null);            leader2resource2.setImage(null);</b>
<b class="nc"><i class="no-highlight">173</i>&nbsp;            leader1.setImage(null);                     leader2.setImage(null);</b>
<b class="nc"><i class="no-highlight">174</i>&nbsp;            resetPayment.setDisable(true);          cancelPayment.setDisable(true);</b>
<b class="nc"><i class="no-highlight">175</i>&nbsp;            switch1.setDisable(true);               switch2.setDisable(true);</b>
<b class="nc"><i class="no-highlight">176</i>&nbsp;            switch3.setDisable(true);               confirmPayment.setDisable(true);</b>
<b class="nc"><i class="no-highlight">177</i>&nbsp;        }</b>
<i class="no-highlight">178</i>&nbsp;        else{
<b class="nc"><i class="no-highlight">179</i>&nbsp;            if(this.client.getUserInteraction().getGame().getMyPlayer().getTemporaryResources().isEmpty()) {</b>
<b class="nc"><i class="no-highlight">180</i>&nbsp;                displayError(&quot;No more resources to add&quot;);</b>
<i class="no-highlight">181</i>&nbsp;                return;
<i class="no-highlight">182</i>&nbsp;            }
<b class="nc"><i class="no-highlight">183</i>&nbsp;            FXMLLoader loader = new FXMLLoader(getClass().getResource(&quot;Assets/Fxml/GetResources.fxml&quot;));</b>
<b class="nc"><i class="no-highlight">184</i>&nbsp;            loader.setController(this);</b>
<b class="nc"><i class="no-highlight">185</i>&nbsp;            getResources = loader.load();</b>
<b class="nc"><i class="no-highlight">186</i>&nbsp;            resourcePicker = new Stage();</b>
<i class="no-highlight">187</i>&nbsp;
<b class="nc"><i class="no-highlight">188</i>&nbsp;            resourcePicker.initModality(Modality.APPLICATION_MODAL);</b>
<b class="nc"><i class="no-highlight">189</i>&nbsp;            resourcePicker.setTitle(&quot;Store Resources&quot;);</b>
<i class="no-highlight">190</i>&nbsp;
<b class="nc"><i class="no-highlight">191</i>&nbsp;            RedResourceStack resourcesToAdd = myPlayer().getTemporaryResources();</b>
<i class="no-highlight">192</i>&nbsp;
<b class="nc"><i class="no-highlight">193</i>&nbsp;            resourceNumber=resourcesToAdd.getResource(ResourceType.STONES)+resourcesToAdd.getResource(ResourceType.SHIELDS)+resourcesToAdd.getResource(ResourceType.COINS)+resourcesToAdd.getResource(ResourceType.SERVANTS);</b>
<i class="no-highlight">194</i>&nbsp;
<b class="nc"><i class="no-highlight">195</i>&nbsp;            resourcesTitle.setText(&quot;Drag the resources on the warehouse depot&quot;);</b>
<b class="nc"><i class="no-highlight">196</i>&nbsp;            remStones.setText(String.valueOf(resourcesToAdd.getResource(ResourceType.STONES)));                 remCoins.setText(String.valueOf(resourcesToAdd.getResource(ResourceType.COINS)));</b>
<b class="nc"><i class="no-highlight">197</i>&nbsp;            remShields.setText(String.valueOf(resourcesToAdd.getResource(ResourceType.SHIELDS)));               remServants.setText(String.valueOf(resourcesToAdd.getResource(ResourceType.SERVANTS)));</b>
<b class="nc"><i class="no-highlight">198</i>&nbsp;            cancelPayment.setDisable(true);</b>
<b class="nc"><i class="no-highlight">199</i>&nbsp;            refresh();</b>
<b class="nc"><i class="no-highlight">200</i>&nbsp;            switch1.setOnAction(event -&gt; {</b>
<b class="nc"><i class="no-highlight">201</i>&nbsp;                if(switch1.isSelected()){</b>
<b class="nc"><i class="no-highlight">202</i>&nbsp;                    if(switch2.isSelected()&amp;&amp;switch3.isSelected()){</b>
<b class="nc"><i class="no-highlight">203</i>&nbsp;                        switch2.setSelected(false);</b>
<i class="no-highlight">204</i>&nbsp;                    }
<i class="no-highlight">205</i>&nbsp;                    else{
<b class="nc"><i class="no-highlight">206</i>&nbsp;                        if(switch2.isSelected())</b>
<b class="nc"><i class="no-highlight">207</i>&nbsp;                            cancelPayment.setDisable(false);</b>
<b class="nc"><i class="no-highlight">208</i>&nbsp;                        if(switch3.isSelected())</b>
<b class="nc"><i class="no-highlight">209</i>&nbsp;                            cancelPayment.setDisable(false);</b>
<i class="no-highlight">210</i>&nbsp;                    }
<i class="no-highlight">211</i>&nbsp;                }else{
<b class="nc"><i class="no-highlight">212</i>&nbsp;                    cancelPayment.setDisable(true);</b>
<i class="no-highlight">213</i>&nbsp;                }
<i class="no-highlight">214</i>&nbsp;            });
<b class="nc"><i class="no-highlight">215</i>&nbsp;            switch2.setOnAction(event -&gt; {</b>
<b class="nc"><i class="no-highlight">216</i>&nbsp;                if(switch2.isSelected()){</b>
<b class="nc"><i class="no-highlight">217</i>&nbsp;                    if(switch1.isSelected()&amp;&amp;switch3.isSelected()){</b>
<b class="nc"><i class="no-highlight">218</i>&nbsp;                        switch1.setSelected(false);</b>
<i class="no-highlight">219</i>&nbsp;                    }
<i class="no-highlight">220</i>&nbsp;                    else{
<b class="nc"><i class="no-highlight">221</i>&nbsp;                        if(switch1.isSelected())</b>
<b class="nc"><i class="no-highlight">222</i>&nbsp;                            cancelPayment.setDisable(false);</b>
<b class="nc"><i class="no-highlight">223</i>&nbsp;                        if(switch3.isSelected())</b>
<b class="nc"><i class="no-highlight">224</i>&nbsp;                            cancelPayment.setDisable(false);</b>
<i class="no-highlight">225</i>&nbsp;                    }
<i class="no-highlight">226</i>&nbsp;                }else{
<b class="nc"><i class="no-highlight">227</i>&nbsp;                    cancelPayment.setDisable(true);</b>
<i class="no-highlight">228</i>&nbsp;                }
<i class="no-highlight">229</i>&nbsp;            });
<b class="nc"><i class="no-highlight">230</i>&nbsp;            switch3.setOnAction(event -&gt; {</b>
<b class="nc"><i class="no-highlight">231</i>&nbsp;                if(switch3.isSelected()){</b>
<b class="nc"><i class="no-highlight">232</i>&nbsp;                    if(switch2.isSelected()&amp;&amp;switch1.isSelected()){</b>
<b class="nc"><i class="no-highlight">233</i>&nbsp;                        switch2.setSelected(false);</b>
<i class="no-highlight">234</i>&nbsp;                    }
<i class="no-highlight">235</i>&nbsp;                    else{
<b class="nc"><i class="no-highlight">236</i>&nbsp;                        if(switch2.isSelected())</b>
<b class="nc"><i class="no-highlight">237</i>&nbsp;                            cancelPayment.setDisable(false);</b>
<b class="nc"><i class="no-highlight">238</i>&nbsp;                        if(switch1.isSelected())</b>
<b class="nc"><i class="no-highlight">239</i>&nbsp;                            cancelPayment.setDisable(false);</b>
<i class="no-highlight">240</i>&nbsp;                    }
<i class="no-highlight">241</i>&nbsp;                }else{
<b class="nc"><i class="no-highlight">242</i>&nbsp;                    cancelPayment.setDisable(true);</b>
<i class="no-highlight">243</i>&nbsp;                }
<i class="no-highlight">244</i>&nbsp;            });
<b class="nc"><i class="no-highlight">245</i>&nbsp;            cancelPayment.setOnAction(event -&gt; {</b>
<b class="nc"><i class="no-highlight">246</i>&nbsp;              if(myPlayer().getPossibleActions().contains(ActionType.SWITCH_DEPOT)){</b>
<i class="no-highlight">247</i>&nbsp;                  int depot1,depot2;
<b class="nc"><i class="no-highlight">248</i>&nbsp;                  if(switch1.isSelected())</b>
<i class="no-highlight">249</i>&nbsp;                  {
<b class="nc"><i class="no-highlight">250</i>&nbsp;                      depot1=2;</b>
<b class="nc"><i class="no-highlight">251</i>&nbsp;                      if(switch2.isSelected())</b>
<b class="nc"><i class="no-highlight">252</i>&nbsp;                          depot2=1;</b>
<i class="no-highlight">253</i>&nbsp;                      else
<b class="nc"><i class="no-highlight">254</i>&nbsp;                          depot2=0;</b>
<i class="no-highlight">255</i>&nbsp;                  }
<b class="nc"><i class="no-highlight">256</i>&nbsp;                  if(switch2.isSelected())</b>
<i class="no-highlight">257</i>&nbsp;                  {
<b class="nc"><i class="no-highlight">258</i>&nbsp;                      depot1=1;</b>
<b class="nc"><i class="no-highlight">259</i>&nbsp;                      if(switch1.isSelected())</b>
<b class="nc"><i class="no-highlight">260</i>&nbsp;                          depot2=2;</b>
<i class="no-highlight">261</i>&nbsp;                      else
<b class="nc"><i class="no-highlight">262</i>&nbsp;                          depot2=0;</b>
<i class="no-highlight">263</i>&nbsp;                  }
<i class="no-highlight">264</i>&nbsp;                  else{
<b class="nc"><i class="no-highlight">265</i>&nbsp;                      depot1=0;</b>
<b class="nc"><i class="no-highlight">266</i>&nbsp;                      if(switch2.isSelected())</b>
<b class="nc"><i class="no-highlight">267</i>&nbsp;                          depot2=1;</b>
<i class="no-highlight">268</i>&nbsp;                      else
<b class="nc"><i class="no-highlight">269</i>&nbsp;                          depot2=2;</b>
<i class="no-highlight">270</i>&nbsp;                  }
<b class="nc"><i class="no-highlight">271</i>&nbsp;                  sendAction(new SwitchDepot(depot1,depot2));</b>
<b class="nc"><i class="no-highlight">272</i>&nbsp;                  resourcePicker.close();</b>
<i class="no-highlight">273</i>&nbsp;
<b class="nc"><i class="no-highlight">274</i>&nbsp;                  Platform.runLater(new Runnable() {</b>
<i class="no-highlight">275</i>&nbsp;                      @Override
<i class="no-highlight">276</i>&nbsp;                      public void run() {
<i class="no-highlight">277</i>&nbsp;                          try {
<b class="nc"><i class="no-highlight">278</i>&nbsp;                              getResources(false);</b>
<b class="nc"><i class="no-highlight">279</i>&nbsp;                          } catch (Exception e) {</b>
<b class="nc"><i class="no-highlight">280</i>&nbsp;                              e.printStackTrace();</b>
<b class="nc"><i class="no-highlight">281</i>&nbsp;                          }</b>
<i class="no-highlight">282</i>&nbsp;                      }
<i class="no-highlight">283</i>&nbsp;                  });
<i class="no-highlight">284</i>&nbsp;
<b class="nc"><i class="no-highlight">285</i>&nbsp;                  refresh();</b>
<i class="no-highlight">286</i>&nbsp;              }
<i class="no-highlight">287</i>&nbsp;            });
<i class="no-highlight">288</i>&nbsp;
<b class="nc"><i class="no-highlight">289</i>&nbsp;            resetPayment.setOnAction(event -&gt; {</b>
<b class="nc"><i class="no-highlight">290</i>&nbsp;                if(myPlayer().getPossibleActions().contains(ActionType.RESET_WAREHOUSE)){</b>
<i class="no-highlight">291</i>&nbsp;
<b class="nc"><i class="no-highlight">292</i>&nbsp;                    sendAction(new ResetWarehouse());</b>
<b class="nc"><i class="no-highlight">293</i>&nbsp;                    resourcePicker.close();</b>
<i class="no-highlight">294</i>&nbsp;
<b class="nc"><i class="no-highlight">295</i>&nbsp;                    Platform.runLater(new Runnable() {</b>
<i class="no-highlight">296</i>&nbsp;                        @Override
<i class="no-highlight">297</i>&nbsp;                        public void run() {
<i class="no-highlight">298</i>&nbsp;                            try {
<b class="nc"><i class="no-highlight">299</i>&nbsp;                                getResources(false);</b>
<b class="nc"><i class="no-highlight">300</i>&nbsp;                            } catch (Exception e) {</b>
<b class="nc"><i class="no-highlight">301</i>&nbsp;                                e.printStackTrace();</b>
<b class="nc"><i class="no-highlight">302</i>&nbsp;                            }</b>
<i class="no-highlight">303</i>&nbsp;                        }
<i class="no-highlight">304</i>&nbsp;                    });
<i class="no-highlight">305</i>&nbsp;
<b class="nc"><i class="no-highlight">306</i>&nbsp;                    refresh();</b>
<i class="no-highlight">307</i>&nbsp;                }
<i class="no-highlight">308</i>&nbsp;            });
<i class="no-highlight">309</i>&nbsp;        }
<i class="no-highlight">310</i>&nbsp;
<b class="nc"><i class="no-highlight">311</i>&nbsp;        shields.setOnDragDetected(new EventHandler&lt;MouseEvent&gt;() {</b>
<i class="no-highlight">312</i>&nbsp;            public void handle(MouseEvent event) {
<i class="no-highlight">313</i>&nbsp;                /* drag was detected, start drag-and-drop gesture*/
<i class="no-highlight">314</i>&nbsp;
<b class="nc"><i class="no-highlight">315</i>&nbsp;                if(initialResources||getClientConnection().getClient().getUserInteraction().getGame().getMyPlayer().getTemporaryResources().hasResource(ResourceType.SHIELDS)){</b>
<i class="no-highlight">316</i>&nbsp;                    /* allow any transfer mode */
<b class="nc"><i class="no-highlight">317</i>&nbsp;                    Dragboard db = shields.startDragAndDrop(TransferMode.ANY);</b>
<i class="no-highlight">318</i>&nbsp;                    /* put a string on dragboard */
<b class="nc"><i class="no-highlight">319</i>&nbsp;                    ClipboardContent content = new ClipboardContent();</b>
<b class="nc"><i class="no-highlight">320</i>&nbsp;                    content.putString(&quot;shields&quot;);</b>
<b class="nc"><i class="no-highlight">321</i>&nbsp;                    db.setContent(content);</b>
<b class="nc"><i class="no-highlight">322</i>&nbsp;                }else</b>
<b class="nc"><i class="no-highlight">323</i>&nbsp;                    displayError(&quot;You have no more shields to store&quot;);</b>
<i class="no-highlight">324</i>&nbsp;
<b class="nc"><i class="no-highlight">325</i>&nbsp;                event.consume();</b>
<i class="no-highlight">326</i>&nbsp;            }
<i class="no-highlight">327</i>&nbsp;        });
<b class="nc"><i class="no-highlight">328</i>&nbsp;        servants.setOnDragDetected(new EventHandler&lt;MouseEvent&gt;() {</b>
<i class="no-highlight">329</i>&nbsp;            public void handle(MouseEvent event) {
<i class="no-highlight">330</i>&nbsp;                /* drag was detected, start drag-and-drop gesture*/
<i class="no-highlight">331</i>&nbsp;
<b class="nc"><i class="no-highlight">332</i>&nbsp;                if(initialResources||getClientConnection().getClient().getUserInteraction().getGame().getMyPlayer().getTemporaryResources().hasResource(ResourceType.SERVANTS)){</b>
<i class="no-highlight">333</i>&nbsp;                    /* allow any transfer mode */
<b class="nc"><i class="no-highlight">334</i>&nbsp;                Dragboard db = servants.startDragAndDrop(TransferMode.ANY);</b>
<i class="no-highlight">335</i>&nbsp;                /* put a string on dragboard */
<b class="nc"><i class="no-highlight">336</i>&nbsp;                ClipboardContent content = new ClipboardContent();</b>
<b class="nc"><i class="no-highlight">337</i>&nbsp;                content.putString(&quot;servants&quot;);</b>
<b class="nc"><i class="no-highlight">338</i>&nbsp;                db.setContent(content);</b>
<b class="nc"><i class="no-highlight">339</i>&nbsp;                }else</b>
<b class="nc"><i class="no-highlight">340</i>&nbsp;                    displayError(&quot;You have no more servants to store&quot;);</b>
<b class="nc"><i class="no-highlight">341</i>&nbsp;                event.consume();</b>
<i class="no-highlight">342</i>&nbsp;            }
<i class="no-highlight">343</i>&nbsp;        });
<b class="nc"><i class="no-highlight">344</i>&nbsp;        coins.setOnDragDetected(new EventHandler&lt;MouseEvent&gt;() {</b>
<i class="no-highlight">345</i>&nbsp;            public void handle(MouseEvent event) {
<i class="no-highlight">346</i>&nbsp;                /* drag was detected, start drag-and-drop gesture*/
<i class="no-highlight">347</i>&nbsp;
<b class="nc"><i class="no-highlight">348</i>&nbsp;                if(initialResources||getClientConnection().getClient().getUserInteraction().getGame().getMyPlayer().getTemporaryResources().hasResource(ResourceType.COINS)){</b>
<i class="no-highlight">349</i>&nbsp;                    /* allow any transfer mode */
<b class="nc"><i class="no-highlight">350</i>&nbsp;                Dragboard db = coins.startDragAndDrop(TransferMode.ANY);</b>
<i class="no-highlight">351</i>&nbsp;                /* put a string on dragboard */
<b class="nc"><i class="no-highlight">352</i>&nbsp;                ClipboardContent content = new ClipboardContent();</b>
<b class="nc"><i class="no-highlight">353</i>&nbsp;                content.putString(&quot;coins&quot;);</b>
<b class="nc"><i class="no-highlight">354</i>&nbsp;                db.setContent(content);}else</b>
<b class="nc"><i class="no-highlight">355</i>&nbsp;                    displayError(&quot;You have no more coins to store&quot;);</b>
<i class="no-highlight">356</i>&nbsp;
<b class="nc"><i class="no-highlight">357</i>&nbsp;                event.consume();</b>
<i class="no-highlight">358</i>&nbsp;            }
<i class="no-highlight">359</i>&nbsp;        });
<b class="nc"><i class="no-highlight">360</i>&nbsp;        stones.setOnDragDetected(new EventHandler&lt;MouseEvent&gt;() {</b>
<i class="no-highlight">361</i>&nbsp;            public void handle(MouseEvent event) {
<i class="no-highlight">362</i>&nbsp;                /* drag was detected, start drag-and-drop gesture*/
<i class="no-highlight">363</i>&nbsp;
<b class="nc"><i class="no-highlight">364</i>&nbsp;                if(initialResources||getClientConnection().getClient().getUserInteraction().getGame().getMyPlayer().getTemporaryResources().hasResource(ResourceType.STONES)){</b>
<i class="no-highlight">365</i>&nbsp;                    /* allow any transfer mode */
<b class="nc"><i class="no-highlight">366</i>&nbsp;                Dragboard db = stones.startDragAndDrop(TransferMode.ANY);</b>
<i class="no-highlight">367</i>&nbsp;                /* put a string on dragboard */
<b class="nc"><i class="no-highlight">368</i>&nbsp;                ClipboardContent content = new ClipboardContent();</b>
<b class="nc"><i class="no-highlight">369</i>&nbsp;                content.putString(&quot;stones&quot;);</b>
<b class="nc"><i class="no-highlight">370</i>&nbsp;                db.setContent(content);}else</b>
<b class="nc"><i class="no-highlight">371</i>&nbsp;                    displayError(&quot;You have no more stones to store&quot;);</b>
<i class="no-highlight">372</i>&nbsp;
<b class="nc"><i class="no-highlight">373</i>&nbsp;                event.consume();</b>
<i class="no-highlight">374</i>&nbsp;            }
<i class="no-highlight">375</i>&nbsp;        });
<i class="no-highlight">376</i>&nbsp;
<b class="nc"><i class="no-highlight">377</i>&nbsp;        firstFloor.setOnDragOver(new EventHandler &lt;DragEvent&gt;() {</b>
<i class="no-highlight">378</i>&nbsp;            public void handle(DragEvent event) {
<i class="no-highlight">379</i>&nbsp;                /* accept it only if it is  not dragged from the same node
<i class="no-highlight">380</i>&nbsp;                 * and if it has a string data */
<b class="nc"><i class="no-highlight">381</i>&nbsp;                if (event.getDragboard().hasString()) {</b>
<i class="no-highlight">382</i>&nbsp;                    /* allow for both copying and moving, whatever user chooses */
<b class="nc"><i class="no-highlight">383</i>&nbsp;                    event.acceptTransferModes(TransferMode.COPY_OR_MOVE);</b>
<i class="no-highlight">384</i>&nbsp;                }
<b class="nc"><i class="no-highlight">385</i>&nbsp;                event.consume();</b>
<i class="no-highlight">386</i>&nbsp;            }
<i class="no-highlight">387</i>&nbsp;        });
<b class="nc"><i class="no-highlight">388</i>&nbsp;        secondFloor.setOnDragOver(new EventHandler &lt;DragEvent&gt;() {</b>
<i class="no-highlight">389</i>&nbsp;            public void handle(DragEvent event) {
<i class="no-highlight">390</i>&nbsp;                /* accept it only if it is  not dragged from the same node
<i class="no-highlight">391</i>&nbsp;                 * and if it has a string data */
<b class="nc"><i class="no-highlight">392</i>&nbsp;                if (event.getDragboard().hasString()) {</b>
<i class="no-highlight">393</i>&nbsp;                    /* allow for both copying and moving, whatever user chooses */
<b class="nc"><i class="no-highlight">394</i>&nbsp;                    event.acceptTransferModes(TransferMode.COPY_OR_MOVE);</b>
<i class="no-highlight">395</i>&nbsp;                }
<b class="nc"><i class="no-highlight">396</i>&nbsp;                event.consume();</b>
<i class="no-highlight">397</i>&nbsp;            }
<i class="no-highlight">398</i>&nbsp;        });
<b class="nc"><i class="no-highlight">399</i>&nbsp;        thirdFloor.setOnDragOver(new EventHandler &lt;DragEvent&gt;() {</b>
<i class="no-highlight">400</i>&nbsp;            public void handle(DragEvent event) {
<i class="no-highlight">401</i>&nbsp;                /* accept it only if it is  not dragged from the same node
<i class="no-highlight">402</i>&nbsp;                 * and if it has a string data */
<b class="nc"><i class="no-highlight">403</i>&nbsp;                if (event.getDragboard().hasString()) {</b>
<i class="no-highlight">404</i>&nbsp;                    /* allow for both copying and moving, whatever user chooses */
<b class="nc"><i class="no-highlight">405</i>&nbsp;                    event.acceptTransferModes(TransferMode.COPY_OR_MOVE);</b>
<i class="no-highlight">406</i>&nbsp;                }
<i class="no-highlight">407</i>&nbsp;
<b class="nc"><i class="no-highlight">408</i>&nbsp;                event.consume();</b>
<i class="no-highlight">409</i>&nbsp;            }
<i class="no-highlight">410</i>&nbsp;        });
<i class="no-highlight">411</i>&nbsp;
<b class="nc"><i class="no-highlight">412</i>&nbsp;        firstFloor.setOnDragDropped(new EventHandler &lt;DragEvent&gt;() {</b>
<i class="no-highlight">413</i>&nbsp;            public void handle(DragEvent event) {
<i class="no-highlight">414</i>&nbsp;                /* if there is a string data on dragboard, read it and use it */
<b class="nc"><i class="no-highlight">415</i>&nbsp;                Dragboard db = event.getDragboard();</b>
<b class="nc"><i class="no-highlight">416</i>&nbsp;                boolean success = false;</b>
<b class="nc"><i class="no-highlight">417</i>&nbsp;                if (db.hasString()) {</b>
<b class="nc"><i class="no-highlight">418</i>&nbsp;                    String resource = db.getString();</b>
<b class="nc"><i class="no-highlight">419</i>&nbsp;                    if(initialResources){</b>
<b class="nc"><i class="no-highlight">420</i>&nbsp;                        if(thirdDepot.isEmpty())</b>
<i class="no-highlight">421</i>&nbsp;                        {
<b class="nc"><i class="no-highlight">422</i>&nbsp;                        thirdDepot.add(stringToResource(resource));</b>
<b class="nc"><i class="no-highlight">423</i>&nbsp;                        warehouse1.setImage(getImage(stringToResource(resource)));</b>
<b class="nc"><i class="no-highlight">424</i>&nbsp;                        gotInitResource();</b>
<b class="nc"><i class="no-highlight">425</i>&nbsp;                        if(resourceNumber==0)</b>
<i class="no-highlight">426</i>&nbsp;                        {
<b class="nc"><i class="no-highlight">427</i>&nbsp;                            depotResource.put(0, firstDepot);</b>
<b class="nc"><i class="no-highlight">428</i>&nbsp;                            depotResource.put(1, secondDepot);</b>
<b class="nc"><i class="no-highlight">429</i>&nbsp;                            depotResource.put(2, thirdDepot);</b>
<b class="nc"><i class="no-highlight">430</i>&nbsp;                            sendAction(new InitChooseResources(depotResource));</b>
<i class="no-highlight">431</i>&nbsp;                            return;
<i class="no-highlight">432</i>&nbsp;                        }
<i class="no-highlight">433</i>&nbsp;                        }else
<b class="nc"><i class="no-highlight">434</i>&nbsp;                            displayError(&quot;This depot is full!&quot;);</b>
<b class="nc"><i class="no-highlight">435</i>&nbsp;                        success=true;</b>
<i class="no-highlight">436</i>&nbsp;                    }else{
<b class="nc"><i class="no-highlight">437</i>&nbsp;                        success=addResource(2,resource);</b>
<b class="nc"><i class="no-highlight">438</i>&nbsp;                        if(success){</b>
<b class="nc"><i class="no-highlight">439</i>&nbsp;                            warehouse1.setImage(getImage(stringToResource(resource)));</b>
<b class="nc"><i class="no-highlight">440</i>&nbsp;                            gotResource(resource);</b>
<b class="nc"><i class="no-highlight">441</i>&nbsp;                            if(resourceNumber==0)</b>
<i class="no-highlight">442</i>&nbsp;                            {
<b class="nc"><i class="no-highlight">443</i>&nbsp;                                sendAction(new EndMarket());</b>
<b class="nc"><i class="no-highlight">444</i>&nbsp;                                marketBtn.setText(&quot;Open Market&quot;);</b>
<b class="nc"><i class="no-highlight">445</i>&nbsp;                                refresh();</b>
<b class="nc"><i class="no-highlight">446</i>&nbsp;                                resourcePicker.close();</b>
<i class="no-highlight">447</i>&nbsp;                                try {
<b class="nc"><i class="no-highlight">448</i>&nbsp;                                    board();</b>
<b class="nc"><i class="no-highlight">449</i>&nbsp;                                } catch (IOException e) {</b>
<b class="nc"><i class="no-highlight">450</i>&nbsp;                                    e.printStackTrace();</b>
<b class="nc"><i class="no-highlight">451</i>&nbsp;                                }</b>
<i class="no-highlight">452</i>&nbsp;                            }
<b class="nc"><i class="no-highlight">453</i>&nbsp;                            setResourceData(getResourceData(client.getUserInteraction().getGame().getMyPlayer()));</b>
<i class="no-highlight">454</i>&nbsp;
<i class="no-highlight">455</i>&nbsp;                        }
<i class="no-highlight">456</i>&nbsp;
<i class="no-highlight">457</i>&nbsp;                    }
<i class="no-highlight">458</i>&nbsp;                }
<i class="no-highlight">459</i>&nbsp;                /* let the source know whether the string was successfully
<i class="no-highlight">460</i>&nbsp;                 * transferred and used */
<b class="nc"><i class="no-highlight">461</i>&nbsp;                event.setDropCompleted(success);</b>
<b class="nc"><i class="no-highlight">462</i>&nbsp;                event.consume();</b>
<i class="no-highlight">463</i>&nbsp;            }
<i class="no-highlight">464</i>&nbsp;        });
<b class="nc"><i class="no-highlight">465</i>&nbsp;        secondFloor.setOnDragDropped(new EventHandler &lt;DragEvent&gt;() {</b>
<i class="no-highlight">466</i>&nbsp;            public void handle(DragEvent event) {
<i class="no-highlight">467</i>&nbsp;                /* if there is a string data on dragboard, read it and use it */
<b class="nc"><i class="no-highlight">468</i>&nbsp;                Dragboard db = event.getDragboard();</b>
<b class="nc"><i class="no-highlight">469</i>&nbsp;                boolean success = false;</b>
<b class="nc"><i class="no-highlight">470</i>&nbsp;                if (db.hasString()) {</b>
<b class="nc"><i class="no-highlight">471</i>&nbsp;                    String resource = db.getString();</b>
<b class="nc"><i class="no-highlight">472</i>&nbsp;                    if(initialResources){</b>
<b class="nc"><i class="no-highlight">473</i>&nbsp;                        if((secondDepot.contains(stringToResource(resource))&amp;&amp;secondDepot.size()==1)||secondDepot.isEmpty()){</b>
<b class="nc"><i class="no-highlight">474</i>&nbsp;                        secondDepot.add(stringToResource(resource));</b>
<b class="nc"><i class="no-highlight">475</i>&nbsp;                        if(secondDepot.size()==0)</b>
<b class="nc"><i class="no-highlight">476</i>&nbsp;                            warehouse21.setImage(getImage(stringToResource(resource)));</b>
<i class="no-highlight">477</i>&nbsp;                        else
<b class="nc"><i class="no-highlight">478</i>&nbsp;                            warehouse22.setImage(getImage(stringToResource(resource)));</b>
<b class="nc"><i class="no-highlight">479</i>&nbsp;                        gotInitResource();</b>
<b class="nc"><i class="no-highlight">480</i>&nbsp;                        if(resourceNumber==0)</b>
<i class="no-highlight">481</i>&nbsp;                        {
<b class="nc"><i class="no-highlight">482</i>&nbsp;                            depotResource.put(2, firstDepot);</b>
<b class="nc"><i class="no-highlight">483</i>&nbsp;                            depotResource.put(1, secondDepot);</b>
<b class="nc"><i class="no-highlight">484</i>&nbsp;                            depotResource.put(0, thirdDepot);</b>
<b class="nc"><i class="no-highlight">485</i>&nbsp;                            sendAction(new InitChooseResources(depotResource));</b>
<i class="no-highlight">486</i>&nbsp;                            return;
<i class="no-highlight">487</i>&nbsp;                        }
<i class="no-highlight">488</i>&nbsp;                    }else
<b class="nc"><i class="no-highlight">489</i>&nbsp;                        displayError(&quot;You can&#39;t add this resource here!&quot;);</b>
<b class="nc"><i class="no-highlight">490</i>&nbsp;                        success=true;</b>
<i class="no-highlight">491</i>&nbsp;                    }else{
<b class="nc"><i class="no-highlight">492</i>&nbsp;                        success=addResource(1,resource);</b>
<b class="nc"><i class="no-highlight">493</i>&nbsp;                        if(success)</b>
<b class="nc"><i class="no-highlight">494</i>&nbsp;                            gotResource(resource);</b>
<b class="nc"><i class="no-highlight">495</i>&nbsp;                        if(resourceNumber==0)</b>
<i class="no-highlight">496</i>&nbsp;                        {
<b class="nc"><i class="no-highlight">497</i>&nbsp;                            sendAction(new EndMarket());</b>
<b class="nc"><i class="no-highlight">498</i>&nbsp;                            marketBtn.setText(&quot;Open Market&quot;);</b>
<b class="nc"><i class="no-highlight">499</i>&nbsp;                            refresh();</b>
<b class="nc"><i class="no-highlight">500</i>&nbsp;                            resourcePicker.close();</b>
<i class="no-highlight">501</i>&nbsp;                            try {
<b class="nc"><i class="no-highlight">502</i>&nbsp;                                board();</b>
<b class="nc"><i class="no-highlight">503</i>&nbsp;                            } catch (IOException e) {</b>
<b class="nc"><i class="no-highlight">504</i>&nbsp;                                e.printStackTrace();</b>
<b class="nc"><i class="no-highlight">505</i>&nbsp;                            }</b>
<i class="no-highlight">506</i>&nbsp;                        }
<b class="nc"><i class="no-highlight">507</i>&nbsp;                        setResourceData(getResourceData(client.getUserInteraction().getGame().getMyPlayer()));</b>
<i class="no-highlight">508</i>&nbsp;                    }
<i class="no-highlight">509</i>&nbsp;                }
<i class="no-highlight">510</i>&nbsp;                /* let the source know whether the string was successfully
<i class="no-highlight">511</i>&nbsp;                 * transferred and used */
<b class="nc"><i class="no-highlight">512</i>&nbsp;                event.setDropCompleted(success);</b>
<b class="nc"><i class="no-highlight">513</i>&nbsp;                event.consume();</b>
<i class="no-highlight">514</i>&nbsp;            }
<i class="no-highlight">515</i>&nbsp;        });
<b class="nc"><i class="no-highlight">516</i>&nbsp;        thirdFloor.setOnDragDropped(new EventHandler &lt;DragEvent&gt;() {</b>
<i class="no-highlight">517</i>&nbsp;            public void handle(DragEvent event) {
<i class="no-highlight">518</i>&nbsp;                /* if there is a string data on dragboard, read it and use it */
<b class="nc"><i class="no-highlight">519</i>&nbsp;                Dragboard db = event.getDragboard();</b>
<b class="nc"><i class="no-highlight">520</i>&nbsp;                boolean success = false;</b>
<b class="nc"><i class="no-highlight">521</i>&nbsp;                if (db.hasString()) {</b>
<b class="nc"><i class="no-highlight">522</i>&nbsp;                    String resource = db.getString();</b>
<b class="nc"><i class="no-highlight">523</i>&nbsp;                    if(initialResources){</b>
<b class="nc"><i class="no-highlight">524</i>&nbsp;                        if((firstDepot.contains(stringToResource(resource))&amp;&amp;firstDepot.size()&lt;3)||firstDepot.isEmpty()){</b>
<b class="nc"><i class="no-highlight">525</i>&nbsp;                        firstDepot.add(stringToResource(resource));</b>
<b class="nc"><i class="no-highlight">526</i>&nbsp;                        if(firstDepot.size()==0)</b>
<b class="nc"><i class="no-highlight">527</i>&nbsp;                        warehouse31.setImage(getImage(stringToResource(resource)));</b>
<b class="nc"><i class="no-highlight">528</i>&nbsp;                        else if(firstDepot.size()==1)</b>
<b class="nc"><i class="no-highlight">529</i>&nbsp;                            warehouse32.setImage(getImage(stringToResource(resource)));</b>
<i class="no-highlight">530</i>&nbsp;                        else
<b class="nc"><i class="no-highlight">531</i>&nbsp;                            warehouse33.setImage(getImage(stringToResource(resource)));</b>
<b class="nc"><i class="no-highlight">532</i>&nbsp;                        gotInitResource();</b>
<b class="nc"><i class="no-highlight">533</i>&nbsp;                        if(resourceNumber==0)</b>
<i class="no-highlight">534</i>&nbsp;                        {
<b class="nc"><i class="no-highlight">535</i>&nbsp;                            depotResource.put(2, firstDepot);</b>
<b class="nc"><i class="no-highlight">536</i>&nbsp;                            depotResource.put(1, secondDepot);</b>
<b class="nc"><i class="no-highlight">537</i>&nbsp;                            depotResource.put(0, thirdDepot);</b>
<b class="nc"><i class="no-highlight">538</i>&nbsp;                            sendAction(new InitChooseResources(depotResource));</b>
<i class="no-highlight">539</i>&nbsp;                            return;
<i class="no-highlight">540</i>&nbsp;                        }
<i class="no-highlight">541</i>&nbsp;                        }else
<b class="nc"><i class="no-highlight">542</i>&nbsp;                            displayError(&quot;You can&#39;t add this resource here!&quot;);</b>
<b class="nc"><i class="no-highlight">543</i>&nbsp;                        success=true;</b>
<i class="no-highlight">544</i>&nbsp;                    }else{
<b class="nc"><i class="no-highlight">545</i>&nbsp;                        success=addResource(0,resource);</b>
<b class="nc"><i class="no-highlight">546</i>&nbsp;                        if(success)</b>
<b class="nc"><i class="no-highlight">547</i>&nbsp;                            gotResource(resource);</b>
<b class="nc"><i class="no-highlight">548</i>&nbsp;                        if(resourceNumber==0)</b>
<i class="no-highlight">549</i>&nbsp;                        {
<b class="nc"><i class="no-highlight">550</i>&nbsp;                            sendAction(new EndMarket());</b>
<b class="nc"><i class="no-highlight">551</i>&nbsp;                            marketBtn.setText(&quot;Open Market&quot;);</b>
<b class="nc"><i class="no-highlight">552</i>&nbsp;                            resourcePicker.close();</b>
<i class="no-highlight">553</i>&nbsp;                            try {
<b class="nc"><i class="no-highlight">554</i>&nbsp;                                board();</b>
<b class="nc"><i class="no-highlight">555</i>&nbsp;                            } catch (IOException e) {</b>
<b class="nc"><i class="no-highlight">556</i>&nbsp;                                e.printStackTrace();</b>
<b class="nc"><i class="no-highlight">557</i>&nbsp;                            }</b>
<i class="no-highlight">558</i>&nbsp;                        }
<b class="nc"><i class="no-highlight">559</i>&nbsp;                        setResourceData(getResourceData(client.getUserInteraction().getGame().getMyPlayer()));</b>
<i class="no-highlight">560</i>&nbsp;                    }
<i class="no-highlight">561</i>&nbsp;                }
<i class="no-highlight">562</i>&nbsp;                /* let the source know whether the string was successfully
<i class="no-highlight">563</i>&nbsp;                 * transferred and used */
<b class="nc"><i class="no-highlight">564</i>&nbsp;                event.setDropCompleted(success);</b>
<b class="nc"><i class="no-highlight">565</i>&nbsp;                event.consume();</b>
<i class="no-highlight">566</i>&nbsp;            }
<i class="no-highlight">567</i>&nbsp;        });
<i class="no-highlight">568</i>&nbsp;
<b class="nc"><i class="no-highlight">569</i>&nbsp;        confirmPayment.setOnAction(e-&gt;{</b>
<b class="nc"><i class="no-highlight">570</i>&nbsp;            sendAction(new EndMarket());</b>
<b class="nc"><i class="no-highlight">571</i>&nbsp;            marketBtn.setText(&quot;Open Market&quot;);</b>
<b class="nc"><i class="no-highlight">572</i>&nbsp;            resourcePicker.close();</b>
<i class="no-highlight">573</i>&nbsp;            try {
<b class="nc"><i class="no-highlight">574</i>&nbsp;                board();</b>
<b class="nc"><i class="no-highlight">575</i>&nbsp;            } catch (IOException f) {</b>
<b class="nc"><i class="no-highlight">576</i>&nbsp;                f.printStackTrace();</b>
<b class="nc"><i class="no-highlight">577</i>&nbsp;            }</b>
<i class="no-highlight">578</i>&nbsp;        });
<i class="no-highlight">579</i>&nbsp;
<b class="nc"><i class="no-highlight">580</i>&nbsp;    if(!initialResources){</b>
<b class="nc"><i class="no-highlight">581</i>&nbsp;        if(myPlayer().getLeaderCards()[0].isActive()&amp;&amp;myPlayer().getLeaderCards()[0].getAction().equals(LeaderCardAction.EXTRADEPOT)){</b>
<b class="nc"><i class="no-highlight">582</i>&nbsp;            leader1.setImage(getImage(myPlayer().getLeaderCards()[0].getCardId(),true));</b>
<b class="nc"><i class="no-highlight">583</i>&nbsp;            leader1.setFitWidth(184);</b>
<b class="nc"><i class="no-highlight">584</i>&nbsp;            leader1.setFitHeight(271);</b>
<i class="no-highlight">585</i>&nbsp;
<b class="nc"><i class="no-highlight">586</i>&nbsp;            leader1.setOnDragOver(new EventHandler &lt;DragEvent&gt;() {</b>
<i class="no-highlight">587</i>&nbsp;                public void handle(DragEvent event) {
<i class="no-highlight">588</i>&nbsp;                    /* accept it only if it is  not dragged from the same node
<i class="no-highlight">589</i>&nbsp;                     * and if it has a string data */
<b class="nc"><i class="no-highlight">590</i>&nbsp;                    if (event.getDragboard().hasString()) {</b>
<i class="no-highlight">591</i>&nbsp;                        /* allow for both copying and moving, whatever user chooses */
<b class="nc"><i class="no-highlight">592</i>&nbsp;                        event.acceptTransferModes(TransferMode.COPY_OR_MOVE);</b>
<i class="no-highlight">593</i>&nbsp;                    }
<b class="nc"><i class="no-highlight">594</i>&nbsp;                    event.consume();</b>
<i class="no-highlight">595</i>&nbsp;                }
<i class="no-highlight">596</i>&nbsp;            });
<i class="no-highlight">597</i>&nbsp;
<b class="nc"><i class="no-highlight">598</i>&nbsp;            leader1.setOnDragDropped(new EventHandler &lt;DragEvent&gt;() {</b>
<i class="no-highlight">599</i>&nbsp;                public void handle(DragEvent event) {
<i class="no-highlight">600</i>&nbsp;                    /* if there is a string data on dragboard, read it and use it */
<b class="nc"><i class="no-highlight">601</i>&nbsp;                    Dragboard db = event.getDragboard();</b>
<b class="nc"><i class="no-highlight">602</i>&nbsp;                    boolean success = false;</b>
<b class="nc"><i class="no-highlight">603</i>&nbsp;                    if (db.hasString()) {</b>
<b class="nc"><i class="no-highlight">604</i>&nbsp;                        String resource = db.getString();</b>
<b class="nc"><i class="no-highlight">605</i>&nbsp;                            success=addResource(3,resource);</b>
<b class="nc"><i class="no-highlight">606</i>&nbsp;                            if(success)</b>
<b class="nc"><i class="no-highlight">607</i>&nbsp;                                gotResource(resource);</b>
<b class="nc"><i class="no-highlight">608</i>&nbsp;                            if(resourceNumber==0)</b>
<i class="no-highlight">609</i>&nbsp;                            {
<b class="nc"><i class="no-highlight">610</i>&nbsp;                                sendAction(new EndMarket());</b>
<b class="nc"><i class="no-highlight">611</i>&nbsp;                                marketBtn.setText(&quot;Open Market&quot;);</b>
<b class="nc"><i class="no-highlight">612</i>&nbsp;                                refresh();</b>
<b class="nc"><i class="no-highlight">613</i>&nbsp;                                resourcePicker.close();</b>
<i class="no-highlight">614</i>&nbsp;                                try {
<b class="nc"><i class="no-highlight">615</i>&nbsp;                                    board();</b>
<b class="nc"><i class="no-highlight">616</i>&nbsp;                                } catch (IOException e) {</b>
<b class="nc"><i class="no-highlight">617</i>&nbsp;                                    e.printStackTrace();</b>
<b class="nc"><i class="no-highlight">618</i>&nbsp;                                }</b>
<i class="no-highlight">619</i>&nbsp;                            }
<b class="nc"><i class="no-highlight">620</i>&nbsp;                            setResourceData(getResourceData(client.getUserInteraction().getGame().getMyPlayer()));</b>
<i class="no-highlight">621</i>&nbsp;                    }
<i class="no-highlight">622</i>&nbsp;                    /* let the source know whether the string was successfully
<i class="no-highlight">623</i>&nbsp;                     * transferred and used */
<b class="nc"><i class="no-highlight">624</i>&nbsp;                    event.setDropCompleted(success);</b>
<b class="nc"><i class="no-highlight">625</i>&nbsp;                    event.consume();</b>
<i class="no-highlight">626</i>&nbsp;                }
<i class="no-highlight">627</i>&nbsp;            });
<i class="no-highlight">628</i>&nbsp;        }
<b class="nc"><i class="no-highlight">629</i>&nbsp;        if(myPlayer().getLeaderCards()[1].isActive()&amp;&amp;myPlayer().getLeaderCards()[1].getAction().equals(LeaderCardAction.EXTRADEPOT)){</b>
<b class="nc"><i class="no-highlight">630</i>&nbsp;            leader2.setImage(getImage(myPlayer().getLeaderCards()[1].getCardId(),true));</b>
<b class="nc"><i class="no-highlight">631</i>&nbsp;            leader2.setFitWidth(184);</b>
<b class="nc"><i class="no-highlight">632</i>&nbsp;            leader2.setFitHeight(271);</b>
<i class="no-highlight">633</i>&nbsp;
<b class="nc"><i class="no-highlight">634</i>&nbsp;            leader2.setOnDragOver(new EventHandler &lt;DragEvent&gt;() {</b>
<i class="no-highlight">635</i>&nbsp;                public void handle(DragEvent event) {
<i class="no-highlight">636</i>&nbsp;                    /* accept it only if it is  not dragged from the same node
<i class="no-highlight">637</i>&nbsp;                     * and if it has a string data */
<b class="nc"><i class="no-highlight">638</i>&nbsp;                    if (event.getDragboard().hasString()) {</b>
<i class="no-highlight">639</i>&nbsp;                        /* allow for both copying and moving, whatever user chooses */
<b class="nc"><i class="no-highlight">640</i>&nbsp;                        event.acceptTransferModes(TransferMode.COPY_OR_MOVE);</b>
<i class="no-highlight">641</i>&nbsp;                    }
<b class="nc"><i class="no-highlight">642</i>&nbsp;                    event.consume();</b>
<i class="no-highlight">643</i>&nbsp;                }
<i class="no-highlight">644</i>&nbsp;            });
<i class="no-highlight">645</i>&nbsp;
<b class="nc"><i class="no-highlight">646</i>&nbsp;            leader2.setOnDragDropped(new EventHandler &lt;DragEvent&gt;() {</b>
<i class="no-highlight">647</i>&nbsp;                public void handle(DragEvent event) {
<i class="no-highlight">648</i>&nbsp;                    /* if there is a string data on dragboard, read it and use it */
<b class="nc"><i class="no-highlight">649</i>&nbsp;                    Dragboard db = event.getDragboard();</b>
<b class="nc"><i class="no-highlight">650</i>&nbsp;                    boolean success = false;</b>
<b class="nc"><i class="no-highlight">651</i>&nbsp;                    if (db.hasString()) {</b>
<b class="nc"><i class="no-highlight">652</i>&nbsp;                        String resource = db.getString();</b>
<b class="nc"><i class="no-highlight">653</i>&nbsp;                        success=addResource(4,resource);</b>
<b class="nc"><i class="no-highlight">654</i>&nbsp;                        if(success)</b>
<b class="nc"><i class="no-highlight">655</i>&nbsp;                            gotResource(resource);</b>
<b class="nc"><i class="no-highlight">656</i>&nbsp;                        if(resourceNumber==0)</b>
<i class="no-highlight">657</i>&nbsp;                        {
<b class="nc"><i class="no-highlight">658</i>&nbsp;                            sendAction(new EndMarket());</b>
<b class="nc"><i class="no-highlight">659</i>&nbsp;                            marketBtn.setText(&quot;Open Market&quot;);</b>
<b class="nc"><i class="no-highlight">660</i>&nbsp;                            refresh();</b>
<b class="nc"><i class="no-highlight">661</i>&nbsp;                            resourcePicker.close();</b>
<i class="no-highlight">662</i>&nbsp;                            try {
<b class="nc"><i class="no-highlight">663</i>&nbsp;                                board();</b>
<b class="nc"><i class="no-highlight">664</i>&nbsp;                            } catch (IOException e) {</b>
<b class="nc"><i class="no-highlight">665</i>&nbsp;                                e.printStackTrace();</b>
<b class="nc"><i class="no-highlight">666</i>&nbsp;                            }</b>
<i class="no-highlight">667</i>&nbsp;                        }
<b class="nc"><i class="no-highlight">668</i>&nbsp;                        setResourceData(getResourceData(client.getUserInteraction().getGame().getMyPlayer()));</b>
<i class="no-highlight">669</i>&nbsp;                    }
<i class="no-highlight">670</i>&nbsp;                    /* let the source know whether the string was successfully
<i class="no-highlight">671</i>&nbsp;                     * transferred and used */
<b class="nc"><i class="no-highlight">672</i>&nbsp;                    event.setDropCompleted(success);</b>
<b class="nc"><i class="no-highlight">673</i>&nbsp;                    event.consume();</b>
<i class="no-highlight">674</i>&nbsp;                }
<i class="no-highlight">675</i>&nbsp;            });
<i class="no-highlight">676</i>&nbsp;        }
<b class="nc"><i class="no-highlight">677</i>&nbsp;        Scene scene = new Scene(getResources);</b>
<b class="nc"><i class="no-highlight">678</i>&nbsp;        resourcePicker.setScene(scene);</b>
<b class="nc"><i class="no-highlight">679</i>&nbsp;        resourcePicker.showAndWait();</b>
<i class="no-highlight">680</i>&nbsp;        }
<i class="no-highlight">681</i>&nbsp;    }
<i class="no-highlight">682</i>&nbsp;
<i class="no-highlight">683</i>&nbsp;    /**
<i class="no-highlight">684</i>&nbsp;     * Allows the player to pay what he has to pay by clicking on the resource he wants to pay with.
<i class="no-highlight">685</i>&nbsp;     * Once what is due is paid the board is reloaded to update the resources shown.
<i class="no-highlight">686</i>&nbsp;     * @throws IOException          If there&#39;s a problem loading the FXML
<i class="no-highlight">687</i>&nbsp;     */
<i class="no-highlight">688</i>&nbsp;    @FXML
<i class="no-highlight">689</i>&nbsp;    protected void payResource() throws IOException{
<b class="nc"><i class="no-highlight">690</i>&nbsp;        Player currentPlayer = this.client.getUserInteraction().getGame().getMyPlayer();</b>
<b class="nc"><i class="no-highlight">691</i>&nbsp;        if(!(currentPlayer.getPossibleActions().contains(ActionType.PAY_RESOURCE_CARD)||currentPlayer.getPossibleActions().contains(ActionType.PAY_RESOURCE_PRODUCTION))){</b>
<b class="nc"><i class="no-highlight">692</i>&nbsp;            displayError(&quot;You don&#39;t have anything to pay now.&quot;);</b>
<i class="no-highlight">693</i>&nbsp;            return;
<i class="no-highlight">694</i>&nbsp;        }
<b class="nc"><i class="no-highlight">695</i>&nbsp;        RedResourceStack resourcesToPay = this.client.getUserInteraction().getGame().getMyPlayer().getTemporaryResources();</b>
<b class="nc"><i class="no-highlight">696</i>&nbsp;        resourceNumber=resourcesToPay.getResource(ResourceType.STONES)+resourcesToPay.getResource(ResourceType.SHIELDS)+resourcesToPay.getResource(ResourceType.COINS)+resourcesToPay.getResource(ResourceType.SERVANTS);</b>
<i class="no-highlight">697</i>&nbsp;
<i class="no-highlight">698</i>&nbsp;        Parent payResource;
<b class="nc"><i class="no-highlight">699</i>&nbsp;            FXMLLoader loader = new FXMLLoader(getClass().getResource(&quot;Assets/Fxml/PayResource.fxml&quot;));</b>
<b class="nc"><i class="no-highlight">700</i>&nbsp;            loader.setController(this);</b>
<b class="nc"><i class="no-highlight">701</i>&nbsp;            payResource = loader.load();</b>
<b class="nc"><i class="no-highlight">702</i>&nbsp;            Stage payResources = new Stage();</b>
<b class="nc"><i class="no-highlight">703</i>&nbsp;            payResources.initModality(Modality.APPLICATION_MODAL);</b>
<b class="nc"><i class="no-highlight">704</i>&nbsp;            payResources.setTitle(&quot;Pay Resource&quot;);</b>
<b class="nc"><i class="no-highlight">705</i>&nbsp;            payResources.setResizable(false);</b>
<i class="no-highlight">706</i>&nbsp;
<b class="nc"><i class="no-highlight">707</i>&nbsp;            Scene scene = new Scene(payResource);</b>
<i class="no-highlight">708</i>&nbsp;
<b class="nc"><i class="no-highlight">709</i>&nbsp;            remCoins.setText(String.valueOf(resourcesToPay.getResource(ResourceType.COINS)));</b>
<b class="nc"><i class="no-highlight">710</i>&nbsp;            remServants.setText(String.valueOf(resourcesToPay.getResource(ResourceType.SERVANTS)));</b>
<b class="nc"><i class="no-highlight">711</i>&nbsp;            remShields.setText(String.valueOf(resourcesToPay.getResource(ResourceType.SHIELDS)));</b>
<b class="nc"><i class="no-highlight">712</i>&nbsp;            remStones.setText(String.valueOf(resourcesToPay.getResource(ResourceType.STONES)));</b>
<i class="no-highlight">713</i>&nbsp;
<b class="nc"><i class="no-highlight">714</i>&nbsp;            refresh();</b>
<i class="no-highlight">715</i>&nbsp;
<b class="nc"><i class="no-highlight">716</i>&nbsp;        if(warehouse1.getImage()!=null)</b>
<b class="nc"><i class="no-highlight">717</i>&nbsp;            warehouse1.setOnMouseClicked(new EventHandler&lt;MouseEvent&gt;() {</b>
<i class="no-highlight">718</i>&nbsp;                @Override
<i class="no-highlight">719</i>&nbsp;                public void handle(MouseEvent event) {
<b class="nc"><i class="no-highlight">720</i>&nbsp;                    if(resourcesToPay.hasResource(currentPlayer.getWarehouse().getWarehouseDepots()[2].getResourceType())){</b>
<b class="nc"><i class="no-highlight">721</i>&nbsp;                        if(currentPlayer.getPossibleActions().contains(ActionType.PAY_RESOURCE_CARD))</b>
<b class="nc"><i class="no-highlight">722</i>&nbsp;                            sendAction(new PayResourceBuyCard(true,2,ResourceType.NONE));</b>
<b class="nc"><i class="no-highlight">723</i>&nbsp;                        else if(currentPlayer.getPossibleActions().contains(ActionType.PAY_RESOURCE_PRODUCTION))</b>
<b class="nc"><i class="no-highlight">724</i>&nbsp;                            sendAction(new PayResourceProduction(true,2,ResourceType.NONE));</b>
<b class="nc"><i class="no-highlight">725</i>&nbsp;                        gotResource(currentPlayer.getWarehouse().getWarehouseDepots()[2].getResourceType().toString());</b>
<b class="nc"><i class="no-highlight">726</i>&nbsp;                        warehouse1.setImage(null);</b>
<b class="nc"><i class="no-highlight">727</i>&nbsp;                        refresh();</b>
<b class="nc"><i class="no-highlight">728</i>&nbsp;                        if(resourceNumber==0)</b>
<i class="no-highlight">729</i>&nbsp;                        {
<b class="nc"><i class="no-highlight">730</i>&nbsp;                            payResources.close();</b>
<b class="nc"><i class="no-highlight">731</i>&nbsp;                            afterPayment();</b>
<i class="no-highlight">732</i>&nbsp;                        }
<i class="no-highlight">733</i>&nbsp;                    }else
<i class="no-highlight">734</i>&nbsp;                    {
<b class="nc"><i class="no-highlight">735</i>&nbsp;                        displayError(&quot;This resource is not required&quot;);</b>
<i class="no-highlight">736</i>&nbsp;                    }
<i class="no-highlight">737</i>&nbsp;                }
<i class="no-highlight">738</i>&nbsp;            });
<b class="nc"><i class="no-highlight">739</i>&nbsp;        if(warehouse21.getImage()!=null)</b>
<b class="nc"><i class="no-highlight">740</i>&nbsp;            warehouse21.setOnMouseClicked(new EventHandler&lt;MouseEvent&gt;() {</b>
<i class="no-highlight">741</i>&nbsp;                @Override
<i class="no-highlight">742</i>&nbsp;                public void handle(MouseEvent event) {
<b class="nc"><i class="no-highlight">743</i>&nbsp;                    if(resourcesToPay.hasResource(currentPlayer.getWarehouse().getWarehouseDepots()[1].getResourceType())){</b>
<b class="nc"><i class="no-highlight">744</i>&nbsp;                        if(currentPlayer.getPossibleActions().contains(ActionType.PAY_RESOURCE_CARD))</b>
<b class="nc"><i class="no-highlight">745</i>&nbsp;                            sendAction(new PayResourceBuyCard(true,1,ResourceType.NONE));</b>
<b class="nc"><i class="no-highlight">746</i>&nbsp;                        else if(currentPlayer.getPossibleActions().contains(ActionType.PAY_RESOURCE_PRODUCTION))</b>
<b class="nc"><i class="no-highlight">747</i>&nbsp;                            sendAction(new PayResourceProduction(true,1,ResourceType.NONE));</b>
<b class="nc"><i class="no-highlight">748</i>&nbsp;                        gotResource(currentPlayer.getWarehouse().getWarehouseDepots()[1].getResourceType().toString());</b>
<b class="nc"><i class="no-highlight">749</i>&nbsp;                        warehouse21.setImage(null);</b>
<b class="nc"><i class="no-highlight">750</i>&nbsp;                        refresh();</b>
<b class="nc"><i class="no-highlight">751</i>&nbsp;                        if(resourceNumber==0)</b>
<i class="no-highlight">752</i>&nbsp;                        {
<b class="nc"><i class="no-highlight">753</i>&nbsp;                            payResources.close();</b>
<b class="nc"><i class="no-highlight">754</i>&nbsp;                            afterPayment();</b>
<i class="no-highlight">755</i>&nbsp;                        }
<i class="no-highlight">756</i>&nbsp;                    }else
<i class="no-highlight">757</i>&nbsp;                    {
<b class="nc"><i class="no-highlight">758</i>&nbsp;                        displayError(&quot;This resource is not required&quot;);</b>
<i class="no-highlight">759</i>&nbsp;                    }
<i class="no-highlight">760</i>&nbsp;                }
<i class="no-highlight">761</i>&nbsp;            });
<b class="nc"><i class="no-highlight">762</i>&nbsp;        if(warehouse22.getImage()!=null)</b>
<b class="nc"><i class="no-highlight">763</i>&nbsp;            warehouse22.setOnMouseClicked(new EventHandler&lt;MouseEvent&gt;() {</b>
<i class="no-highlight">764</i>&nbsp;                @Override
<i class="no-highlight">765</i>&nbsp;                public void handle(MouseEvent event) {
<b class="nc"><i class="no-highlight">766</i>&nbsp;                    if(resourcesToPay.hasResource(currentPlayer.getWarehouse().getWarehouseDepots()[1].getResourceType())){</b>
<b class="nc"><i class="no-highlight">767</i>&nbsp;                        if(currentPlayer.getPossibleActions().contains(ActionType.PAY_RESOURCE_CARD))</b>
<b class="nc"><i class="no-highlight">768</i>&nbsp;                            sendAction(new PayResourceBuyCard(true,1,ResourceType.NONE));</b>
<b class="nc"><i class="no-highlight">769</i>&nbsp;                        else if(currentPlayer.getPossibleActions().contains(ActionType.PAY_RESOURCE_PRODUCTION))</b>
<b class="nc"><i class="no-highlight">770</i>&nbsp;                            sendAction(new PayResourceProduction(true,1,ResourceType.NONE));</b>
<b class="nc"><i class="no-highlight">771</i>&nbsp;                        gotResource(currentPlayer.getWarehouse().getWarehouseDepots()[1].getResourceType().toString());</b>
<b class="nc"><i class="no-highlight">772</i>&nbsp;                        warehouse22.setImage(null);</b>
<b class="nc"><i class="no-highlight">773</i>&nbsp;                        refresh();</b>
<b class="nc"><i class="no-highlight">774</i>&nbsp;                        if(resourceNumber==0)</b>
<i class="no-highlight">775</i>&nbsp;                        {
<b class="nc"><i class="no-highlight">776</i>&nbsp;                            payResources.close();</b>
<b class="nc"><i class="no-highlight">777</i>&nbsp;                            afterPayment();</b>
<i class="no-highlight">778</i>&nbsp;                        }
<i class="no-highlight">779</i>&nbsp;                    }else
<i class="no-highlight">780</i>&nbsp;                    {
<b class="nc"><i class="no-highlight">781</i>&nbsp;                        displayError(&quot;This resource is not required&quot;);</b>
<i class="no-highlight">782</i>&nbsp;                    }
<i class="no-highlight">783</i>&nbsp;                }
<i class="no-highlight">784</i>&nbsp;            });
<b class="nc"><i class="no-highlight">785</i>&nbsp;        if(warehouse31.getImage()!=null)</b>
<b class="nc"><i class="no-highlight">786</i>&nbsp;            warehouse31.setOnMouseClicked(new EventHandler&lt;MouseEvent&gt;() {</b>
<i class="no-highlight">787</i>&nbsp;                @Override
<i class="no-highlight">788</i>&nbsp;                public void handle(MouseEvent event) {
<b class="nc"><i class="no-highlight">789</i>&nbsp;                    if(resourcesToPay.hasResource(currentPlayer.getWarehouse().getWarehouseDepots()[0].getResourceType())){</b>
<b class="nc"><i class="no-highlight">790</i>&nbsp;                        if(currentPlayer.getPossibleActions().contains(ActionType.PAY_RESOURCE_CARD))</b>
<b class="nc"><i class="no-highlight">791</i>&nbsp;                            sendAction(new PayResourceBuyCard(true,0,ResourceType.NONE));</b>
<b class="nc"><i class="no-highlight">792</i>&nbsp;                        else if(currentPlayer.getPossibleActions().contains(ActionType.PAY_RESOURCE_PRODUCTION))</b>
<b class="nc"><i class="no-highlight">793</i>&nbsp;                            sendAction(new PayResourceProduction(true,0,ResourceType.NONE));</b>
<b class="nc"><i class="no-highlight">794</i>&nbsp;                        gotResource(currentPlayer.getWarehouse().getWarehouseDepots()[0].getResourceType().toString());</b>
<b class="nc"><i class="no-highlight">795</i>&nbsp;                        warehouse31.setImage(null);</b>
<b class="nc"><i class="no-highlight">796</i>&nbsp;                        refresh();</b>
<b class="nc"><i class="no-highlight">797</i>&nbsp;                        if(resourceNumber==0)</b>
<i class="no-highlight">798</i>&nbsp;                        {
<b class="nc"><i class="no-highlight">799</i>&nbsp;                            payResources.close();</b>
<b class="nc"><i class="no-highlight">800</i>&nbsp;                            afterPayment();</b>
<i class="no-highlight">801</i>&nbsp;                        }
<i class="no-highlight">802</i>&nbsp;                    }else
<i class="no-highlight">803</i>&nbsp;                    {
<b class="nc"><i class="no-highlight">804</i>&nbsp;                        displayError(&quot;This resource is not required&quot;);</b>
<i class="no-highlight">805</i>&nbsp;                    }
<i class="no-highlight">806</i>&nbsp;                }
<i class="no-highlight">807</i>&nbsp;            });
<b class="nc"><i class="no-highlight">808</i>&nbsp;        if(warehouse32.getImage()!=null)</b>
<b class="nc"><i class="no-highlight">809</i>&nbsp;            warehouse32.setOnMouseClicked(new EventHandler&lt;MouseEvent&gt;() {</b>
<i class="no-highlight">810</i>&nbsp;                @Override
<i class="no-highlight">811</i>&nbsp;                public void handle(MouseEvent event) {
<b class="nc"><i class="no-highlight">812</i>&nbsp;                    if(resourcesToPay.hasResource(currentPlayer.getWarehouse().getWarehouseDepots()[0].getResourceType())){</b>
<b class="nc"><i class="no-highlight">813</i>&nbsp;                        if(currentPlayer.getPossibleActions().contains(ActionType.PAY_RESOURCE_CARD))</b>
<b class="nc"><i class="no-highlight">814</i>&nbsp;                            sendAction(new PayResourceBuyCard(true,0,ResourceType.NONE));</b>
<b class="nc"><i class="no-highlight">815</i>&nbsp;                        else if(currentPlayer.getPossibleActions().contains(ActionType.PAY_RESOURCE_PRODUCTION))</b>
<b class="nc"><i class="no-highlight">816</i>&nbsp;                            sendAction(new PayResourceProduction(true,0,ResourceType.NONE));</b>
<b class="nc"><i class="no-highlight">817</i>&nbsp;                        gotResource(currentPlayer.getWarehouse().getWarehouseDepots()[0].getResourceType().toString());</b>
<b class="nc"><i class="no-highlight">818</i>&nbsp;                        warehouse32.setImage(null);</b>
<b class="nc"><i class="no-highlight">819</i>&nbsp;                        refresh();</b>
<b class="nc"><i class="no-highlight">820</i>&nbsp;                        if(resourceNumber==0)</b>
<i class="no-highlight">821</i>&nbsp;                        {
<b class="nc"><i class="no-highlight">822</i>&nbsp;                            payResources.close();</b>
<b class="nc"><i class="no-highlight">823</i>&nbsp;                            afterPayment();</b>
<i class="no-highlight">824</i>&nbsp;                        }
<i class="no-highlight">825</i>&nbsp;                    }else
<i class="no-highlight">826</i>&nbsp;                    {
<b class="nc"><i class="no-highlight">827</i>&nbsp;                        displayError(&quot;This resource is not required&quot;);</b>
<i class="no-highlight">828</i>&nbsp;                    }
<i class="no-highlight">829</i>&nbsp;                }
<i class="no-highlight">830</i>&nbsp;            });
<b class="nc"><i class="no-highlight">831</i>&nbsp;        if(warehouse33.getImage()!=null)</b>
<b class="nc"><i class="no-highlight">832</i>&nbsp;            warehouse33.setOnMouseClicked(new EventHandler&lt;MouseEvent&gt;() {</b>
<i class="no-highlight">833</i>&nbsp;                @Override
<i class="no-highlight">834</i>&nbsp;                public void handle(MouseEvent event) {
<b class="nc"><i class="no-highlight">835</i>&nbsp;                    if(resourcesToPay.hasResource(currentPlayer.getWarehouse().getWarehouseDepots()[0].getResourceType())){</b>
<b class="nc"><i class="no-highlight">836</i>&nbsp;                        if(currentPlayer.getPossibleActions().contains(ActionType.PAY_RESOURCE_CARD))</b>
<b class="nc"><i class="no-highlight">837</i>&nbsp;                            sendAction(new PayResourceBuyCard(true,0,ResourceType.NONE));</b>
<b class="nc"><i class="no-highlight">838</i>&nbsp;                        else if(currentPlayer.getPossibleActions().contains(ActionType.PAY_RESOURCE_PRODUCTION))</b>
<b class="nc"><i class="no-highlight">839</i>&nbsp;                            sendAction(new PayResourceProduction(true,0,ResourceType.NONE));</b>
<b class="nc"><i class="no-highlight">840</i>&nbsp;                        gotResource(currentPlayer.getWarehouse().getWarehouseDepots()[0].getResourceType().toString());</b>
<b class="nc"><i class="no-highlight">841</i>&nbsp;                        warehouse33.setImage(null);</b>
<b class="nc"><i class="no-highlight">842</i>&nbsp;                        refresh();</b>
<b class="nc"><i class="no-highlight">843</i>&nbsp;                        if(resourceNumber==0)</b>
<i class="no-highlight">844</i>&nbsp;                        {
<b class="nc"><i class="no-highlight">845</i>&nbsp;                            payResources.close();</b>
<b class="nc"><i class="no-highlight">846</i>&nbsp;                            afterPayment();</b>
<i class="no-highlight">847</i>&nbsp;                        }
<i class="no-highlight">848</i>&nbsp;                    }else
<i class="no-highlight">849</i>&nbsp;                    {
<b class="nc"><i class="no-highlight">850</i>&nbsp;                        displayError(&quot;This resource is not required&quot;);</b>
<i class="no-highlight">851</i>&nbsp;                    }
<i class="no-highlight">852</i>&nbsp;                }
<i class="no-highlight">853</i>&nbsp;            });
<i class="no-highlight">854</i>&nbsp;
<i class="no-highlight">855</i>&nbsp;
<i class="no-highlight">856</i>&nbsp;
<b class="nc"><i class="no-highlight">857</i>&nbsp;        if(Integer.parseInt(strongboxStones.getText())&gt;0)</b>
<b class="nc"><i class="no-highlight">858</i>&nbsp;            strongboxStonesClickable.setOnMouseClicked(new EventHandler&lt;MouseEvent&gt;() {</b>
<i class="no-highlight">859</i>&nbsp;                @Override
<i class="no-highlight">860</i>&nbsp;                public void handle(MouseEvent event) {
<b class="nc"><i class="no-highlight">861</i>&nbsp;                    if(resourcesToPay.hasResource(ResourceType.STONES)&amp;&amp;currentPlayer.getStrongbox().getStoredResources().hasResource(ResourceType.STONES)){</b>
<b class="nc"><i class="no-highlight">862</i>&nbsp;                        if(currentPlayer.getPossibleActions().contains(ActionType.PAY_RESOURCE_CARD))</b>
<b class="nc"><i class="no-highlight">863</i>&nbsp;                            sendAction(new PayResourceBuyCard(false,0,ResourceType.STONES));</b>
<b class="nc"><i class="no-highlight">864</i>&nbsp;                        else if(currentPlayer.getPossibleActions().contains(ActionType.PAY_RESOURCE_PRODUCTION))</b>
<b class="nc"><i class="no-highlight">865</i>&nbsp;                            sendAction(new PayResourceProduction(false,0,ResourceType.STONES));</b>
<b class="nc"><i class="no-highlight">866</i>&nbsp;                        gotResource(&quot;stones&quot;);</b>
<b class="nc"><i class="no-highlight">867</i>&nbsp;                        refresh();</b>
<b class="nc"><i class="no-highlight">868</i>&nbsp;                        if(resourceNumber==0)</b>
<i class="no-highlight">869</i>&nbsp;                        {
<b class="nc"><i class="no-highlight">870</i>&nbsp;                            payResources.close();</b>
<b class="nc"><i class="no-highlight">871</i>&nbsp;                            afterPayment();</b>
<i class="no-highlight">872</i>&nbsp;                        }
<i class="no-highlight">873</i>&nbsp;                    }else
<i class="no-highlight">874</i>&nbsp;                    {
<b class="nc"><i class="no-highlight">875</i>&nbsp;                        displayError(&quot;This resource is not required&quot;);</b>
<i class="no-highlight">876</i>&nbsp;                    }
<i class="no-highlight">877</i>&nbsp;                }
<i class="no-highlight">878</i>&nbsp;            });
<b class="nc"><i class="no-highlight">879</i>&nbsp;        if(Integer.parseInt(strongboxShields.getText())&gt;0)</b>
<b class="nc"><i class="no-highlight">880</i>&nbsp;            strongboxShieldsClickable.setOnMouseClicked(new EventHandler&lt;MouseEvent&gt;() {</b>
<i class="no-highlight">881</i>&nbsp;                @Override
<i class="no-highlight">882</i>&nbsp;                public void handle(MouseEvent event) {
<b class="nc"><i class="no-highlight">883</i>&nbsp;                    if(resourcesToPay.hasResource(ResourceType.SHIELDS)&amp;&amp;currentPlayer.getStrongbox().getStoredResources().hasResource(ResourceType.SHIELDS)){</b>
<b class="nc"><i class="no-highlight">884</i>&nbsp;                        if(currentPlayer.getPossibleActions().contains(ActionType.PAY_RESOURCE_CARD))</b>
<b class="nc"><i class="no-highlight">885</i>&nbsp;                            sendAction(new PayResourceBuyCard(false,0,ResourceType.SHIELDS));</b>
<b class="nc"><i class="no-highlight">886</i>&nbsp;                        else if(currentPlayer.getPossibleActions().contains(ActionType.PAY_RESOURCE_PRODUCTION))</b>
<b class="nc"><i class="no-highlight">887</i>&nbsp;                            sendAction(new PayResourceProduction(false,0,ResourceType.SHIELDS));</b>
<b class="nc"><i class="no-highlight">888</i>&nbsp;                        gotResource(&quot;shields&quot;);</b>
<b class="nc"><i class="no-highlight">889</i>&nbsp;                        refresh();</b>
<b class="nc"><i class="no-highlight">890</i>&nbsp;                        if(resourceNumber==0)</b>
<i class="no-highlight">891</i>&nbsp;                        {
<b class="nc"><i class="no-highlight">892</i>&nbsp;                            payResources.close();</b>
<b class="nc"><i class="no-highlight">893</i>&nbsp;                            afterPayment();</b>
<i class="no-highlight">894</i>&nbsp;                        }
<i class="no-highlight">895</i>&nbsp;                    }else
<i class="no-highlight">896</i>&nbsp;                    {
<b class="nc"><i class="no-highlight">897</i>&nbsp;                        displayError(&quot;This resource is not required&quot;);</b>
<i class="no-highlight">898</i>&nbsp;                    }
<i class="no-highlight">899</i>&nbsp;                }
<i class="no-highlight">900</i>&nbsp;            });
<b class="nc"><i class="no-highlight">901</i>&nbsp;        if(Integer.parseInt(strongboxServants.getText())&gt;0)</b>
<b class="nc"><i class="no-highlight">902</i>&nbsp;            strongboxServantsClickable.setOnMouseClicked(new EventHandler&lt;MouseEvent&gt;() {</b>
<i class="no-highlight">903</i>&nbsp;                @Override
<i class="no-highlight">904</i>&nbsp;                public void handle(MouseEvent event) {
<b class="nc"><i class="no-highlight">905</i>&nbsp;                    if(resourcesToPay.hasResource(ResourceType.SERVANTS)&amp;&amp;currentPlayer.getStrongbox().getStoredResources().hasResource(ResourceType.SERVANTS)){</b>
<b class="nc"><i class="no-highlight">906</i>&nbsp;                        if(currentPlayer.getPossibleActions().contains(ActionType.PAY_RESOURCE_CARD))</b>
<b class="nc"><i class="no-highlight">907</i>&nbsp;                            sendAction(new PayResourceBuyCard(false,0,ResourceType.SERVANTS));</b>
<b class="nc"><i class="no-highlight">908</i>&nbsp;                        else if(currentPlayer.getPossibleActions().contains(ActionType.PAY_RESOURCE_PRODUCTION))</b>
<b class="nc"><i class="no-highlight">909</i>&nbsp;                            sendAction(new PayResourceProduction(false,0,ResourceType.SERVANTS));</b>
<b class="nc"><i class="no-highlight">910</i>&nbsp;                        gotResource(&quot;servants&quot;);</b>
<b class="nc"><i class="no-highlight">911</i>&nbsp;                        refresh();</b>
<b class="nc"><i class="no-highlight">912</i>&nbsp;                        if(resourceNumber==0)</b>
<i class="no-highlight">913</i>&nbsp;                        {
<b class="nc"><i class="no-highlight">914</i>&nbsp;                            payResources.close();</b>
<b class="nc"><i class="no-highlight">915</i>&nbsp;                            afterPayment();</b>
<i class="no-highlight">916</i>&nbsp;                        }
<i class="no-highlight">917</i>&nbsp;                    }else
<i class="no-highlight">918</i>&nbsp;                    {
<b class="nc"><i class="no-highlight">919</i>&nbsp;                        displayError(&quot;This resource is not required&quot;);</b>
<i class="no-highlight">920</i>&nbsp;                    }
<i class="no-highlight">921</i>&nbsp;                }
<i class="no-highlight">922</i>&nbsp;            });
<b class="nc"><i class="no-highlight">923</i>&nbsp;        if(Integer.parseInt(strongboxCoins.getText())&gt;0)</b>
<b class="nc"><i class="no-highlight">924</i>&nbsp;            strongboxCoinsClickable.setOnMouseClicked(new EventHandler&lt;MouseEvent&gt;() {</b>
<i class="no-highlight">925</i>&nbsp;                @Override
<i class="no-highlight">926</i>&nbsp;                public void handle(MouseEvent event) {
<b class="nc"><i class="no-highlight">927</i>&nbsp;                    if(resourcesToPay.hasResource(ResourceType.COINS)&amp;&amp;currentPlayer.getStrongbox().getStoredResources().hasResource(ResourceType.COINS)){</b>
<b class="nc"><i class="no-highlight">928</i>&nbsp;                        if(currentPlayer.getPossibleActions().contains(ActionType.PAY_RESOURCE_CARD))</b>
<b class="nc"><i class="no-highlight">929</i>&nbsp;                            sendAction(new PayResourceBuyCard(false,0,ResourceType.COINS));</b>
<b class="nc"><i class="no-highlight">930</i>&nbsp;                        else if(currentPlayer.getPossibleActions().contains(ActionType.PAY_RESOURCE_PRODUCTION))</b>
<b class="nc"><i class="no-highlight">931</i>&nbsp;                            sendAction(new PayResourceProduction(false,0,ResourceType.COINS));</b>
<b class="nc"><i class="no-highlight">932</i>&nbsp;                        gotResource(&quot;coins&quot;);</b>
<b class="nc"><i class="no-highlight">933</i>&nbsp;                        refresh();</b>
<b class="nc"><i class="no-highlight">934</i>&nbsp;                        if(resourceNumber==0)</b>
<i class="no-highlight">935</i>&nbsp;                        {
<b class="nc"><i class="no-highlight">936</i>&nbsp;                            payResources.close();</b>
<b class="nc"><i class="no-highlight">937</i>&nbsp;                            afterPayment();</b>
<i class="no-highlight">938</i>&nbsp;                        }
<i class="no-highlight">939</i>&nbsp;                    }else
<i class="no-highlight">940</i>&nbsp;                    {
<b class="nc"><i class="no-highlight">941</i>&nbsp;                        displayError(&quot;This resource is not required&quot;);</b>
<i class="no-highlight">942</i>&nbsp;                    }
<i class="no-highlight">943</i>&nbsp;                }
<i class="no-highlight">944</i>&nbsp;            });
<i class="no-highlight">945</i>&nbsp;
<b class="nc"><i class="no-highlight">946</i>&nbsp;        payResources.setScene(scene);</b>
<b class="nc"><i class="no-highlight">947</i>&nbsp;        payResources.showAndWait();</b>
<i class="no-highlight">948</i>&nbsp;    }
<i class="no-highlight">949</i>&nbsp;
<i class="no-highlight">950</i>&nbsp;    /**
<i class="no-highlight">951</i>&nbsp;     * Called after a payment is completed for reloading the board and changing the text of the button if the user has to choose where to place a card
<i class="no-highlight">952</i>&nbsp;     */
<i class="no-highlight">953</i>&nbsp;    private void afterPayment(){
<i class="no-highlight">954</i>&nbsp;        try {
<b class="nc"><i class="no-highlight">955</i>&nbsp;            board();</b>
<b class="nc"><i class="no-highlight">956</i>&nbsp;        } catch (IOException e) {</b>
<b class="nc"><i class="no-highlight">957</i>&nbsp;            e.printStackTrace();</b>
<b class="nc"><i class="no-highlight">958</i>&nbsp;        }</b>
<b class="nc"><i class="no-highlight">959</i>&nbsp;        if(myPlayer().getPossibleActions().contains(ActionType.CHOOSE_CARD_SLOT)) {</b>
<b class="nc"><i class="no-highlight">960</i>&nbsp;            cardTableBtn.setText(&quot;Choose card slot&quot;);</b>
<i class="no-highlight">961</i>&nbsp;        }
<b class="nc"><i class="no-highlight">962</i>&nbsp;        if(myPlayer().getPossibleActions().contains(ActionType.CHOOSE_PRODUCTION_OUTPUT)||myPlayer().getPossibleActions().contains(ActionType.END_PAY_PRODUCTION)){</b>
<b class="nc"><i class="no-highlight">963</i>&nbsp;            if(productionOutput[0]||productionOutput[1]||productionOutput[2]){</b>
<b class="nc"><i class="no-highlight">964</i>&nbsp;                production.setText(&quot;Choose Output&quot;);</b>
<i class="no-highlight">965</i>&nbsp;            }
<i class="no-highlight">966</i>&nbsp;        }
<i class="no-highlight">967</i>&nbsp;    }
<i class="no-highlight">968</i>&nbsp;
<i class="no-highlight">969</i>&nbsp;    /**
<i class="no-highlight">970</i>&nbsp;     * This method handles the interaction for when the user has to choose something, depending on his possible action:
<i class="no-highlight">971</i>&nbsp;     * ? Choose Card Slot:      for choosing in which card slot to place the card
<i class="no-highlight">972</i>&nbsp;     * ? Activate Production:   for choosing which production power to activate and if the Basic Production power it&#39;s activated
<i class="no-highlight">973</i>&nbsp;     *                          the user is then prompted to choose which resources to activate the basic production which
<i class="no-highlight">974</i>&nbsp;     * ? Choose Production      for choosing the production output if a jolly production output has been activated
<i class="no-highlight">975</i>&nbsp;     *   output:
<i class="no-highlight">976</i>&nbsp;     * @throws IOException      If there&#39;s a problem loading the FXML
<i class="no-highlight">977</i>&nbsp;     */
<i class="no-highlight">978</i>&nbsp;    private void choose() throws IOException {
<i class="no-highlight">979</i>&nbsp;        Parent choose;
<b class="nc"><i class="no-highlight">980</i>&nbsp;        FXMLLoader loader = new FXMLLoader(getClass().getResource(&quot;Assets/Fxml/Chooser.fxml&quot;));</b>
<b class="nc"><i class="no-highlight">981</i>&nbsp;        loader.setController(this);</b>
<b class="nc"><i class="no-highlight">982</i>&nbsp;        choose= loader.load();</b>
<b class="nc"><i class="no-highlight">983</i>&nbsp;        chooser = new Stage();</b>
<b class="nc"><i class="no-highlight">984</i>&nbsp;        chooser.initModality(Modality.APPLICATION_MODAL);</b>
<b class="nc"><i class="no-highlight">985</i>&nbsp;        chooser.setTitle(&quot;Choose an option&quot;);</b>
<b class="nc"><i class="no-highlight">986</i>&nbsp;        if(myPlayer().getPossibleActions().contains(ActionType.CHOOSE_LEADER_CARD)){</b>
<i class="no-highlight">987</i>&nbsp;            //Whitemarble Ambiguity
<b class="nc"><i class="no-highlight">988</i>&nbsp;            cardTitle.setText(&quot;Choose White Marble to Activate&quot;);</b>
<i class="no-highlight">989</i>&nbsp;            ImageView card1,card2;
<b class="nc"><i class="no-highlight">990</i>&nbsp;            slotZero.setDisable(true);</b>
<b class="nc"><i class="no-highlight">991</i>&nbsp;            slotOne.setDisable(true);</b>
<b class="nc"><i class="no-highlight">992</i>&nbsp;            slotFour.setDisable(true);</b>
<b class="nc"><i class="no-highlight">993</i>&nbsp;            slotFive.setDisable(true);</b>
<i class="no-highlight">994</i>&nbsp;
<b class="nc"><i class="no-highlight">995</i>&nbsp;            submit.setDisable(true);</b>
<i class="no-highlight">996</i>&nbsp;
<b class="nc"><i class="no-highlight">997</i>&nbsp;            chooserPane.add(card1 = new ImageView(getImage(myPlayer().getLeaderCards()[0].getCardId(),true)),2,0);</b>
<b class="nc"><i class="no-highlight">998</i>&nbsp;            card1.setFitHeight(250);</b>
<b class="nc"><i class="no-highlight">999</i>&nbsp;            card1.setFitWidth(165);</b>
<i class="no-highlight">1000</i>&nbsp;
<b class="nc"><i class="no-highlight">1001</i>&nbsp;            chooserPane.add(card2 = new ImageView(getImage(myPlayer().getLeaderCards()[1].getCardId(),true)),3,0);</b>
<b class="nc"><i class="no-highlight">1002</i>&nbsp;            card2.setFitHeight(250);</b>
<b class="nc"><i class="no-highlight">1003</i>&nbsp;            card2.setFitWidth(165);</b>
<i class="no-highlight">1004</i>&nbsp;
<b class="nc"><i class="no-highlight">1005</i>&nbsp;            slotTwo.setOnAction(event -&gt; {</b>
<b class="nc"><i class="no-highlight">1006</i>&nbsp;                if(slotTwo.isArmed()){</b>
<b class="nc"><i class="no-highlight">1007</i>&nbsp;                    slotThree.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1008</i>&nbsp;                    submit.setDisable(!slotTwo.isSelected());</b>
<i class="no-highlight">1009</i>&nbsp;                }
<i class="no-highlight">1010</i>&nbsp;            });
<b class="nc"><i class="no-highlight">1011</i>&nbsp;            slotThree.setOnAction(event -&gt; {</b>
<b class="nc"><i class="no-highlight">1012</i>&nbsp;                if(slotThree.isArmed()){</b>
<b class="nc"><i class="no-highlight">1013</i>&nbsp;                    slotTwo.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1014</i>&nbsp;                    submit.setDisable(!slotThree.isSelected());</b>
<i class="no-highlight">1015</i>&nbsp;                }
<i class="no-highlight">1016</i>&nbsp;            });
<i class="no-highlight">1017</i>&nbsp;
<b class="nc"><i class="no-highlight">1018</i>&nbsp;            submit.setOnAction(event -&gt; {</b>
<b class="nc"><i class="no-highlight">1019</i>&nbsp;                cardTableBtn.setText(&quot;Open Card Table&quot;);</b>
<b class="nc"><i class="no-highlight">1020</i>&nbsp;                int slot=-9;</b>
<b class="nc"><i class="no-highlight">1021</i>&nbsp;                if(slotTwo.isSelected())</b>
<b class="nc"><i class="no-highlight">1022</i>&nbsp;                    slot=0;</b>
<b class="nc"><i class="no-highlight">1023</i>&nbsp;                if(slotThree.isSelected())</b>
<b class="nc"><i class="no-highlight">1024</i>&nbsp;                    slot=1;</b>
<b class="nc"><i class="no-highlight">1025</i>&nbsp;                sendAction(new ChooseLeaderCard(slot));</b>
<b class="nc"><i class="no-highlight">1026</i>&nbsp;                if(!myPlayer().getPossibleActions().contains(ActionType.CHOOSE_LEADER_CARD))</b>
<b class="nc"><i class="no-highlight">1027</i>&nbsp;                production.setText(&quot;Activate Production&quot;);</b>
<b class="nc"><i class="no-highlight">1028</i>&nbsp;                refresh();</b>
<b class="nc"><i class="no-highlight">1029</i>&nbsp;                chooser.close();</b>
<i class="no-highlight">1030</i>&nbsp;            });
<b class="nc"><i class="no-highlight">1031</i>&nbsp;        }</b>
<b class="nc"><i class="no-highlight">1032</i>&nbsp;        else if(myPlayer().getPossibleActions().contains(ActionType.CHOOSE_CARD_SLOT)){</b>
<i class="no-highlight">1033</i>&nbsp;
<b class="nc"><i class="no-highlight">1034</i>&nbsp;            cardTitle.setText(&quot;Choose a development card slot&quot;);</b>
<i class="no-highlight">1035</i>&nbsp;            ImageView card1,card2,card3,cardToAdd;
<i class="no-highlight">1036</i>&nbsp;
<b class="nc"><i class="no-highlight">1037</i>&nbsp;            submit.setDisable(true);</b>
<i class="no-highlight">1038</i>&nbsp;
<b class="nc"><i class="no-highlight">1039</i>&nbsp;            chooserPane.add(cardToAdd = new ImageView(getImage(temporaryCard.getCardId(),true)),5,0);</b>
<b class="nc"><i class="no-highlight">1040</i>&nbsp;            cardToAdd.setFitHeight(250);</b>
<b class="nc"><i class="no-highlight">1041</i>&nbsp;            cardToAdd.setFitWidth(165);</b>
<i class="no-highlight">1042</i>&nbsp;
<b class="nc"><i class="no-highlight">1043</i>&nbsp;            if(myPlayer().getSlots().getSlots()[0].isEmpty())</b>
<b class="nc"><i class="no-highlight">1044</i>&nbsp;                cardTitle1.setText(&quot;First\nSlot&quot;);</b>
<i class="no-highlight">1045</i>&nbsp;            else{
<b class="nc"><i class="no-highlight">1046</i>&nbsp;                chooserPane.add(card1 = new ImageView(getImage(myPlayer().getSlots().getSlots()[0].getFirstCard().getCardId(),true)),1,0);</b>
<b class="nc"><i class="no-highlight">1047</i>&nbsp;                card1.setFitHeight(250);</b>
<b class="nc"><i class="no-highlight">1048</i>&nbsp;                card1.setFitWidth(165);</b>
<i class="no-highlight">1049</i>&nbsp;            }
<b class="nc"><i class="no-highlight">1050</i>&nbsp;                if(myPlayer().getSlots().getSlots()[1].isEmpty())</b>
<b class="nc"><i class="no-highlight">1051</i>&nbsp;                    cardTitle2.setText(&quot;Second\nSlot&quot;);</b>
<i class="no-highlight">1052</i>&nbsp;                else{
<b class="nc"><i class="no-highlight">1053</i>&nbsp;                    chooserPane.add(card2 = new ImageView(getImage(myPlayer().getSlots().getSlots()[1].getFirstCard().getCardId(),true)),2,0);</b>
<b class="nc"><i class="no-highlight">1054</i>&nbsp;                    card2.setFitHeight(250);</b>
<b class="nc"><i class="no-highlight">1055</i>&nbsp;                    card2.setFitWidth(165);</b>
<i class="no-highlight">1056</i>&nbsp;                }
<b class="nc"><i class="no-highlight">1057</i>&nbsp;            if(myPlayer().getSlots().getSlots()[2].isEmpty())</b>
<b class="nc"><i class="no-highlight">1058</i>&nbsp;                cardTitle3.setText(&quot;Third\nSlot&quot;);</b>
<i class="no-highlight">1059</i>&nbsp;            else {
<b class="nc"><i class="no-highlight">1060</i>&nbsp;                chooserPane.add(card3 = new ImageView(getImage(myPlayer().getSlots().getSlots()[2].getFirstCard().getCardId(),true)),3,0);</b>
<b class="nc"><i class="no-highlight">1061</i>&nbsp;                card3.setFitHeight(250);</b>
<b class="nc"><i class="no-highlight">1062</i>&nbsp;                card3.setFitWidth(165);</b>
<i class="no-highlight">1063</i>&nbsp;            }
<i class="no-highlight">1064</i>&nbsp;
<i class="no-highlight">1065</i>&nbsp;
<b class="nc"><i class="no-highlight">1066</i>&nbsp;            if(myPlayer().getSlots().getSlots()[0].canAdd(temporaryCard))</b>
<b class="nc"><i class="no-highlight">1067</i>&nbsp;                slotOne.setDisable(false);</b>
<i class="no-highlight">1068</i>&nbsp;            else
<b class="nc"><i class="no-highlight">1069</i>&nbsp;                slotOne.setDisable(true);</b>
<b class="nc"><i class="no-highlight">1070</i>&nbsp;            if(myPlayer().getSlots().getSlots()[1].canAdd(temporaryCard))</b>
<b class="nc"><i class="no-highlight">1071</i>&nbsp;                slotTwo.setDisable(false);</b>
<i class="no-highlight">1072</i>&nbsp;            else
<b class="nc"><i class="no-highlight">1073</i>&nbsp;                slotTwo.setDisable(true);</b>
<b class="nc"><i class="no-highlight">1074</i>&nbsp;            if(myPlayer().getSlots().getSlots()[2].canAdd(temporaryCard))</b>
<b class="nc"><i class="no-highlight">1075</i>&nbsp;                slotThree.setDisable(false);</b>
<i class="no-highlight">1076</i>&nbsp;                    else
<b class="nc"><i class="no-highlight">1077</i>&nbsp;                slotThree.setDisable(true);</b>
<i class="no-highlight">1078</i>&nbsp;
<b class="nc"><i class="no-highlight">1079</i>&nbsp;                    slotZero.setDisable(true);</b>
<b class="nc"><i class="no-highlight">1080</i>&nbsp;                    slotFour.setDisable(true);</b>
<b class="nc"><i class="no-highlight">1081</i>&nbsp;                    slotFive.setDisable(true);</b>
<i class="no-highlight">1082</i>&nbsp;
<b class="nc"><i class="no-highlight">1083</i>&nbsp;                slotOne.setOnAction(event -&gt; {</b>
<b class="nc"><i class="no-highlight">1084</i>&nbsp;                if(slotOne.isArmed()){</b>
<b class="nc"><i class="no-highlight">1085</i>&nbsp;                    slotTwo.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1086</i>&nbsp;                    slotThree.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1087</i>&nbsp;                    submit.setDisable(!slotOne.isSelected());</b>
<i class="no-highlight">1088</i>&nbsp;                }
<i class="no-highlight">1089</i>&nbsp;            });
<b class="nc"><i class="no-highlight">1090</i>&nbsp;                slotTwo.setOnAction(event -&gt; {</b>
<b class="nc"><i class="no-highlight">1091</i>&nbsp;                if(slotTwo.isArmed()){</b>
<b class="nc"><i class="no-highlight">1092</i>&nbsp;                    slotOne.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1093</i>&nbsp;                    slotThree.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1094</i>&nbsp;                    submit.setDisable(!slotTwo.isSelected());</b>
<i class="no-highlight">1095</i>&nbsp;                }
<i class="no-highlight">1096</i>&nbsp;            });
<b class="nc"><i class="no-highlight">1097</i>&nbsp;                slotThree.setOnAction(event -&gt; {</b>
<b class="nc"><i class="no-highlight">1098</i>&nbsp;                if(slotThree.isArmed()){</b>
<b class="nc"><i class="no-highlight">1099</i>&nbsp;                    slotTwo.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1100</i>&nbsp;                    slotOne.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1101</i>&nbsp;                    submit.setDisable(!slotThree.isSelected());</b>
<i class="no-highlight">1102</i>&nbsp;                }
<i class="no-highlight">1103</i>&nbsp;            });
<i class="no-highlight">1104</i>&nbsp;
<b class="nc"><i class="no-highlight">1105</i>&nbsp;            submit.setOnAction(event -&gt; {</b>
<b class="nc"><i class="no-highlight">1106</i>&nbsp;                cardTableBtn.setText(&quot;Open Card Table&quot;);</b>
<b class="nc"><i class="no-highlight">1107</i>&nbsp;                int slot=-9;</b>
<b class="nc"><i class="no-highlight">1108</i>&nbsp;                if(slotOne.isSelected())</b>
<b class="nc"><i class="no-highlight">1109</i>&nbsp;                    slot=0;</b>
<b class="nc"><i class="no-highlight">1110</i>&nbsp;                if(slotTwo.isSelected())</b>
<b class="nc"><i class="no-highlight">1111</i>&nbsp;                    slot=1;</b>
<b class="nc"><i class="no-highlight">1112</i>&nbsp;                if(slotThree.isSelected())</b>
<b class="nc"><i class="no-highlight">1113</i>&nbsp;                    slot=2;</b>
<b class="nc"><i class="no-highlight">1114</i>&nbsp;                sendAction(new ChooseCardSlot(slot));</b>
<b class="nc"><i class="no-highlight">1115</i>&nbsp;                refresh();</b>
<b class="nc"><i class="no-highlight">1116</i>&nbsp;                chooser.close();</b>
<i class="no-highlight">1117</i>&nbsp;            });
<b class="nc"><i class="no-highlight">1118</i>&nbsp;        }</b>
<b class="nc"><i class="no-highlight">1119</i>&nbsp;        else if(myPlayer().getPossibleActions().contains(ActionType.ACTIVATE_PRODUCTION)){</b>
<i class="no-highlight">1120</i>&nbsp;
<b class="nc"><i class="no-highlight">1121</i>&nbsp;            cardTitle.setText(&quot;Choose the productions to activate&quot;);</b>
<b class="nc"><i class="no-highlight">1122</i>&nbsp;            AtomicReference&lt;Boolean&gt; basicProduction = new AtomicReference&lt;&gt;(false);</b>
<i class="no-highlight">1123</i>&nbsp;            ImageView card0,card1,card2,card4,card5;
<i class="no-highlight">1124</i>&nbsp;
<b class="nc"><i class="no-highlight">1125</i>&nbsp;            ArrayList&lt;ResourceType&gt; productionInputs = new ArrayList&lt;&gt;();</b>
<i class="no-highlight">1126</i>&nbsp;
<b class="nc"><i class="no-highlight">1127</i>&nbsp;            Boolean activations[] = new Boolean[5];</b>
<b class="nc"><i class="no-highlight">1128</i>&nbsp;            cardTitle3.setText(&quot;Basic\nProd&quot;);</b>
<b class="nc"><i class="no-highlight">1129</i>&nbsp;            if(myPlayer().getSlots().getSlots()[0].isEmpty())</b>
<i class="no-highlight">1130</i>&nbsp;            {
<b class="nc"><i class="no-highlight">1131</i>&nbsp;                chooserPane.add(card0 = new ImageView(getImage(60,false)),0,0);</b>
<b class="nc"><i class="no-highlight">1132</i>&nbsp;                card0.setPreserveRatio(true);</b>
<b class="nc"><i class="no-highlight">1133</i>&nbsp;                card0.setFitHeight(250);</b>
<b class="nc"><i class="no-highlight">1134</i>&nbsp;                card0.setFitWidth(165);</b>
<b class="nc"><i class="no-highlight">1135</i>&nbsp;                slotZero.setDisable(true);</b>
<i class="no-highlight">1136</i>&nbsp;            }else{
<b class="nc"><i class="no-highlight">1137</i>&nbsp;                chooserPane.add(card0 = new ImageView(getImage(myPlayer().getSlots().getSlots()[0].getFirstCard().getCardId(),true)),0,0);</b>
<b class="nc"><i class="no-highlight">1138</i>&nbsp;                card0.setPreserveRatio(true);</b>
<b class="nc"><i class="no-highlight">1139</i>&nbsp;                card0.setFitHeight(250);</b>
<b class="nc"><i class="no-highlight">1140</i>&nbsp;                card0.setFitWidth(165);</b>
<i class="no-highlight">1141</i>&nbsp;            }
<b class="nc"><i class="no-highlight">1142</i>&nbsp;            if(myPlayer().getSlots().getSlots()[1].isEmpty())</b>
<i class="no-highlight">1143</i>&nbsp;            {
<b class="nc"><i class="no-highlight">1144</i>&nbsp;                chooserPane.add(card1 = new ImageView(getImage(60,false)),1,0);</b>
<b class="nc"><i class="no-highlight">1145</i>&nbsp;                card1.setPreserveRatio(true);</b>
<b class="nc"><i class="no-highlight">1146</i>&nbsp;                card1.setFitHeight(250);</b>
<b class="nc"><i class="no-highlight">1147</i>&nbsp;                card1.setFitWidth(165);</b>
<b class="nc"><i class="no-highlight">1148</i>&nbsp;                slotOne.setDisable(true);</b>
<i class="no-highlight">1149</i>&nbsp;            }else{
<b class="nc"><i class="no-highlight">1150</i>&nbsp;                chooserPane.add(card1 = new ImageView(getImage(myPlayer().getSlots().getSlots()[1].getFirstCard().getCardId(),true)),1,0);</b>
<b class="nc"><i class="no-highlight">1151</i>&nbsp;                card1.setPreserveRatio(true);</b>
<b class="nc"><i class="no-highlight">1152</i>&nbsp;                card1.setFitHeight(250);</b>
<b class="nc"><i class="no-highlight">1153</i>&nbsp;                card1.setFitWidth(165);</b>
<i class="no-highlight">1154</i>&nbsp;            }
<b class="nc"><i class="no-highlight">1155</i>&nbsp;            if(myPlayer().getSlots().getSlots()[2].isEmpty())</b>
<i class="no-highlight">1156</i>&nbsp;            {
<b class="nc"><i class="no-highlight">1157</i>&nbsp;                chooserPane.add(card2 = new ImageView(getImage(60,false)),2,0);</b>
<b class="nc"><i class="no-highlight">1158</i>&nbsp;                card2.setPreserveRatio(true);</b>
<b class="nc"><i class="no-highlight">1159</i>&nbsp;                card2.setFitHeight(250);</b>
<b class="nc"><i class="no-highlight">1160</i>&nbsp;                card2.setFitWidth(165);</b>
<b class="nc"><i class="no-highlight">1161</i>&nbsp;                slotTwo.setDisable(true);</b>
<i class="no-highlight">1162</i>&nbsp;            }else{
<b class="nc"><i class="no-highlight">1163</i>&nbsp;                chooserPane.add(card2 = new ImageView(getImage(myPlayer().getSlots().getSlots()[2].getFirstCard().getCardId(),true)),2,0);</b>
<b class="nc"><i class="no-highlight">1164</i>&nbsp;                card2.setPreserveRatio(true);</b>
<b class="nc"><i class="no-highlight">1165</i>&nbsp;                card2.setFitHeight(250);</b>
<b class="nc"><i class="no-highlight">1166</i>&nbsp;                card2.setFitWidth(165);</b>
<i class="no-highlight">1167</i>&nbsp;            }
<b class="nc"><i class="no-highlight">1168</i>&nbsp;            if(myPlayer().getLeaderCards()[0].getAction().equals(LeaderCardAction.PRODUCTIONPOWER)&amp;&amp;myPlayer().getLeaderCards()[0].isActive())</b>
<i class="no-highlight">1169</i>&nbsp;            {
<b class="nc"><i class="no-highlight">1170</i>&nbsp;                chooserPane.add(card4 = new ImageView(getImage(myPlayer().getLeaderCards()[0].getCardId(),true)),4,0);</b>
<b class="nc"><i class="no-highlight">1171</i>&nbsp;                card4.setPreserveRatio(true);</b>
<b class="nc"><i class="no-highlight">1172</i>&nbsp;                card4.setFitHeight(250);</b>
<b class="nc"><i class="no-highlight">1173</i>&nbsp;                card4.setFitWidth(165);</b>
<i class="no-highlight">1174</i>&nbsp;            }else{
<b class="nc"><i class="no-highlight">1175</i>&nbsp;                chooserPane.add(card4 = new ImageView(getImage(60,false)),4,0);</b>
<b class="nc"><i class="no-highlight">1176</i>&nbsp;                card4.setPreserveRatio(true);</b>
<b class="nc"><i class="no-highlight">1177</i>&nbsp;                card4.setFitHeight(250);</b>
<b class="nc"><i class="no-highlight">1178</i>&nbsp;                card4.setFitWidth(165);</b>
<b class="nc"><i class="no-highlight">1179</i>&nbsp;                slotFour.setDisable(true);</b>
<i class="no-highlight">1180</i>&nbsp;            }
<b class="nc"><i class="no-highlight">1181</i>&nbsp;            if(myPlayer().getLeaderCards()[1].getAction().equals(LeaderCardAction.PRODUCTIONPOWER)&amp;&amp;myPlayer().getLeaderCards()[1].isActive())</b>
<i class="no-highlight">1182</i>&nbsp;            {
<b class="nc"><i class="no-highlight">1183</i>&nbsp;                chooserPane.add(card5 = new ImageView(getImage(myPlayer().getLeaderCards()[1].getCardId(),true)),5,0);</b>
<b class="nc"><i class="no-highlight">1184</i>&nbsp;                card5.setPreserveRatio(true);</b>
<b class="nc"><i class="no-highlight">1185</i>&nbsp;                card5.setFitHeight(250);</b>
<b class="nc"><i class="no-highlight">1186</i>&nbsp;                card5.setFitWidth(165);</b>
<i class="no-highlight">1187</i>&nbsp;            }else{
<b class="nc"><i class="no-highlight">1188</i>&nbsp;                chooserPane.add(card5 = new ImageView(getImage(60,false)),5,0);</b>
<b class="nc"><i class="no-highlight">1189</i>&nbsp;                card5.setPreserveRatio(true);</b>
<b class="nc"><i class="no-highlight">1190</i>&nbsp;                card5.setFitHeight(250);</b>
<b class="nc"><i class="no-highlight">1191</i>&nbsp;                card5.setFitWidth(165);</b>
<b class="nc"><i class="no-highlight">1192</i>&nbsp;                slotFive.setDisable(true);</b>
<i class="no-highlight">1193</i>&nbsp;            }
<i class="no-highlight">1194</i>&nbsp;
<i class="no-highlight">1195</i>&nbsp;
<b class="nc"><i class="no-highlight">1196</i>&nbsp;            submit.setOnAction(event -&gt; {</b>
<i class="no-highlight">1197</i>&nbsp;                //Basic production has been activated
<i class="no-highlight">1198</i>&nbsp;
<b class="nc"><i class="no-highlight">1199</i>&nbsp;                if(slotThree.isSelected()&amp;&amp;basicProduction.get()==false){</b>
<b class="nc"><i class="no-highlight">1200</i>&nbsp;                    productionOutput[0]=true;</b>
<i class="no-highlight">1201</i>&nbsp;
<b class="nc"><i class="no-highlight">1202</i>&nbsp;                    activations[0]=slotZero.isSelected();</b>
<b class="nc"><i class="no-highlight">1203</i>&nbsp;                    activations[1]=slotOne.isSelected();</b>
<b class="nc"><i class="no-highlight">1204</i>&nbsp;                    activations[2]=slotTwo.isSelected();</b>
<b class="nc"><i class="no-highlight">1205</i>&nbsp;                    activations[3]=productionOutput[1]=slotFour.isSelected();</b>
<b class="nc"><i class="no-highlight">1206</i>&nbsp;                    activations[4]=productionOutput[2]=slotFive.isSelected();</b>
<i class="no-highlight">1207</i>&nbsp;
<i class="no-highlight">1208</i>&nbsp;                    ImageView card3;
<b class="nc"><i class="no-highlight">1209</i>&nbsp;                    basicProduction.set(true);</b>
<b class="nc"><i class="no-highlight">1210</i>&nbsp;                    cardTitle.setText(&quot;Choose the input to use&quot;);</b>
<b class="nc"><i class="no-highlight">1211</i>&nbsp;                    slotZero.setSelected(false);slotZero.setDisable(false);</b>
<b class="nc"><i class="no-highlight">1212</i>&nbsp;                    slotOne.setSelected(false);slotOne.setDisable(false);</b>
<b class="nc"><i class="no-highlight">1213</i>&nbsp;                    slotTwo.setSelected(false);slotTwo.setDisable(false);</b>
<b class="nc"><i class="no-highlight">1214</i>&nbsp;                    slotThree.setSelected(false);slotTwo.setDisable(false);</b>
<b class="nc"><i class="no-highlight">1215</i>&nbsp;                    slotFour.setSelected(false);slotFour.setDisable(true);</b>
<b class="nc"><i class="no-highlight">1216</i>&nbsp;                    slotFive.setSelected(false);slotFive.setDisable(true);</b>
<b class="nc"><i class="no-highlight">1217</i>&nbsp;                    card0.setImage(getImage(ResourceType.STONES));</b>
<b class="nc"><i class="no-highlight">1218</i>&nbsp;                    card1.setImage(getImage(ResourceType.SERVANTS));</b>
<b class="nc"><i class="no-highlight">1219</i>&nbsp;                    card2.setImage(getImage(ResourceType.COINS));</b>
<b class="nc"><i class="no-highlight">1220</i>&nbsp;                    card4.setImage(null);</b>
<b class="nc"><i class="no-highlight">1221</i>&nbsp;                    card5.setImage(null);</b>
<b class="nc"><i class="no-highlight">1222</i>&nbsp;                    chooserPane.add(card3 = new ImageView(getImage(ResourceType.SHIELDS)),3,0);</b>
<b class="nc"><i class="no-highlight">1223</i>&nbsp;                    card0.setFitHeight(167);</b>
<b class="nc"><i class="no-highlight">1224</i>&nbsp;                    card0.setFitWidth(167);</b>
<b class="nc"><i class="no-highlight">1225</i>&nbsp;                    card1.setFitHeight(167);</b>
<b class="nc"><i class="no-highlight">1226</i>&nbsp;                    card1.setFitWidth(167);</b>
<b class="nc"><i class="no-highlight">1227</i>&nbsp;                    card2.setFitHeight(167);</b>
<b class="nc"><i class="no-highlight">1228</i>&nbsp;                    card2.setFitWidth(167);</b>
<b class="nc"><i class="no-highlight">1229</i>&nbsp;                    card3.setFitHeight(167);</b>
<b class="nc"><i class="no-highlight">1230</i>&nbsp;                    card3.setFitWidth(167);</b>
<b class="nc"><i class="no-highlight">1231</i>&nbsp;                    card0.setPreserveRatio(true);card1.setPreserveRatio(true);card2.setPreserveRatio(true);card3.setPreserveRatio(true);</b>
<b class="nc"><i class="no-highlight">1232</i>&nbsp;                    slotFour.setDisable(true);</b>
<b class="nc"><i class="no-highlight">1233</i>&nbsp;                }</b>
<b class="nc"><i class="no-highlight">1234</i>&nbsp;                else if(slotThree.isSelected()==false&amp;&amp;basicProduction.get()==false){</b>
<i class="no-highlight">1235</i>&nbsp;
<b class="nc"><i class="no-highlight">1236</i>&nbsp;                    productionOutput[0]=false;productionOutput[1]=slotFour.isSelected();productionOutput[2]=slotFive.isSelected();</b>
<b class="nc"><i class="no-highlight">1237</i>&nbsp;                    sendAction(new ActivateProduction(slotZero.isSelected(),slotOne.isSelected(),slotTwo.isSelected(),slotFour.isSelected(),slotFive.isSelected(),</b>
<b class="nc"><i class="no-highlight">1238</i>&nbsp;                            slotThree.isSelected(),productionInputs));</b>
<b class="nc"><i class="no-highlight">1239</i>&nbsp;                    refresh();</b>
<b class="nc"><i class="no-highlight">1240</i>&nbsp;                    chooser.close();</b>
<b class="nc"><i class="no-highlight">1241</i>&nbsp;                }else if(basicProduction.get()==true){</b>
<b class="nc"><i class="no-highlight">1242</i>&nbsp;                    int selected = 0;</b>
<b class="nc"><i class="no-highlight">1243</i>&nbsp;                    selected+=slotZero.isSelected()?1:0;</b>
<b class="nc"><i class="no-highlight">1244</i>&nbsp;                    selected+=slotOne.isSelected()?1:0;</b>
<b class="nc"><i class="no-highlight">1245</i>&nbsp;                    selected+=slotTwo.isSelected()?1:0;</b>
<b class="nc"><i class="no-highlight">1246</i>&nbsp;                    selected+=slotThree.isSelected()?1:0;</b>
<b class="nc"><i class="no-highlight">1247</i>&nbsp;                    if(selected==2||selected==1){</b>
<i class="no-highlight">1248</i>&nbsp;                        {
<b class="nc"><i class="no-highlight">1249</i>&nbsp;                        if(slotZero.isSelected()){</b>
<b class="nc"><i class="no-highlight">1250</i>&nbsp;                            productionInputs.add(ResourceType.STONES);</b>
<b class="nc"><i class="no-highlight">1251</i>&nbsp;                            if(selected==1)</b>
<b class="nc"><i class="no-highlight">1252</i>&nbsp;                                productionInputs.add(ResourceType.STONES);</b>
<i class="no-highlight">1253</i>&nbsp;                        }
<b class="nc"><i class="no-highlight">1254</i>&nbsp;                        if(slotOne.isSelected()){</b>
<b class="nc"><i class="no-highlight">1255</i>&nbsp;                            productionInputs.add(ResourceType.SERVANTS);</b>
<b class="nc"><i class="no-highlight">1256</i>&nbsp;                            if(selected==1)</b>
<b class="nc"><i class="no-highlight">1257</i>&nbsp;                                productionInputs.add(ResourceType.SERVANTS);</b>
<i class="no-highlight">1258</i>&nbsp;                        }
<b class="nc"><i class="no-highlight">1259</i>&nbsp;                        if(slotTwo.isSelected()){</b>
<b class="nc"><i class="no-highlight">1260</i>&nbsp;                            productionInputs.add(ResourceType.COINS);</b>
<b class="nc"><i class="no-highlight">1261</i>&nbsp;                            if(selected==1)</b>
<b class="nc"><i class="no-highlight">1262</i>&nbsp;                                productionInputs.add(ResourceType.COINS);</b>
<i class="no-highlight">1263</i>&nbsp;                        }
<b class="nc"><i class="no-highlight">1264</i>&nbsp;                        if(slotThree.isSelected()){</b>
<b class="nc"><i class="no-highlight">1265</i>&nbsp;                            productionInputs.add(ResourceType.SHIELDS);</b>
<b class="nc"><i class="no-highlight">1266</i>&nbsp;                            if(selected==1)</b>
<b class="nc"><i class="no-highlight">1267</i>&nbsp;                                productionInputs.add(ResourceType.SHIELDS);</b>
<i class="no-highlight">1268</i>&nbsp;                        }
<i class="no-highlight">1269</i>&nbsp;
<b class="nc"><i class="no-highlight">1270</i>&nbsp;                        sendAction(new ActivateProduction(activations[0],activations[1],activations[2],activations[3],activations[4],true,productionInputs));</b>
<b class="nc"><i class="no-highlight">1271</i>&nbsp;                        refresh();</b>
<b class="nc"><i class="no-highlight">1272</i>&nbsp;                        production.setText(&quot;Choose Output&quot;);</b>
<b class="nc"><i class="no-highlight">1273</i>&nbsp;                        chooser.close();</b>
<i class="no-highlight">1274</i>&nbsp;                        }
<i class="no-highlight">1275</i>&nbsp;                    }else {
<b class="nc"><i class="no-highlight">1276</i>&nbsp;                        displayError(&quot;Please select 2 inputs, not &quot;+selected);</b>
<b class="nc"><i class="no-highlight">1277</i>&nbsp;                        chooser.close();</b>
<i class="no-highlight">1278</i>&nbsp;                    }
<i class="no-highlight">1279</i>&nbsp;                }
<i class="no-highlight">1280</i>&nbsp;
<i class="no-highlight">1281</i>&nbsp;            });
<b class="nc"><i class="no-highlight">1282</i>&nbsp;        }</b>
<b class="nc"><i class="no-highlight">1283</i>&nbsp;        else if(myPlayer().getPossibleActions().contains(ActionType.CHOOSE_PRODUCTION_OUTPUT)){</b>
<b class="nc"><i class="no-highlight">1284</i>&nbsp;            if(productionOutput[0]||productionOutput[1]||productionOutput[2]){</b>
<b class="nc"><i class="no-highlight">1285</i>&nbsp;                cardTitle.setText(&quot;Choose the production output&quot;);</b>
<i class="no-highlight">1286</i>&nbsp;
<i class="no-highlight">1287</i>&nbsp;                ArrayList&lt;ResourceType&gt; basicArray,leader1Array,leader2Array;
<b class="nc"><i class="no-highlight">1288</i>&nbsp;                basicArray=new ArrayList&lt;&gt;();leader1Array=new ArrayList&lt;&gt;();leader2Array=new ArrayList&lt;&gt;();</b>
<b class="nc"><i class="no-highlight">1289</i>&nbsp;                ObservableList&lt;String&gt; resources = FXCollections.observableArrayList(&quot;Coins&quot;,&quot;Servants&quot;,&quot;Shields&quot;,&quot;Stones&quot;);</b>
<i class="no-highlight">1290</i>&nbsp;                ChoiceBox basicProd,leader1,leader2;
<b class="nc"><i class="no-highlight">1291</i>&nbsp;                slotZero.setDisable(true);slotOne.setDisable(true);slotTwo.setDisable(true);slotThree.setDisable(true);slotFour.setDisable(true);slotFive.setDisable(true);</b>
<b class="nc"><i class="no-highlight">1292</i>&nbsp;                basicProd=new ChoiceBox(resources);leader1=new ChoiceBox(resources);leader2=new ChoiceBox(resources);</b>
<b class="nc"><i class="no-highlight">1293</i>&nbsp;                cardTitle2.setText(null);</b>
<b class="nc"><i class="no-highlight">1294</i>&nbsp;                if(productionOutput[0])</b>
<i class="no-highlight">1295</i>&nbsp;                {
<b class="nc"><i class="no-highlight">1296</i>&nbsp;                    cardTitle1.setText(&quot;Basic\nProd&quot;);</b>
<b class="nc"><i class="no-highlight">1297</i>&nbsp;                    chooserPane.add(basicProd,2,0);</b>
<i class="no-highlight">1298</i>&nbsp;                }
<i class="no-highlight">1299</i>&nbsp;                else
<b class="nc"><i class="no-highlight">1300</i>&nbsp;                    cardTitle1.setText(null);</b>
<b class="nc"><i class="no-highlight">1301</i>&nbsp;                if(productionOutput[1]||productionOutput[2])</b>
<b class="nc"><i class="no-highlight">1302</i>&nbsp;                    cardTitle3.setText(&quot;Leader\nCards&quot;);</b>
<i class="no-highlight">1303</i>&nbsp;                else
<b class="nc"><i class="no-highlight">1304</i>&nbsp;                    cardTitle3.setText(null);</b>
<b class="nc"><i class="no-highlight">1305</i>&nbsp;                if(productionOutput[1])</b>
<i class="no-highlight">1306</i>&nbsp;                {
<b class="nc"><i class="no-highlight">1307</i>&nbsp;                    chooserPane.add(leader1,4,0);</b>
<i class="no-highlight">1308</i>&nbsp;                }
<i class="no-highlight">1309</i>&nbsp;                else
<b class="nc"><i class="no-highlight">1310</i>&nbsp;                    cardTitle1.setText(null);</b>
<b class="nc"><i class="no-highlight">1311</i>&nbsp;                if(productionOutput[2])</b>
<i class="no-highlight">1312</i>&nbsp;                {
<b class="nc"><i class="no-highlight">1313</i>&nbsp;                    cardTitle1.setText(&quot;Basic\nProd&quot;);</b>
<b class="nc"><i class="no-highlight">1314</i>&nbsp;                    chooserPane.add(leader2,5,0);</b>
<i class="no-highlight">1315</i>&nbsp;                }
<i class="no-highlight">1316</i>&nbsp;                else
<b class="nc"><i class="no-highlight">1317</i>&nbsp;                    cardTitle1.setText(null);</b>
<b class="nc"><i class="no-highlight">1318</i>&nbsp;                submit.setOnAction(event -&gt; {</b>
<b class="nc"><i class="no-highlight">1319</i>&nbsp;                    ResourceType resBasic=null,resLeader1=null,resLeader2=null;</b>
<b class="nc"><i class="no-highlight">1320</i>&nbsp;                    if(productionOutput[0])</b>
<b class="nc"><i class="no-highlight">1321</i>&nbsp;                        if(basicProd.getValue()!=null){</b>
<b class="nc"><i class="no-highlight">1322</i>&nbsp;                            resBasic=stringToResource(basicProd.getValue().toString());</b>
<b class="nc"><i class="no-highlight">1323</i>&nbsp;                            basicArray.add(resBasic);</b>
<i class="no-highlight">1324</i>&nbsp;                        }
<i class="no-highlight">1325</i>&nbsp;                        else
<b class="nc"><i class="no-highlight">1326</i>&nbsp;                            displayError(&quot;You must choose the basic production output!&quot;);</b>
<b class="nc"><i class="no-highlight">1327</i>&nbsp;                    if(productionOutput[1])</b>
<b class="nc"><i class="no-highlight">1328</i>&nbsp;                        if(basicProd.getValue()!=null){</b>
<b class="nc"><i class="no-highlight">1329</i>&nbsp;                            resLeader1=stringToResource(basicProd.getValue().toString());</b>
<b class="nc"><i class="no-highlight">1330</i>&nbsp;                            leader1Array.add(resLeader1);</b>
<i class="no-highlight">1331</i>&nbsp;                        }
<i class="no-highlight">1332</i>&nbsp;                        else
<b class="nc"><i class="no-highlight">1333</i>&nbsp;                            displayError(&quot;You must choose the output for Leader card 1!&quot;);</b>
<b class="nc"><i class="no-highlight">1334</i>&nbsp;                    if(productionOutput[2])</b>
<b class="nc"><i class="no-highlight">1335</i>&nbsp;                        if(basicProd.getValue()!=null){</b>
<b class="nc"><i class="no-highlight">1336</i>&nbsp;                            resLeader2=stringToResource(basicProd.getValue().toString());</b>
<b class="nc"><i class="no-highlight">1337</i>&nbsp;                            leader2Array.add(resLeader2);</b>
<i class="no-highlight">1338</i>&nbsp;                        }
<i class="no-highlight">1339</i>&nbsp;                        else
<b class="nc"><i class="no-highlight">1340</i>&nbsp;                            displayError(&quot;You must choose the output for Leader card 2!&quot;);</b>
<b class="nc"><i class="no-highlight">1341</i>&nbsp;                    if(     (productionOutput[0]&amp;&amp;basicProd.getValue()!=null)||!productionOutput[0]&amp;&amp;</b>
<b class="nc"><i class="no-highlight">1342</i>&nbsp;                            (productionOutput[1]&amp;&amp;leader1.getValue()!=null)||!productionOutput[1]&amp;&amp;</b>
<b class="nc"><i class="no-highlight">1343</i>&nbsp;                            (productionOutput[2]&amp;&amp;leader2.getValue()!=null)||!productionOutput[2]) {</b>
<b class="nc"><i class="no-highlight">1344</i>&nbsp;                        ChooseProductionOutput productionOutputAction = new ChooseProductionOutput();</b>
<b class="nc"><i class="no-highlight">1345</i>&nbsp;                        productionOutputAction.setBasicProductionOutput(basicArray);</b>
<b class="nc"><i class="no-highlight">1346</i>&nbsp;                        productionOutputAction.setBasicProduction(productionOutput[0]);</b>
<b class="nc"><i class="no-highlight">1347</i>&nbsp;                        productionOutputAction.setFirstLeaderCard(productionOutput[1]);</b>
<b class="nc"><i class="no-highlight">1348</i>&nbsp;                        productionOutputAction.setFirstLeaderCardOutput(leader1Array);</b>
<b class="nc"><i class="no-highlight">1349</i>&nbsp;                        productionOutputAction.setSecondLeaderCard(productionOutput[2]);</b>
<b class="nc"><i class="no-highlight">1350</i>&nbsp;                        productionOutputAction.setSecondLeaderCardOutput(leader2Array);</b>
<i class="no-highlight">1351</i>&nbsp;
<b class="nc"><i class="no-highlight">1352</i>&nbsp;                        production.setText(&quot;Activate Production&quot;);</b>
<b class="nc"><i class="no-highlight">1353</i>&nbsp;                        sendAction(productionOutputAction);</b>
<b class="nc"><i class="no-highlight">1354</i>&nbsp;                        chooser.close();</b>
<b class="nc"><i class="no-highlight">1355</i>&nbsp;                        refresh();</b>
<i class="no-highlight">1356</i>&nbsp;                    }
<i class="no-highlight">1357</i>&nbsp;                });
<b class="nc"><i class="no-highlight">1358</i>&nbsp;            }else</b>
<i class="no-highlight">1359</i>&nbsp;            {
<b class="nc"><i class="no-highlight">1360</i>&nbsp;                ArrayList&lt;ResourceType&gt; emptyResource = new ArrayList&lt;&gt;();</b>
<b class="nc"><i class="no-highlight">1361</i>&nbsp;                ChooseProductionOutput productionOutputAction = new ChooseProductionOutput();</b>
<b class="nc"><i class="no-highlight">1362</i>&nbsp;                productionOutputAction.setBasicProductionOutput(null);</b>
<b class="nc"><i class="no-highlight">1363</i>&nbsp;                productionOutputAction.setBasicProduction(false);</b>
<b class="nc"><i class="no-highlight">1364</i>&nbsp;                productionOutputAction.setFirstLeaderCard(false);</b>
<b class="nc"><i class="no-highlight">1365</i>&nbsp;                productionOutputAction.setFirstLeaderCardOutput(null);</b>
<b class="nc"><i class="no-highlight">1366</i>&nbsp;                productionOutputAction.setSecondLeaderCard(false);</b>
<b class="nc"><i class="no-highlight">1367</i>&nbsp;                productionOutputAction.setSecondLeaderCardOutput(null);</b>
<b class="nc"><i class="no-highlight">1368</i>&nbsp;                production.setText(&quot;Activate Production&quot;);</b>
<b class="nc"><i class="no-highlight">1369</i>&nbsp;                sendAction(productionOutputAction);</b>
<b class="nc"><i class="no-highlight">1370</i>&nbsp;                refresh();</b>
<i class="no-highlight">1371</i>&nbsp;                return;
<i class="no-highlight">1372</i>&nbsp;            }
<i class="no-highlight">1373</i>&nbsp;
<i class="no-highlight">1374</i>&nbsp;        }
<i class="no-highlight">1375</i>&nbsp;
<b class="nc"><i class="no-highlight">1376</i>&nbsp;        Scene scene = new Scene(choose);</b>
<b class="nc"><i class="no-highlight">1377</i>&nbsp;        chooser.setScene(scene);</b>
<b class="nc"><i class="no-highlight">1378</i>&nbsp;        chooser.showAndWait();</b>
<i class="no-highlight">1379</i>&nbsp;    }
<i class="no-highlight">1380</i>&nbsp;
<i class="no-highlight">1381</i>&nbsp;    /**
<i class="no-highlight">1382</i>&nbsp;     * This method opens the card board and allows to buy a card if it&#39;s clicked and the user can afford it as per game rules.
<i class="no-highlight">1383</i>&nbsp;     * If a buy card is successful the card value is set in temporaryCard for having it shown when the user has to choose the slot.
<i class="no-highlight">1384</i>&nbsp;     * @throws Exception    If there&#39;s a problem reading the FXML
<i class="no-highlight">1385</i>&nbsp;     */
<i class="no-highlight">1386</i>&nbsp;    @FXML
<i class="no-highlight">1387</i>&nbsp;    private void cardPicker() throws IOException, ModelException {
<b class="nc"><i class="no-highlight">1388</i>&nbsp;        if(cardTableBtn.getText().equals(&quot;Choose card slot&quot;))</b>
<i class="no-highlight">1389</i>&nbsp;            try {
<b class="nc"><i class="no-highlight">1390</i>&nbsp;                choose();</b>
<i class="no-highlight">1391</i>&nbsp;                return;
<b class="nc"><i class="no-highlight">1392</i>&nbsp;            } catch (IOException e) {</b>
<b class="nc"><i class="no-highlight">1393</i>&nbsp;                e.printStackTrace();</b>
<i class="no-highlight">1394</i>&nbsp;            }
<i class="no-highlight">1395</i>&nbsp;        Parent developmentCardBoard;
<b class="nc"><i class="no-highlight">1396</i>&nbsp;        FXMLLoader loader = new FXMLLoader(getClass().getResource(&quot;Assets/Fxml/CardBoard.fxml&quot;));</b>
<b class="nc"><i class="no-highlight">1397</i>&nbsp;        loader.setController(this);</b>
<b class="nc"><i class="no-highlight">1398</i>&nbsp;        developmentCardBoard = loader.load();</b>
<b class="nc"><i class="no-highlight">1399</i>&nbsp;        cardPicker = new Stage();</b>
<b class="nc"><i class="no-highlight">1400</i>&nbsp;        cardPicker.initModality(Modality.APPLICATION_MODAL);</b>
<b class="nc"><i class="no-highlight">1401</i>&nbsp;        cardPicker.setTitle(&quot;Card Board&quot;);</b>
<b class="nc"><i class="no-highlight">1402</i>&nbsp;        card = new ImageView[4][3];</b>
<i class="no-highlight">1403</i>&nbsp;            //Handling of buy mode in game
<b class="nc"><i class="no-highlight">1404</i>&nbsp;            cardTitle.setText(&quot;Click on the card you want to buy&quot;);</b>
<b class="nc"><i class="no-highlight">1405</i>&nbsp;            for(int cardColumn=0;cardColumn&lt;4;cardColumn++)</b>
<b class="nc"><i class="no-highlight">1406</i>&nbsp;                for(int cardRow=0;cardRow&lt;3;cardRow++)</b>
<i class="no-highlight">1407</i>&nbsp;                {
<b class="nc"><i class="no-highlight">1408</i>&nbsp;                    if(this.client.getUserInteraction().getGame().getDevelopmentCardTable().getDeck(cardRow,cardColumn).isEmpty())</b>
<b class="nc"><i class="no-highlight">1409</i>&nbsp;                        cardPane.add(card[cardColumn][cardRow] = new ImageView(),cardColumn,cardRow);</b>
<i class="no-highlight">1410</i>&nbsp;                    else
<b class="nc"><i class="no-highlight">1411</i>&nbsp;                        cardPane.add(card[cardColumn][cardRow] = new ImageView(super.getImage(this.client.getUserInteraction().getGame().getDevelopmentCardTable().getTopCardFromDeck(cardRow,cardColumn).getCardId(),true)),cardColumn,cardRow);</b>
<b class="nc"><i class="no-highlight">1412</i>&nbsp;                    card[cardColumn][cardRow].setCursor(Cursor.HAND);</b>
<b class="nc"><i class="no-highlight">1413</i>&nbsp;                    card[cardColumn][cardRow].setFitHeight(190);</b>
<b class="nc"><i class="no-highlight">1414</i>&nbsp;                    card[cardColumn][cardRow].setFitWidth(125);</b>
<b class="nc"><i class="no-highlight">1415</i>&nbsp;                    int finalCardColumn = cardColumn;</b>
<b class="nc"><i class="no-highlight">1416</i>&nbsp;                    int finalCardRow = cardRow;</b>
<b class="nc"><i class="no-highlight">1417</i>&nbsp;                    card[cardColumn][cardRow].setOnMouseClicked(new EventHandler&lt;MouseEvent&gt;() {</b>
<i class="no-highlight">1418</i>&nbsp;                        @Override
<i class="no-highlight">1419</i>&nbsp;                        public void handle(MouseEvent event) {
<i class="no-highlight">1420</i>&nbsp;                            try {
<b class="nc"><i class="no-highlight">1421</i>&nbsp;                                temporaryCard=getClientConnection().getClient().getUserInteraction().getGame().getDevelopmentCardTable().getTopCardFromDeck(finalCardRow,finalCardColumn);</b>
<b class="nc"><i class="no-highlight">1422</i>&nbsp;                            } catch (ModelException e) {</b>
<b class="nc"><i class="no-highlight">1423</i>&nbsp;                                e.printStackTrace();</b>
<b class="nc"><i class="no-highlight">1424</i>&nbsp;                            }</b>
<b class="nc"><i class="no-highlight">1425</i>&nbsp;                            sendAction(new BuyCard(finalCardRow,finalCardColumn));</b>
<b class="nc"><i class="no-highlight">1426</i>&nbsp;                                    cardPicker.close();</b>
<i class="no-highlight">1427</i>&nbsp;                            }
<i class="no-highlight">1428</i>&nbsp;                    });
<i class="no-highlight">1429</i>&nbsp;                }
<i class="no-highlight">1430</i>&nbsp;
<b class="nc"><i class="no-highlight">1431</i>&nbsp;        button.setOnAction(e-&gt;cardPicker.close());</b>
<b class="nc"><i class="no-highlight">1432</i>&nbsp;        Scene scene = new Scene(developmentCardBoard);</b>
<b class="nc"><i class="no-highlight">1433</i>&nbsp;        cardPicker.setScene(scene);</b>
<b class="nc"><i class="no-highlight">1434</i>&nbsp;        cardPicker.showAndWait();</b>
<i class="no-highlight">1435</i>&nbsp;    }
<i class="no-highlight">1436</i>&nbsp;
<i class="no-highlight">1437</i>&nbsp;    /**
<i class="no-highlight">1438</i>&nbsp;     * The market screen, where the user can activate the market.
<i class="no-highlight">1439</i>&nbsp;     * Once the market has been activated successfully its button turns to &quot;End Market&quot; to click if the user wants to discard all of the resources gotten;
<i class="no-highlight">1440</i>&nbsp;     * otherwise the user can click onto &quot;Store Resources&quot; and store the resources he wants. Once the store resources is validated the resources not stored are discarded as per game rule.
<i class="no-highlight">1441</i>&nbsp;     *
<i class="no-highlight">1442</i>&nbsp;     * @throws IOException  If there&#39;s a problem loading the FXML file
<i class="no-highlight">1443</i>&nbsp;     */
<i class="no-highlight">1444</i>&nbsp;    @FXML
<i class="no-highlight">1445</i>&nbsp;    private void market() throws IOException{
<b class="nc"><i class="no-highlight">1446</i>&nbsp;        if(marketBtn.getText().equals(&quot;End Market&quot;))</b>
<i class="no-highlight">1447</i>&nbsp;        {
<b class="nc"><i class="no-highlight">1448</i>&nbsp;            sendAction(new EndMarket());</b>
<b class="nc"><i class="no-highlight">1449</i>&nbsp;            marketBtn.setText(&quot;Open Market&quot;);</b>
<i class="no-highlight">1450</i>&nbsp;            return;
<i class="no-highlight">1451</i>&nbsp;        }
<i class="no-highlight">1452</i>&nbsp;        Parent marketParent;
<b class="nc"><i class="no-highlight">1453</i>&nbsp;        FXMLLoader loader = new FXMLLoader(getClass().getResource(&quot;Assets/Fxml/Market.fxml&quot;));</b>
<b class="nc"><i class="no-highlight">1454</i>&nbsp;        loader.setController(this);</b>
<b class="nc"><i class="no-highlight">1455</i>&nbsp;        marketParent = loader.load();</b>
<b class="nc"><i class="no-highlight">1456</i>&nbsp;        market = new Stage();</b>
<b class="nc"><i class="no-highlight">1457</i>&nbsp;        market.initModality(Modality.APPLICATION_MODAL);</b>
<b class="nc"><i class="no-highlight">1458</i>&nbsp;        market.setTitle(&quot;Market&quot;);</b>
<b class="nc"><i class="no-highlight">1459</i>&nbsp;        final boolean[] submitDisabled = {true};</b>
<b class="nc"><i class="no-highlight">1460</i>&nbsp;        submitMarket.setDisable(submitDisabled[0]);</b>
<b class="nc"><i class="no-highlight">1461</i>&nbsp;        activeMarket = new ImageView[4][3];</b>
<b class="nc"><i class="no-highlight">1462</i>&nbsp;        extraMarble.setImage(super.getImage(this.client.getUserInteraction().getGame().getMarket().getExtraMarble()));</b>
<i class="no-highlight">1463</i>&nbsp;
<b class="nc"><i class="no-highlight">1464</i>&nbsp;        for(int marketColumn=0;marketColumn&lt;4;marketColumn++)</b>
<b class="nc"><i class="no-highlight">1465</i>&nbsp;            for(int marketRow=0;marketRow&lt;3;marketRow++) {</b>
<b class="nc"><i class="no-highlight">1466</i>&nbsp;                marketPane.add(activeMarket[marketColumn][marketRow] = new ImageView(super.getImage(this.client.getUserInteraction().getGame().getMarket().getMarble(marketColumn, marketRow))), marketColumn, marketRow);</b>
<b class="nc"><i class="no-highlight">1467</i>&nbsp;                activeMarket[marketColumn][marketRow].setFitHeight(41);</b>
<b class="nc"><i class="no-highlight">1468</i>&nbsp;                activeMarket[marketColumn][marketRow].setFitWidth(41);</b>
<i class="no-highlight">1469</i>&nbsp;            }
<b class="nc"><i class="no-highlight">1470</i>&nbsp;                marketColumn1.setOnAction(event -&gt; {</b>
<b class="nc"><i class="no-highlight">1471</i>&nbsp;                    if(marketColumn1.isArmed()){</b>
<b class="nc"><i class="no-highlight">1472</i>&nbsp;                        marketColumn2.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1473</i>&nbsp;                        marketColumn3.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1474</i>&nbsp;                        marketColumn4.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1475</i>&nbsp;                        marketRow1.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1476</i>&nbsp;                        marketRow2.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1477</i>&nbsp;                        marketRow3.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1478</i>&nbsp;                        submitMarket.setDisable(!marketColumn1.isSelected());</b>
<i class="no-highlight">1479</i>&nbsp;                    }
<i class="no-highlight">1480</i>&nbsp;                });
<b class="nc"><i class="no-highlight">1481</i>&nbsp;                marketColumn2.setOnAction(event -&gt; {</b>
<b class="nc"><i class="no-highlight">1482</i>&nbsp;                    if(marketColumn2.isArmed()){</b>
<b class="nc"><i class="no-highlight">1483</i>&nbsp;                        marketColumn1.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1484</i>&nbsp;                        marketColumn3.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1485</i>&nbsp;                        marketColumn4.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1486</i>&nbsp;                        marketRow1.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1487</i>&nbsp;                        marketRow2.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1488</i>&nbsp;                        marketRow3.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1489</i>&nbsp;                        submitMarket.setDisable(!marketColumn2.isSelected());</b>
<i class="no-highlight">1490</i>&nbsp;                    }
<i class="no-highlight">1491</i>&nbsp;                });
<b class="nc"><i class="no-highlight">1492</i>&nbsp;                marketColumn3.setOnAction(event -&gt; {</b>
<b class="nc"><i class="no-highlight">1493</i>&nbsp;                    if(marketColumn3.isArmed()){</b>
<b class="nc"><i class="no-highlight">1494</i>&nbsp;                        marketColumn2.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1495</i>&nbsp;                        marketColumn1.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1496</i>&nbsp;                        marketColumn4.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1497</i>&nbsp;                        marketRow1.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1498</i>&nbsp;                        marketRow2.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1499</i>&nbsp;                        marketRow3.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1500</i>&nbsp;                        submitMarket.setDisable(!marketColumn3.isSelected());</b>
<i class="no-highlight">1501</i>&nbsp;                    }
<i class="no-highlight">1502</i>&nbsp;                });
<b class="nc"><i class="no-highlight">1503</i>&nbsp;                marketColumn4.setOnAction(event -&gt; {</b>
<b class="nc"><i class="no-highlight">1504</i>&nbsp;                    if(marketColumn4.isArmed()){</b>
<b class="nc"><i class="no-highlight">1505</i>&nbsp;                        marketColumn1.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1506</i>&nbsp;                        marketColumn2.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1507</i>&nbsp;                        marketColumn3.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1508</i>&nbsp;                        marketRow1.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1509</i>&nbsp;                        marketRow2.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1510</i>&nbsp;                        marketRow3.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1511</i>&nbsp;                        submitMarket.setDisable(!marketColumn4.isSelected());</b>
<i class="no-highlight">1512</i>&nbsp;                    }
<i class="no-highlight">1513</i>&nbsp;                });
<b class="nc"><i class="no-highlight">1514</i>&nbsp;                marketRow1.setOnAction(event -&gt; {</b>
<b class="nc"><i class="no-highlight">1515</i>&nbsp;                    if(marketRow1.isArmed()){</b>
<b class="nc"><i class="no-highlight">1516</i>&nbsp;                        marketColumn1.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1517</i>&nbsp;                        marketColumn2.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1518</i>&nbsp;                        marketColumn3.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1519</i>&nbsp;                        marketColumn4.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1520</i>&nbsp;                        marketRow2.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1521</i>&nbsp;                        marketRow3.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1522</i>&nbsp;                        submitMarket.setDisable(!marketRow1.isSelected());</b>
<i class="no-highlight">1523</i>&nbsp;                    }
<i class="no-highlight">1524</i>&nbsp;                });
<b class="nc"><i class="no-highlight">1525</i>&nbsp;                marketRow2.setOnAction(event -&gt; {</b>
<b class="nc"><i class="no-highlight">1526</i>&nbsp;                    if(marketRow2.isArmed()){</b>
<b class="nc"><i class="no-highlight">1527</i>&nbsp;                        marketColumn1.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1528</i>&nbsp;                        marketColumn2.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1529</i>&nbsp;                        marketColumn3.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1530</i>&nbsp;                        marketColumn4.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1531</i>&nbsp;                        marketRow1.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1532</i>&nbsp;                        marketRow3.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1533</i>&nbsp;                        submitMarket.setDisable(!marketRow2.isSelected());</b>
<i class="no-highlight">1534</i>&nbsp;                    }
<i class="no-highlight">1535</i>&nbsp;                });
<b class="nc"><i class="no-highlight">1536</i>&nbsp;                marketRow3.setOnAction(event -&gt; {</b>
<b class="nc"><i class="no-highlight">1537</i>&nbsp;                    if(marketRow3.isArmed()){</b>
<b class="nc"><i class="no-highlight">1538</i>&nbsp;                        marketColumn1.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1539</i>&nbsp;                        marketColumn2.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1540</i>&nbsp;                        marketColumn3.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1541</i>&nbsp;                        marketColumn4.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1542</i>&nbsp;                        marketRow1.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1543</i>&nbsp;                        marketRow2.setSelected(false);</b>
<b class="nc"><i class="no-highlight">1544</i>&nbsp;                        submitMarket.setDisable(!marketRow3.isSelected());</b>
<i class="no-highlight">1545</i>&nbsp;                    }
<i class="no-highlight">1546</i>&nbsp;                });
<b class="nc"><i class="no-highlight">1547</i>&nbsp;                submitMarket.setOnAction(event1 -&gt; {</b>
<b class="nc"><i class="no-highlight">1548</i>&nbsp;                    boolean row=false;</b>
<b class="nc"><i class="no-highlight">1549</i>&nbsp;                    int number=-1;</b>
<b class="nc"><i class="no-highlight">1550</i>&nbsp;                    if(marketRow1.isSelected()){</b>
<b class="nc"><i class="no-highlight">1551</i>&nbsp;                        number=0;</b>
<b class="nc"><i class="no-highlight">1552</i>&nbsp;                        row=true;</b>
<i class="no-highlight">1553</i>&nbsp;                    }
<b class="nc"><i class="no-highlight">1554</i>&nbsp;                    else if(marketRow2.isSelected()) {</b>
<b class="nc"><i class="no-highlight">1555</i>&nbsp;                        number=1;</b>
<b class="nc"><i class="no-highlight">1556</i>&nbsp;                        row=true;</b>
<i class="no-highlight">1557</i>&nbsp;                    }
<b class="nc"><i class="no-highlight">1558</i>&nbsp;                    else if(marketRow3.isSelected()) {</b>
<b class="nc"><i class="no-highlight">1559</i>&nbsp;                        number=2;</b>
<b class="nc"><i class="no-highlight">1560</i>&nbsp;                        row=true;</b>
<i class="no-highlight">1561</i>&nbsp;                    }
<b class="nc"><i class="no-highlight">1562</i>&nbsp;                    else if(marketColumn1.isSelected())</b>
<b class="nc"><i class="no-highlight">1563</i>&nbsp;                        number=0;</b>
<b class="nc"><i class="no-highlight">1564</i>&nbsp;                    else if(marketColumn2.isSelected())</b>
<b class="nc"><i class="no-highlight">1565</i>&nbsp;                        number=1;</b>
<b class="nc"><i class="no-highlight">1566</i>&nbsp;                    else if(marketColumn3.isSelected())</b>
<b class="nc"><i class="no-highlight">1567</i>&nbsp;                        number=2;</b>
<b class="nc"><i class="no-highlight">1568</i>&nbsp;                    else if(marketColumn4.isSelected())</b>
<b class="nc"><i class="no-highlight">1569</i>&nbsp;                        number=3;</b>
<b class="nc"><i class="no-highlight">1570</i>&nbsp;                    if(myPlayer().getPossibleActions().contains(ActionType.MARKET_CHOOSE_ROW)){</b>
<b class="nc"><i class="no-highlight">1571</i>&nbsp;                        sendAction(new MarketChooseRow(row, number));</b>
<b class="nc"><i class="no-highlight">1572</i>&nbsp;                        market.close();</b>
<b class="nc"><i class="no-highlight">1573</i>&nbsp;                        refresh();</b>
<b class="nc"><i class="no-highlight">1574</i>&nbsp;                        marketBtn.setText(&quot;End Market&quot;);</b>
<b class="nc"><i class="no-highlight">1575</i>&nbsp;                        if(</b>
<b class="nc"><i class="no-highlight">1576</i>&nbsp;                                myPlayer().getLeaderCards()[0].isActive()&amp;&amp;myPlayer().getLeaderCards()[0].getAction().equals(LeaderCardAction.WHITEMARBLE)</b>
<b class="nc"><i class="no-highlight">1577</i>&nbsp;                                        &amp;&amp; myPlayer().getLeaderCards()[1].isActive()&amp;&amp;myPlayer().getLeaderCards()[1].getAction().equals(LeaderCardAction.WHITEMARBLE)</b>
<i class="no-highlight">1578</i>&nbsp;                        ){
<b class="nc"><i class="no-highlight">1579</i>&nbsp;                            production.setText(&quot;Marble Conversion&quot;);</b>
<i class="no-highlight">1580</i>&nbsp;                        }
<i class="no-highlight">1581</i>&nbsp;                    }
<i class="no-highlight">1582</i>&nbsp;                });
<b class="nc"><i class="no-highlight">1583</i>&nbsp;        button.setOnAction(e-&gt;market.close());</b>
<b class="nc"><i class="no-highlight">1584</i>&nbsp;        Scene scene = new Scene(marketParent);</b>
<b class="nc"><i class="no-highlight">1585</i>&nbsp;        market.setScene(scene);</b>
<b class="nc"><i class="no-highlight">1586</i>&nbsp;        market.showAndWait();</b>
<i class="no-highlight">1587</i>&nbsp;    }
<i class="no-highlight">1588</i>&nbsp;
<i class="no-highlight">1589</i>&nbsp;    /**
<i class="no-highlight">1590</i>&nbsp;     * This method is used to check if a resource can be added where the user wants to, otherwise the user gets the error.
<i class="no-highlight">1591</i>&nbsp;     * If the resource can be added where the user wants to the method returns true, if it&#39;s not possible an explanation is given and false is returned.
<i class="no-highlight">1592</i>&nbsp;     * StoreResources calls this method so that if it returns true the resource is added as an image to the game and the labels of the
<i class="no-highlight">1593</i>&nbsp;     * remanining resources are updated accordingly.
<i class="no-highlight">1594</i>&nbsp;     * @param shelfNumber       The shelf number to add the resource to [0-2] warehouse, [3-4] for leader cards
<i class="no-highlight">1595</i>&nbsp;     * @param resource          The resource name to add to the shelf number
<i class="no-highlight">1596</i>&nbsp;     *                          it is a string because the resource is identified by his dragbord name once its dropped onto the shelf
<i class="no-highlight">1597</i>&nbsp;     * @return                  True if adding the resource is allowed on the depot, false otherwise
<i class="no-highlight">1598</i>&nbsp;     */
<i class="no-highlight">1599</i>&nbsp;    private boolean addResource(int shelfNumber, String resource){
<b class="nc"><i class="no-highlight">1600</i>&nbsp;        ResourceType resourceType=stringToResource(resource);</b>
<b class="nc"><i class="no-highlight">1601</i>&nbsp;        RedWarehouseDepot warehouse = null;</b>
<b class="nc"><i class="no-highlight">1602</i>&nbsp;        if(shelfNumber&gt;=0&amp;&amp;shelfNumber&lt;=2){</b>
<i class="no-highlight">1603</i>&nbsp;
<b class="nc"><i class="no-highlight">1604</i>&nbsp;            warehouse = myPlayer().getWarehouse().getWarehouseDepots()[shelfNumber];</b>
<i class="no-highlight">1605</i>&nbsp;
<b class="nc"><i class="no-highlight">1606</i>&nbsp;            if(</b>
<b class="nc"><i class="no-highlight">1607</i>&nbsp;                    shelfNumber==0&amp;&amp;(resourceType.equals(myPlayer().getWarehouse().getWarehouseDepots()[1].getResourceType())||resourceType.equals(myPlayer().getWarehouse().getWarehouseDepots()[2].getResourceType()))||</b>
<b class="nc"><i class="no-highlight">1608</i>&nbsp;                    shelfNumber==1&amp;&amp;(resourceType.equals(myPlayer().getWarehouse().getWarehouseDepots()[0].getResourceType())||resourceType.equals(myPlayer().getWarehouse().getWarehouseDepots()[2].getResourceType()))||</b>
<b class="nc"><i class="no-highlight">1609</i>&nbsp;                    shelfNumber==2&amp;&amp;(resourceType.equals(myPlayer().getWarehouse().getWarehouseDepots()[0].getResourceType())||resourceType.equals(myPlayer().getWarehouse().getWarehouseDepots()[1].getResourceType()))</b>
<i class="no-highlight">1610</i>&nbsp;            )
<i class="no-highlight">1611</i>&nbsp;            {
<b class="nc"><i class="no-highlight">1612</i>&nbsp;                displayError(&quot;There&#39;s another depot with the same type of resources!&quot;);</b>
<b class="nc"><i class="no-highlight">1613</i>&nbsp;                return false;</b>
<i class="no-highlight">1614</i>&nbsp;            }
<i class="no-highlight">1615</i>&nbsp;
<b class="nc"><i class="no-highlight">1616</i>&nbsp;        }else if(shelfNumber==3||shelfNumber==4){</b>
<b class="nc"><i class="no-highlight">1617</i>&nbsp;            if(shelfNumber==3){</b>
<b class="nc"><i class="no-highlight">1618</i>&nbsp;                if(myPlayer().getLeaderCards()[0].isActive()&amp;&amp;myPlayer().getLeaderCards()[0].getAction().equals(LeaderCardAction.EXTRADEPOT)){</b>
<b class="nc"><i class="no-highlight">1619</i>&nbsp;                    warehouse = myPlayer().getWarehouse().getExtraWarehouseDepot1();</b>
<i class="no-highlight">1620</i>&nbsp;                }else {
<b class="nc"><i class="no-highlight">1621</i>&nbsp;                    displayError(&quot;This leader card is not active!&quot;);</b>
<b class="nc"><i class="no-highlight">1622</i>&nbsp;                    return false;</b>
<i class="no-highlight">1623</i>&nbsp;                }
<b class="nc"><i class="no-highlight">1624</i>&nbsp;            }else if(shelfNumber==4){</b>
<b class="nc"><i class="no-highlight">1625</i>&nbsp;                if(myPlayer().getLeaderCards()[1].isActive()&amp;&amp;myPlayer().getLeaderCards()[1].getAction().equals(LeaderCardAction.EXTRADEPOT)){</b>
<b class="nc"><i class="no-highlight">1626</i>&nbsp;                    warehouse = myPlayer().getWarehouse().getExtraWarehouseDepot2();</b>
<i class="no-highlight">1627</i>&nbsp;                }else {
<b class="nc"><i class="no-highlight">1628</i>&nbsp;                    displayError(&quot;This leader card is not active!&quot;);</b>
<b class="nc"><i class="no-highlight">1629</i>&nbsp;                    return false;</b>
<i class="no-highlight">1630</i>&nbsp;                }
<i class="no-highlight">1631</i>&nbsp;            }
<i class="no-highlight">1632</i>&nbsp;        }
<b class="nc"><i class="no-highlight">1633</i>&nbsp;        if((warehouse.getResourceType().equals(resourceType)&amp;&amp;!warehouse.isFull())||warehouse.isEmpty()){</b>
<b class="nc"><i class="no-highlight">1634</i>&nbsp;                sendAction(new AddResource(shelfNumber,resourceType));</b>
<b class="nc"><i class="no-highlight">1635</i>&nbsp;                refresh();</b>
<b class="nc"><i class="no-highlight">1636</i>&nbsp;            return true;</b>
<i class="no-highlight">1637</i>&nbsp;        }else
<b class="nc"><i class="no-highlight">1638</i>&nbsp;            if(!warehouse.getResourceType().equals(resourceType))</b>
<b class="nc"><i class="no-highlight">1639</i>&nbsp;                displayError(&quot;You can&#39;t mix resource types!&quot;);</b>
<i class="no-highlight">1640</i>&nbsp;            else
<b class="nc"><i class="no-highlight">1641</i>&nbsp;                displayError(&quot;This warehouse is full!&quot;);</b>
<b class="nc"><i class="no-highlight">1642</i>&nbsp;        return false;</b>
<i class="no-highlight">1643</i>&nbsp;    }
<i class="no-highlight">1644</i>&nbsp;
<i class="no-highlight">1645</i>&nbsp;    /**
<i class="no-highlight">1646</i>&nbsp;     * The board screen
<i class="no-highlight">1647</i>&nbsp;     * @throws IOException      if there&#39;s a problem loading the FXML
<i class="no-highlight">1648</i>&nbsp;     */
<i class="no-highlight">1649</i>&nbsp;    protected void board() throws IOException {
<i class="no-highlight">1650</i>&nbsp;        Parent board;
<i class="no-highlight">1651</i>&nbsp;
<b class="nc"><i class="no-highlight">1652</i>&nbsp;        FXMLLoader loader = new FXMLLoader(getClass().getResource(&quot;Assets/Fxml/Board.fxml&quot;));</b>
<b class="nc"><i class="no-highlight">1653</i>&nbsp;        loader.setController(this);</b>
<b class="nc"><i class="no-highlight">1654</i>&nbsp;        board = loader.load();</b>
<b class="nc"><i class="no-highlight">1655</i>&nbsp;        if(this.client.getUserInteraction().getGame().getGameType().equals(GameType.SINGLEPLAYER))</b>
<i class="no-highlight">1656</i>&nbsp;        {
<b class="nc"><i class="no-highlight">1657</i>&nbsp;            inkwell.setImage(getImage(false));</b>
<i class="no-highlight">1658</i>&nbsp;        }
<i class="no-highlight">1659</i>&nbsp;        else {
<b class="nc"><i class="no-highlight">1660</i>&nbsp;            ArrayList&lt;Player&gt; players = this.client.getUserInteraction().getGame().getPlayers();</b>
<b class="nc"><i class="no-highlight">1661</i>&nbsp;            for(int i=0;i&lt;players.size();i++){</b>
<b class="nc"><i class="no-highlight">1662</i>&nbsp;                if(players.get(i).getNickname()!=myPlayer().getNickname()){</b>
<i class="no-highlight">1663</i>&nbsp;                Button playBtn;
<b class="nc"><i class="no-highlight">1664</i>&nbsp;                playBtn=new Button();</b>
<b class="nc"><i class="no-highlight">1665</i>&nbsp;                playBtn.setText(players.get(i).getNickname());</b>
<b class="nc"><i class="no-highlight">1666</i>&nbsp;                playBtn.setFont(Baskerville);</b>
<b class="nc"><i class="no-highlight">1667</i>&nbsp;                playBtn.setOnAction(this::boardClickHandler);</b>
<b class="nc"><i class="no-highlight">1668</i>&nbsp;                playBtn.setId(&quot;&quot;+i);</b>
<b class="nc"><i class="no-highlight">1669</i>&nbsp;                otherBoards.add(playBtn,0,i);</b>
<b class="nc"><i class="no-highlight">1670</i>&nbsp;                GridPane.setHalignment(otherBoards,HPos.CENTER);</b>
<b class="nc"><i class="no-highlight">1671</i>&nbsp;                GridPane.setValignment(otherBoards,VPos.CENTER);</b>
<i class="no-highlight">1672</i>&nbsp;                }
<i class="no-highlight">1673</i>&nbsp;            }
<b class="nc"><i class="no-highlight">1674</i>&nbsp;            if(!this.client.getUserInteraction().getGame().getMyPlayer().hasInkwell())</b>
<b class="nc"><i class="no-highlight">1675</i>&nbsp;                inkwell.setImage(null);</b>
<i class="no-highlight">1676</i>&nbsp;        }
<i class="no-highlight">1677</i>&nbsp;
<i class="no-highlight">1678</i>&nbsp;
<b class="nc"><i class="no-highlight">1679</i>&nbsp;        Scene scene = new Scene(board);</b>
<b class="nc"><i class="no-highlight">1680</i>&nbsp;        refresh();</b>
<b class="nc"><i class="no-highlight">1681</i>&nbsp;        Stage window = getStage();</b>
<b class="nc"><i class="no-highlight">1682</i>&nbsp;        window.setScene(scene);</b>
<i class="no-highlight">1683</i>&nbsp;    }
<i class="no-highlight">1684</i>&nbsp;
<i class="no-highlight">1685</i>&nbsp;    /**
<i class="no-highlight">1686</i>&nbsp;     * Method used to view other&#39;s board
<i class="no-highlight">1687</i>&nbsp;     * @param player
<i class="no-highlight">1688</i>&nbsp;     * @throws IOException
<i class="no-highlight">1689</i>&nbsp;     */
<i class="no-highlight">1690</i>&nbsp;    protected void board(Player player) throws IOException {
<i class="no-highlight">1691</i>&nbsp;        Parent playerBoard;
<b class="nc"><i class="no-highlight">1692</i>&nbsp;        FXMLLoader loader = new FXMLLoader(getClass().getResource(&quot;Assets/Fxml/RedBoard.fxml&quot;));</b>
<b class="nc"><i class="no-highlight">1693</i>&nbsp;        loader.setController(this);</b>
<b class="nc"><i class="no-highlight">1694</i>&nbsp;        playerBoard = loader.load();</b>
<b class="nc"><i class="no-highlight">1695</i>&nbsp;        Scene scene = new Scene(playerBoard);</b>
<i class="no-highlight">1696</i>&nbsp;
<b class="nc"><i class="no-highlight">1697</i>&nbsp;        xtraBoard = new Stage();</b>
<b class="nc"><i class="no-highlight">1698</i>&nbsp;        xtraBoard.initModality(Modality.APPLICATION_MODAL);</b>
<b class="nc"><i class="no-highlight">1699</i>&nbsp;        xtraBoard.setTitle(player.getNickname()+&quot;&#39;s Board&quot;);</b>
<i class="no-highlight">1700</i>&nbsp;
<b class="nc"><i class="no-highlight">1701</i>&nbsp;        setResourceData(getResourceData(player));</b>
<b class="nc"><i class="no-highlight">1702</i>&nbsp;        setCardData(getCardData(player));</b>
<b class="nc"><i class="no-highlight">1703</i>&nbsp;        setFaithData(getFaithData(player));</b>
<i class="no-highlight">1704</i>&nbsp;
<b class="nc"><i class="no-highlight">1705</i>&nbsp;            if(player.hasInkwell())</b>
<b class="nc"><i class="no-highlight">1706</i>&nbsp;                inkwell.setImage(getImage(true));</b>
<b class="nc"><i class="no-highlight">1707</i>&nbsp;            else inkwell.setImage(null);</b>
<b class="nc"><i class="no-highlight">1708</i>&nbsp;        button.setOnAction(e-&gt;xtraBoard.close());</b>
<i class="no-highlight">1709</i>&nbsp;
<b class="nc"><i class="no-highlight">1710</i>&nbsp;        xtraBoard.setScene(scene);</b>
<b class="nc"><i class="no-highlight">1711</i>&nbsp;        xtraBoard.showAndWait();</b>
<i class="no-highlight">1712</i>&nbsp;    }
<i class="no-highlight">1713</i>&nbsp;
<i class="no-highlight">1714</i>&nbsp;    /**
<i class="no-highlight">1715</i>&nbsp;     * Method called when the user clicks on the &quot;Next Action&quot; button.
<i class="no-highlight">1716</i>&nbsp;     * If it&#39;s possible to end the turn a message is sent, otherwise an explanation is given
<i class="no-highlight">1717</i>&nbsp;     */
<i class="no-highlight">1718</i>&nbsp;    @FXML
<i class="no-highlight">1719</i>&nbsp;    private void turnHandler(){
<i class="no-highlight">1720</i>&nbsp;        {
<b class="nc"><i class="no-highlight">1721</i>&nbsp;            String nextAction =null;</b>
<i class="no-highlight">1722</i>&nbsp;
<b class="nc"><i class="no-highlight">1723</i>&nbsp;            if(myPlayer().getPossibleActions().contains(ActionType.CHOOSE_LEADER_CARD))</b>
<b class="nc"><i class="no-highlight">1724</i>&nbsp;                nextAction=&quot;choose which leader card to activate.&quot;;</b>
<b class="nc"><i class="no-highlight">1725</i>&nbsp;            else if(myPlayer().getPossibleActions().contains(ActionType.ADD_RESOURCE))</b>
<b class="nc"><i class="no-highlight">1726</i>&nbsp;                nextAction=&quot;add the resources you got.&quot;;</b>
<b class="nc"><i class="no-highlight">1727</i>&nbsp;            else if(myPlayer().getPossibleActions().contains(ActionType.END_MARKET))</b>
<b class="nc"><i class="no-highlight">1728</i>&nbsp;                nextAction=&quot;end the market interaction.&quot;;</b>
<b class="nc"><i class="no-highlight">1729</i>&nbsp;            else if(myPlayer().getPossibleActions().contains(ActionType.PAY_RESOURCE_CARD))</b>
<b class="nc"><i class="no-highlight">1730</i>&nbsp;                nextAction=&quot;pay the resources for the card you bought.&quot;;</b>
<b class="nc"><i class="no-highlight">1731</i>&nbsp;            else if(myPlayer().getPossibleActions().contains(ActionType.PAY_RESOURCE_PRODUCTION))</b>
<b class="nc"><i class="no-highlight">1732</i>&nbsp;                nextAction=&quot;pay the resources for the production cycle you activated.&quot;;</b>
<b class="nc"><i class="no-highlight">1733</i>&nbsp;            else if(myPlayer().getPossibleActions().contains(ActionType.CHOOSE_CARD_SLOT))</b>
<b class="nc"><i class="no-highlight">1734</i>&nbsp;                nextAction=&quot;choose the card slot.&quot;;</b>
<b class="nc"><i class="no-highlight">1735</i>&nbsp;            else if(myPlayer().getPossibleActions().contains(ActionType.PAY_RESOURCE_CARD))</b>
<b class="nc"><i class="no-highlight">1736</i>&nbsp;                nextAction=&quot;choose the production output for your cards.&quot;;</b>
<i class="no-highlight">1737</i>&nbsp;
<b class="nc"><i class="no-highlight">1738</i>&nbsp;            if(myPlayer().getPossibleActions().contains(ActionType.END_TURN)){</b>
<b class="nc"><i class="no-highlight">1739</i>&nbsp;                sendAction(new EndTurn());</b>
<b class="nc"><i class="no-highlight">1740</i>&nbsp;                if(client.getUserInteraction().getGame().getGameType().equals(GameType.MULTIPLAYER)){</b>
<b class="nc"><i class="no-highlight">1741</i>&nbsp;                    freeze(true);</b>
<i class="no-highlight">1742</i>&nbsp;                }
<b class="nc"><i class="no-highlight">1743</i>&nbsp;                refresh();</b>
<i class="no-highlight">1744</i>&nbsp;            }
<b class="nc"><i class="no-highlight">1745</i>&nbsp;            else if(nextAction!=null)</b>
<b class="nc"><i class="no-highlight">1746</i>&nbsp;                displayError(&quot;You can&#39;t pass the turn now!\nYou should &quot;+nextAction);</b>
<b class="nc"><i class="no-highlight">1747</i>&nbsp;            else displayError(&quot;You can&#39;t pass the turn now!&quot;);</b>
<i class="no-highlight">1748</i>&nbsp;        }
<i class="no-highlight">1749</i>&nbsp;    }
<i class="no-highlight">1750</i>&nbsp;
<i class="no-highlight">1751</i>&nbsp;    void freeze(boolean freezeButtons){
<b class="nc"><i class="no-highlight">1752</i>&nbsp;        if(freezeButtons){</b>
<b class="nc"><i class="no-highlight">1753</i>&nbsp;            production.setDisable(true);storeResBtn.setDisable(true);payResBtn.setDisable(true);</b>
<b class="nc"><i class="no-highlight">1754</i>&nbsp;            marketBtn.setDisable(true);cardTableBtn.setDisable(true);nextTurn.setDisable(true);</b>
<i class="no-highlight">1755</i>&nbsp;        }else{
<b class="nc"><i class="no-highlight">1756</i>&nbsp;            production.setDisable(false);storeResBtn.setDisable(false);payResBtn.setDisable(false);</b>
<b class="nc"><i class="no-highlight">1757</i>&nbsp;            marketBtn.setDisable(false);cardTableBtn.setDisable(false);nextTurn.setDisable(false);</b>
<i class="no-highlight">1758</i>&nbsp;        }
<i class="no-highlight">1759</i>&nbsp;    }
<i class="no-highlight">1760</i>&nbsp;
<i class="no-highlight">1761</i>&nbsp;    /**
<i class="no-highlight">1762</i>&nbsp;     * This method handles some button tasks in the board.
<i class="no-highlight">1763</i>&nbsp;     * The task are identified by getting the Button&#39;s id from the ActionEvent triggered by the press
<i class="no-highlight">1764</i>&nbsp;     * The actions that are done trough this method are:
<i class="no-highlight">1765</i>&nbsp;     * ? Activate Leader Card:  if it&#39;s possible to activate a leader card a message is sent
<i class="no-highlight">1766</i>&nbsp;     * ? Discard Leader Card:   to discard an activated Leader Card
<i class="no-highlight">1767</i>&nbsp;     * ? View Other&#39;s Board:    for opening another window with their board
<i class="no-highlight">1768</i>&nbsp;     * @param event             The event triggered for getting the id of the Button pressed
<i class="no-highlight">1769</i>&nbsp;     */
<i class="no-highlight">1770</i>&nbsp;    @FXML
<i class="no-highlight">1771</i>&nbsp;    private void boardClickHandler(ActionEvent event) {
<b class="nc"><i class="no-highlight">1772</i>&nbsp;        Node node = (Node) event.getTarget();</b>
<b class="nc"><i class="no-highlight">1773</i>&nbsp;        ArrayList&lt;Player&gt; players = this.client.getUserInteraction().getGame().getPlayers();</b>
<b class="nc"><i class="no-highlight">1774</i>&nbsp;        String parent=node.getId();</b>
<i class="no-highlight">1775</i>&nbsp;
<b class="nc"><i class="no-highlight">1776</i>&nbsp;        switch (parent){</b>
<i class="no-highlight">1777</i>&nbsp;            case &quot;activateLeader1&quot;:{
<b class="nc"><i class="no-highlight">1778</i>&nbsp;                if(myPlayer().getPossibleActions().contains(ActionType.ACTIVATE_LEADERCARD))</b>
<b class="nc"><i class="no-highlight">1779</i>&nbsp;                sendAction(new ActivateLeaderCard(0));</b>
<b class="nc"><i class="no-highlight">1780</i>&nbsp;                else displayError(&quot;You can&#39;t activate a Leader Card now&quot;);</b>
<i class="no-highlight">1781</i>&nbsp;                return;
<i class="no-highlight">1782</i>&nbsp;            }
<i class="no-highlight">1783</i>&nbsp;            case &quot;discardLeader1&quot;:{
<b class="nc"><i class="no-highlight">1784</i>&nbsp;                if(myPlayer().getPossibleActions().contains(ActionType.DELETE_LEADERCARD)){</b>
<b class="nc"><i class="no-highlight">1785</i>&nbsp;                    sendAction(new DiscardLeaderCard(0));</b>
<b class="nc"><i class="no-highlight">1786</i>&nbsp;                    refresh();</b>
<i class="no-highlight">1787</i>&nbsp;                }
<b class="nc"><i class="no-highlight">1788</i>&nbsp;                else displayError(&quot;You can&#39;t discard a Leader card now&quot;);</b>
<i class="no-highlight">1789</i>&nbsp;                return;
<i class="no-highlight">1790</i>&nbsp;            }
<i class="no-highlight">1791</i>&nbsp;            case &quot;activateLeader2&quot;:{
<b class="nc"><i class="no-highlight">1792</i>&nbsp;                if(myPlayer().getPossibleActions().contains(ActionType.ACTIVATE_LEADERCARD))</b>
<b class="nc"><i class="no-highlight">1793</i>&nbsp;                    sendAction(new ActivateLeaderCard(1));</b>
<b class="nc"><i class="no-highlight">1794</i>&nbsp;                else displayError(&quot;You can&#39;t activate a Leader Card now&quot;);</b>
<i class="no-highlight">1795</i>&nbsp;                return;
<i class="no-highlight">1796</i>&nbsp;            }case &quot;discardLeader2&quot;:{
<b class="nc"><i class="no-highlight">1797</i>&nbsp;                if(myPlayer().getPossibleActions().contains(ActionType.DELETE_LEADERCARD)){</b>
<b class="nc"><i class="no-highlight">1798</i>&nbsp;                    sendAction(new DiscardLeaderCard(1));</b>
<b class="nc"><i class="no-highlight">1799</i>&nbsp;                    refresh();</b>
<i class="no-highlight">1800</i>&nbsp;                }
<b class="nc"><i class="no-highlight">1801</i>&nbsp;                else displayError(&quot;You can&#39;t discard a Leader card now&quot;);</b>
<i class="no-highlight">1802</i>&nbsp;                return;
<i class="no-highlight">1803</i>&nbsp;            }
<i class="no-highlight">1804</i>&nbsp;        }
<i class="no-highlight">1805</i>&nbsp;        try {
<b class="nc"><i class="no-highlight">1806</i>&nbsp;            board(players.get(Integer.parseInt(parent)));</b>
<b class="nc"><i class="no-highlight">1807</i>&nbsp;        } catch (IOException e) {</b>
<b class="nc"><i class="no-highlight">1808</i>&nbsp;            e.printStackTrace();</b>
<b class="nc"><i class="no-highlight">1809</i>&nbsp;        }</b>
<i class="no-highlight">1810</i>&nbsp;    }
<i class="no-highlight">1811</i>&nbsp;
<i class="no-highlight">1812</i>&nbsp;    /**
<i class="no-highlight">1813</i>&nbsp;     * This method handles the Activate Production button, by opening the Activate Production screen if the user has the right to
<i class="no-highlight">1814</i>&nbsp;     * or by opening the Production Output otherwise
<i class="no-highlight">1815</i>&nbsp;     * @throws Exception
<i class="no-highlight">1816</i>&nbsp;     */
<i class="no-highlight">1817</i>&nbsp;    @FXML
<i class="no-highlight">1818</i>&nbsp;    public void activateProduction() throws Exception{
<b class="nc"><i class="no-highlight">1819</i>&nbsp;        if(myPlayer().getPossibleActions().contains(ActionType.CHOOSE_LEADER_CARD))</b>
<b class="nc"><i class="no-highlight">1820</i>&nbsp;            choose();</b>
<b class="nc"><i class="no-highlight">1821</i>&nbsp;        else if(myPlayer().getPossibleActions().contains(ActionType.ACTIVATE_PRODUCTION))</b>
<b class="nc"><i class="no-highlight">1822</i>&nbsp;            choose();</b>
<b class="nc"><i class="no-highlight">1823</i>&nbsp;        else if(myPlayer().getPossibleActions().contains(ActionType.CHOOSE_PRODUCTION_OUTPUT))</b>
<b class="nc"><i class="no-highlight">1824</i>&nbsp;            choose();</b>
<i class="no-highlight">1825</i>&nbsp;        else
<b class="nc"><i class="no-highlight">1826</i>&nbsp;            displayError(&quot;You can&#39;t activate a production now!&quot;);</b>
<i class="no-highlight">1827</i>&nbsp;    }
<i class="no-highlight">1828</i>&nbsp;
<i class="no-highlight">1829</i>&nbsp;    /**
<i class="no-highlight">1830</i>&nbsp;     * This method is called when the user presses on the &quot;Get Resource&quot; button.
<i class="no-highlight">1831</i>&nbsp;     * If there are resources to store the Get resource screen is opened, otherwise the user is informed
<i class="no-highlight">1832</i>&nbsp;     * @throws IOException
<i class="no-highlight">1833</i>&nbsp;     */
<i class="no-highlight">1834</i>&nbsp;    @FXML
<i class="no-highlight">1835</i>&nbsp;    private void getResourcesGame() throws IOException {
<b class="nc"><i class="no-highlight">1836</i>&nbsp;        if(this.client.getUserInteraction().getGame().getMyPlayer().getPossibleActions().contains(ActionType.ADD_RESOURCE))</b>
<b class="nc"><i class="no-highlight">1837</i>&nbsp;            getResources(false);</b>
<i class="no-highlight">1838</i>&nbsp;        else
<b class="nc"><i class="no-highlight">1839</i>&nbsp;            displayError(&quot;You don&#39;t have any resource left to store!&quot;);</b>
<i class="no-highlight">1840</i>&nbsp;    }
<i class="no-highlight">1841</i>&nbsp;
<i class="no-highlight">1842</i>&nbsp;    /**
<i class="no-highlight">1843</i>&nbsp;     * This methods transforms a string to a ResourceType.
<i class="no-highlight">1844</i>&nbsp;     * Used in the get resource because the resource is identified by his text property in the dragboard.
<i class="no-highlight">1845</i>&nbsp;     * @param resource      the resource string to get the resource type from
<i class="no-highlight">1846</i>&nbsp;     * @return              the corresponding ResourceType
<i class="no-highlight">1847</i>&nbsp;     */
<i class="no-highlight">1848</i>&nbsp;    private ResourceType stringToResource(String resource){
<i class="no-highlight">1849</i>&nbsp;        ResourceType resourceType;
<b class="nc"><i class="no-highlight">1850</i>&nbsp;        switch (resource.toLowerCase(Locale.ROOT)){</b>
<i class="no-highlight">1851</i>&nbsp;            case &quot;stones&quot;:{
<b class="nc"><i class="no-highlight">1852</i>&nbsp;                resourceType=ResourceType.STONES;</b>
<b class="nc"><i class="no-highlight">1853</i>&nbsp;                break;</b>
<i class="no-highlight">1854</i>&nbsp;            }
<i class="no-highlight">1855</i>&nbsp;            case &quot;coins&quot;:{
<b class="nc"><i class="no-highlight">1856</i>&nbsp;                resourceType=ResourceType.COINS;</b>
<b class="nc"><i class="no-highlight">1857</i>&nbsp;                break;</b>
<i class="no-highlight">1858</i>&nbsp;            }
<i class="no-highlight">1859</i>&nbsp;            case &quot;servants&quot;:{
<b class="nc"><i class="no-highlight">1860</i>&nbsp;                resourceType=ResourceType.SERVANTS;</b>
<b class="nc"><i class="no-highlight">1861</i>&nbsp;                break;</b>
<i class="no-highlight">1862</i>&nbsp;            }
<i class="no-highlight">1863</i>&nbsp;            case &quot;shields&quot;:{
<b class="nc"><i class="no-highlight">1864</i>&nbsp;                resourceType=ResourceType.SHIELDS;</b>
<b class="nc"><i class="no-highlight">1865</i>&nbsp;                break;</b>
<i class="no-highlight">1866</i>&nbsp;            }
<i class="no-highlight">1867</i>&nbsp;            default:
<b class="nc"><i class="no-highlight">1868</i>&nbsp;                throw new IllegalStateException(&quot;Unexpected value: &quot; + resource);</b>
<i class="no-highlight">1869</i>&nbsp;        }
<b class="nc"><i class="no-highlight">1870</i>&nbsp;        return resourceType;</b>
<i class="no-highlight">1871</i>&nbsp;    }
<i class="no-highlight">1872</i>&nbsp;
<i class="no-highlight">1873</i>&nbsp;    /**
<i class="no-highlight">1874</i>&nbsp;     * sendAction sends the action to the server. Useful for having less Exceptions around the code.
<i class="no-highlight">1875</i>&nbsp;     * @param action    The action to send
<i class="no-highlight">1876</i>&nbsp;     */
<i class="no-highlight">1877</i>&nbsp;    private void sendAction(Action action){
<i class="no-highlight">1878</i>&nbsp;            try {
<b class="nc"><i class="no-highlight">1879</i>&nbsp;                action.setNickname(myPlayer().getNickname());</b>
<b class="nc"><i class="no-highlight">1880</i>&nbsp;                this.clientConnection.send(action);</b>
<b class="nc"><i class="no-highlight">1881</i>&nbsp;            } catch (IOException e) {</b>
<b class="nc"><i class="no-highlight">1882</i>&nbsp;                displayError(e.toString());</b>
<b class="nc"><i class="no-highlight">1883</i>&nbsp;            }</b>
<i class="no-highlight">1884</i>&nbsp;    }
<i class="no-highlight">1885</i>&nbsp;
<i class="no-highlight">1886</i>&nbsp;    /**
<i class="no-highlight">1887</i>&nbsp;     * By giving a Player&#39;s position into the faith track it returns the corresponding Row on the Faith Grid.
<i class="no-highlight">1888</i>&nbsp;     * @param position  The position onto the faith track
<i class="no-highlight">1889</i>&nbsp;     * @return          The corresponding row onto the Faith Grid
<i class="no-highlight">1890</i>&nbsp;     */
<i class="no-highlight">1891</i>&nbsp;    private int faithRow(int position){
<b class="nc"><i class="no-highlight">1892</i>&nbsp;        if(position&lt;=2||position&gt;=11&amp;&amp;position&lt;=16)</b>
<b class="nc"><i class="no-highlight">1893</i>&nbsp;            return 2;</b>
<b class="nc"><i class="no-highlight">1894</i>&nbsp;        else if(position==3||position==10||position==17)</b>
<b class="nc"><i class="no-highlight">1895</i>&nbsp;            return 1;</b>
<b class="nc"><i class="no-highlight">1896</i>&nbsp;        else return 0;</b>
<i class="no-highlight">1897</i>&nbsp;    }
<i class="no-highlight">1898</i>&nbsp;
<i class="no-highlight">1899</i>&nbsp;    /**
<i class="no-highlight">1900</i>&nbsp;     * By giving a Player&#39;s position into the faith track it returns the corresponding Column on the Faith Grid.
<i class="no-highlight">1901</i>&nbsp;     * @param position  The position onto the faith track
<i class="no-highlight">1902</i>&nbsp;     * @return          The corresponding column onto the Faith Grid
<i class="no-highlight">1903</i>&nbsp;     */
<i class="no-highlight">1904</i>&nbsp;    private int faithColumn(int position){
<b class="nc"><i class="no-highlight">1905</i>&nbsp;        if(position&lt;3)</b>
<b class="nc"><i class="no-highlight">1906</i>&nbsp;            return position;</b>
<b class="nc"><i class="no-highlight">1907</i>&nbsp;        if(position&lt;=4)</b>
<b class="nc"><i class="no-highlight">1908</i>&nbsp;            return 2;</b>
<b class="nc"><i class="no-highlight">1909</i>&nbsp;        if(position&lt;=9)</b>
<b class="nc"><i class="no-highlight">1910</i>&nbsp;            return position-2;</b>
<b class="nc"><i class="no-highlight">1911</i>&nbsp;        if(position==10||position==11)</b>
<b class="nc"><i class="no-highlight">1912</i>&nbsp;            return 7;</b>
<b class="nc"><i class="no-highlight">1913</i>&nbsp;        if(position&lt;=16)</b>
<b class="nc"><i class="no-highlight">1914</i>&nbsp;            return position-4;</b>
<b class="nc"><i class="no-highlight">1915</i>&nbsp;        if(position==17)</b>
<b class="nc"><i class="no-highlight">1916</i>&nbsp;            return 12;</b>
<i class="no-highlight">1917</i>&nbsp;        else
<b class="nc"><i class="no-highlight">1918</i>&nbsp;            return position-6;</b>
<i class="no-highlight">1919</i>&nbsp;    }
<i class="no-highlight">1920</i>&nbsp;
<i class="no-highlight">1921</i>&nbsp;    /**
<i class="no-highlight">1922</i>&nbsp;     * Refreshes the board by updating the resource data, the card data and the faith data.
<i class="no-highlight">1923</i>&nbsp;     */
<i class="no-highlight">1924</i>&nbsp;    protected void refresh(){
<b class="nc"><i class="no-highlight">1925</i>&nbsp;                setResourceData(getResourceData(myPlayer()));</b>
<b class="nc"><i class="no-highlight">1926</i>&nbsp;                setCardData(getCardData(myPlayer()));</b>
<b class="nc"><i class="no-highlight">1927</i>&nbsp;                setFaithData(getFaithData(myPlayer()));</b>
<i class="no-highlight">1928</i>&nbsp;                //freeze(!this.client.getUserInteraction().getMessage().getPlayerNickname().equals(myPlayer().getNickname()));
<i class="no-highlight">1929</i>&nbsp;    }
<i class="no-highlight">1930</i>&nbsp;
<i class="no-highlight">1931</i>&nbsp;    /**
<i class="no-highlight">1932</i>&nbsp;     * Gets the faith information from the game as an Object[]
<i class="no-highlight">1933</i>&nbsp;     * @return Object[] of faith information, in particular:
<i class="no-highlight">1934</i>&nbsp;     * ? faithData[0]:   4 images of the players to display onto the track
<i class="no-highlight">1935</i>&nbsp;     * ? faithData[1]:   their Row position onto the Faith grid
<i class="no-highlight">1936</i>&nbsp;     * ? faithData[2]:   their Columns position onto the Faith grid.
<i class="no-highlight">1937</i>&nbsp;     * ? faithData[3]:   3 images for the PopeTile data
<i class="no-highlight">1938</i>&nbsp;     */
<i class="no-highlight">1939</i>&nbsp;    protected Object[] getFaithData(Player player){
<b class="nc"><i class="no-highlight">1940</i>&nbsp;        ArrayList&lt;Player&gt; players = this.client.getUserInteraction().getGame().getPlayers();</b>
<b class="nc"><i class="no-highlight">1941</i>&nbsp;        boolean bool=false;</b>
<i class="no-highlight">1942</i>&nbsp;        Object[] faithData;
<b class="nc"><i class="no-highlight">1943</i>&nbsp;        faithData = new Object[4];</b>
<i class="no-highlight">1944</i>&nbsp;        Image[] resourceImages;
<b class="nc"><i class="no-highlight">1945</i>&nbsp;        resourceImages = new Image[4];</b>
<i class="no-highlight">1946</i>&nbsp;        int[] faithRow;
<b class="nc"><i class="no-highlight">1947</i>&nbsp;        faithRow = new int[4];</b>
<i class="no-highlight">1948</i>&nbsp;        int[] faithColumn;
<b class="nc"><i class="no-highlight">1949</i>&nbsp;        faithColumn = new int[4];</b>
<i class="no-highlight">1950</i>&nbsp;        Image[] popeImages;
<b class="nc"><i class="no-highlight">1951</i>&nbsp;        popeImages = new Image[3];</b>
<b class="nc"><i class="no-highlight">1952</i>&nbsp;        Player notMyPlayer=null;</b>
<i class="no-highlight">1953</i>&nbsp;
<b class="nc"><i class="no-highlight">1954</i>&nbsp;        if(this.client.getUserInteraction().getGame().getGameType().equals(GameType.MULTIPLAYER)){</b>
<b class="nc"><i class="no-highlight">1955</i>&nbsp;            if(myPlayer().equals(players.get(0)))</b>
<b class="nc"><i class="no-highlight">1956</i>&nbsp;                notMyPlayer=players.get(1);</b>
<i class="no-highlight">1957</i>&nbsp;            else
<b class="nc"><i class="no-highlight">1958</i>&nbsp;                notMyPlayer=players.get(0);</b>
<i class="no-highlight">1959</i>&nbsp;        }
<i class="no-highlight">1960</i>&nbsp;
<b class="nc"><i class="no-highlight">1961</i>&nbsp;            for(int i=0;i&lt;players.size();i++){</b>
<b class="nc"><i class="no-highlight">1962</i>&nbsp;            if(this.client.getUserInteraction().getGame().getGameType().equals(GameType.MULTIPLAYER)){</b>
<b class="nc"><i class="no-highlight">1963</i>&nbsp;                if(players.get(i).equals(player)){</b>
<b class="nc"><i class="no-highlight">1964</i>&nbsp;                    resourceImages[i]=getImage(myPlayer());</b>
<i class="no-highlight">1965</i>&nbsp;                }else
<b class="nc"><i class="no-highlight">1966</i>&nbsp;                    resourceImages[i]=getImage(notMyPlayer);</b>
<i class="no-highlight">1967</i>&nbsp;            }else
<b class="nc"><i class="no-highlight">1968</i>&nbsp;                resourceImages[i]=getImage(players.get(i));</b>
<i class="no-highlight">1969</i>&nbsp;
<b class="nc"><i class="no-highlight">1970</i>&nbsp;            faithColumn[i]=faithColumn(players.get(i).getFaithTrackPosition());</b>
<b class="nc"><i class="no-highlight">1971</i>&nbsp;            faithRow[i]=faithRow(players.get(i).getFaithTrackPosition());</b>
<i class="no-highlight">1972</i>&nbsp;            }
<b class="nc"><i class="no-highlight">1973</i>&nbsp;        popeImages[0] = getImage(player.getPopeTiles()[0].getPopeTile(),2);</b>
<b class="nc"><i class="no-highlight">1974</i>&nbsp;        popeImages[1] = getImage(player.getPopeTiles()[1].getPopeTile(),3);</b>
<b class="nc"><i class="no-highlight">1975</i>&nbsp;        popeImages[2] = getImage(player.getPopeTiles()[2].getPopeTile(),4);</b>
<i class="no-highlight">1976</i>&nbsp;
<b class="nc"><i class="no-highlight">1977</i>&nbsp;        faithData[0] = resourceImages;</b>
<b class="nc"><i class="no-highlight">1978</i>&nbsp;        faithData[1] = faithRow;</b>
<b class="nc"><i class="no-highlight">1979</i>&nbsp;        faithData[2] = faithColumn;</b>
<b class="nc"><i class="no-highlight">1980</i>&nbsp;        faithData[3] = popeImages;</b>
<i class="no-highlight">1981</i>&nbsp;
<b class="nc"><i class="no-highlight">1982</i>&nbsp;        return faithData;</b>
<i class="no-highlight">1983</i>&nbsp;    }
<i class="no-highlight">1984</i>&nbsp;
<i class="no-highlight">1985</i>&nbsp;    /**
<i class="no-highlight">1986</i>&nbsp;     * Sets the faith data and information onto the grid for it to be shown.
<i class="no-highlight">1987</i>&nbsp;     * Each user is set to a corner of the grid so that up to 4 can be displayed
<i class="no-highlight">1988</i>&nbsp;     * @param faithData getFaithData()
<i class="no-highlight">1989</i>&nbsp;     */
<i class="no-highlight">1990</i>&nbsp;    protected void setFaithData(Object[] faithData){
<b class="nc"><i class="no-highlight">1991</i>&nbsp;        ArrayList&lt;Player&gt; players = this.client.getUserInteraction().getGame().getPlayers();</b>
<i class="no-highlight">1992</i>&nbsp;
<i class="no-highlight">1993</i>&nbsp;        Image[] resourceImages;
<b class="nc"><i class="no-highlight">1994</i>&nbsp;        resourceImages = (Image[]) faithData[0];</b>
<i class="no-highlight">1995</i>&nbsp;        int[] faithRow;
<b class="nc"><i class="no-highlight">1996</i>&nbsp;        faithRow = (int[]) faithData[1];</b>
<i class="no-highlight">1997</i>&nbsp;        int[] faithColumn;
<b class="nc"><i class="no-highlight">1998</i>&nbsp;        faithColumn = (int[]) faithData[2];</b>
<i class="no-highlight">1999</i>&nbsp;        Image[] popeImages;
<b class="nc"><i class="no-highlight">2000</i>&nbsp;        popeImages = (Image[]) faithData[3];</b>
<i class="no-highlight">2001</i>&nbsp;
<b class="nc"><i class="no-highlight">2002</i>&nbsp;        pope2.setImage(popeImages[0]);pope2.setFitHeight(80);pope2.setFitWidth(80);</b>
<b class="nc"><i class="no-highlight">2003</i>&nbsp;        pope3.setImage(popeImages[1]);pope3.setFitHeight(80);pope3.setFitWidth(80);</b>
<b class="nc"><i class="no-highlight">2004</i>&nbsp;        pope4.setImage(popeImages[2]);pope4.setFitHeight(80);pope4.setFitWidth(80);</b>
<i class="no-highlight">2005</i>&nbsp;
<b class="nc"><i class="no-highlight">2006</i>&nbsp;        faithPane.getChildren().clear();</b>
<b class="nc"><i class="no-highlight">2007</i>&nbsp;        for(int i=0;i&lt;players.size();i++){</b>
<b class="nc"><i class="no-highlight">2008</i>&nbsp;            ImageView faithImage = new ImageView();</b>
<b class="nc"><i class="no-highlight">2009</i>&nbsp;            faithImage.setImage(resourceImages[i]);</b>
<b class="nc"><i class="no-highlight">2010</i>&nbsp;            faithImage.setFitHeight(38);</b>
<b class="nc"><i class="no-highlight">2011</i>&nbsp;            faithImage.setFitWidth(30);</b>
<b class="nc"><i class="no-highlight">2012</i>&nbsp;            faithPane.add(faithImage,faithColumn[i],faithRow[i]);</b>
<b class="nc"><i class="no-highlight">2013</i>&nbsp;            if(i==0){</b>
<b class="nc"><i class="no-highlight">2014</i>&nbsp;                GridPane.setHalignment(faithImage, HPos.LEFT);</b>
<b class="nc"><i class="no-highlight">2015</i>&nbsp;                GridPane.setValignment(faithImage, VPos.TOP);</b>
<b class="nc"><i class="no-highlight">2016</i>&nbsp;            }else if(i==1){</b>
<b class="nc"><i class="no-highlight">2017</i>&nbsp;                GridPane.setHalignment(faithImage, HPos.RIGHT);</b>
<b class="nc"><i class="no-highlight">2018</i>&nbsp;                GridPane.setValignment(faithImage, VPos.BOTTOM);</b>
<b class="nc"><i class="no-highlight">2019</i>&nbsp;            }else if(i==2){</b>
<b class="nc"><i class="no-highlight">2020</i>&nbsp;                GridPane.setHalignment(faithImage, HPos.LEFT);</b>
<b class="nc"><i class="no-highlight">2021</i>&nbsp;                GridPane.setValignment(faithImage, VPos.BOTTOM);</b>
<b class="nc"><i class="no-highlight">2022</i>&nbsp;            }else if(i==3){</b>
<b class="nc"><i class="no-highlight">2023</i>&nbsp;                GridPane.setHalignment(faithImage, HPos.RIGHT);</b>
<b class="nc"><i class="no-highlight">2024</i>&nbsp;                GridPane.setValignment(faithImage, VPos.TOP);</b>
<i class="no-highlight">2025</i>&nbsp;            }
<i class="no-highlight">2026</i>&nbsp;        }
<i class="no-highlight">2027</i>&nbsp;    }
<i class="no-highlight">2028</i>&nbsp;
<i class="no-highlight">2029</i>&nbsp;    /**
<i class="no-highlight">2030</i>&nbsp;     * Gets the resource data for a given Player
<i class="no-highlight">2031</i>&nbsp;     * @param player        The player to get the data from
<i class="no-highlight">2032</i>&nbsp;     * @return              Object[] as described:
<i class="no-highlight">2033</i>&nbsp;     * ? resourceData[0]:   Image[10] with all the resource Image information orderly placed
<i class="no-highlight">2034</i>&nbsp;     *                      [0-5] Warehouse resources, [6-9] LeaderCard resources
<i class="no-highlight">2035</i>&nbsp;     * ? resourceData[1]:   String[4] with the number of resources stored into the Strongbox
<i class="no-highlight">2036</i>&nbsp;     *                      ordered as such: coins,shieds,servants,stoned
<i class="no-highlight">2037</i>&nbsp;     */
<i class="no-highlight">2038</i>&nbsp;    protected Object[] getResourceData(Player player){
<i class="no-highlight">2039</i>&nbsp;        Object[] resourceData;
<b class="nc"><i class="no-highlight">2040</i>&nbsp;        resourceData = new Object[2];</b>
<i class="no-highlight">2041</i>&nbsp;        Image[] resourceImages;
<b class="nc"><i class="no-highlight">2042</i>&nbsp;        resourceImages = new Image[10];</b>
<i class="no-highlight">2043</i>&nbsp;        String[] resourceText;
<b class="nc"><i class="no-highlight">2044</i>&nbsp;        resourceText = new String[4];</b>
<i class="no-highlight">2045</i>&nbsp;
<b class="nc"><i class="no-highlight">2046</i>&nbsp;        RedWarehouseDepot warehouseDepots[] = player.getWarehouse().getWarehouseDepots();</b>
<i class="no-highlight">2047</i>&nbsp;        //Gets the images from the Warehouse of the player
<b class="nc"><i class="no-highlight">2048</i>&nbsp;        if(warehouseDepots[2].isEmpty())</b>
<b class="nc"><i class="no-highlight">2049</i>&nbsp;            resourceImages[0] = null;</b>
<i class="no-highlight">2050</i>&nbsp;        else
<b class="nc"><i class="no-highlight">2051</i>&nbsp;            resourceImages[0]=getImage(warehouseDepots[2].getResourceType());</b>
<b class="nc"><i class="no-highlight">2052</i>&nbsp;        if(warehouseDepots[1].isEmpty()){</b>
<b class="nc"><i class="no-highlight">2053</i>&nbsp;            resourceImages[1]=null;</b>
<b class="nc"><i class="no-highlight">2054</i>&nbsp;            resourceImages[2]=null;</b>
<i class="no-highlight">2055</i>&nbsp;        }else{
<b class="nc"><i class="no-highlight">2056</i>&nbsp;            Image resource = getImage(warehouseDepots[1].getResourceType());</b>
<b class="nc"><i class="no-highlight">2057</i>&nbsp;            resourceImages[1]=resource;</b>
<b class="nc"><i class="no-highlight">2058</i>&nbsp;            if(warehouseDepots[1].getStoredResources()==2)</b>
<b class="nc"><i class="no-highlight">2059</i>&nbsp;                resourceImages[2]=resource;</b>
<i class="no-highlight">2060</i>&nbsp;            else
<b class="nc"><i class="no-highlight">2061</i>&nbsp;                resourceImages[2]=null;</b>
<i class="no-highlight">2062</i>&nbsp;        }
<b class="nc"><i class="no-highlight">2063</i>&nbsp;        if(warehouseDepots[0].isEmpty()){</b>
<b class="nc"><i class="no-highlight">2064</i>&nbsp;            resourceImages[3]=null;</b>
<b class="nc"><i class="no-highlight">2065</i>&nbsp;            resourceImages[4]=null;</b>
<b class="nc"><i class="no-highlight">2066</i>&nbsp;            resourceImages[5]=null;</b>
<i class="no-highlight">2067</i>&nbsp;        }else{
<b class="nc"><i class="no-highlight">2068</i>&nbsp;            Image resource = getImage(warehouseDepots[0].getResourceType());</b>
<b class="nc"><i class="no-highlight">2069</i>&nbsp;            resourceImages[3]=resource;</b>
<b class="nc"><i class="no-highlight">2070</i>&nbsp;            if(warehouseDepots[0].getStoredResources()==2){</b>
<b class="nc"><i class="no-highlight">2071</i>&nbsp;                resourceImages[4]=resource;</b>
<b class="nc"><i class="no-highlight">2072</i>&nbsp;                resourceImages[5]=null;</b>
<i class="no-highlight">2073</i>&nbsp;            }
<b class="nc"><i class="no-highlight">2074</i>&nbsp;            else if(warehouseDepots[0].getStoredResources()==3){</b>
<b class="nc"><i class="no-highlight">2075</i>&nbsp;                resourceImages[4]=resource;</b>
<b class="nc"><i class="no-highlight">2076</i>&nbsp;                resourceImages[5]=resource;</b>
<i class="no-highlight">2077</i>&nbsp;            }
<i class="no-highlight">2078</i>&nbsp;        }
<i class="no-highlight">2079</i>&nbsp;        //Gets the images from the leader card of the player
<b class="nc"><i class="no-highlight">2080</i>&nbsp;        RedWarehouseDepot extraWarehouseDepot = player.getWarehouse().getExtraWarehouseDepot1();</b>
<b class="nc"><i class="no-highlight">2081</i>&nbsp;        if(extraWarehouseDepot.isEmpty()){</b>
<b class="nc"><i class="no-highlight">2082</i>&nbsp;            resourceImages[6]=null;</b>
<b class="nc"><i class="no-highlight">2083</i>&nbsp;            resourceImages[7]=null;</b>
<i class="no-highlight">2084</i>&nbsp;        }else{
<b class="nc"><i class="no-highlight">2085</i>&nbsp;            Image resource = getImage(extraWarehouseDepot.getResourceType());</b>
<b class="nc"><i class="no-highlight">2086</i>&nbsp;            resourceImages[6]=resource;</b>
<b class="nc"><i class="no-highlight">2087</i>&nbsp;            if(extraWarehouseDepot.getStoredResources()==2)</b>
<b class="nc"><i class="no-highlight">2088</i>&nbsp;                resourceImages[7]=resource;</b>
<i class="no-highlight">2089</i>&nbsp;            else
<b class="nc"><i class="no-highlight">2090</i>&nbsp;                resourceImages[7]=null;</b>
<i class="no-highlight">2091</i>&nbsp;        }
<b class="nc"><i class="no-highlight">2092</i>&nbsp;        extraWarehouseDepot = player.getWarehouse().getExtraWarehouseDepot2();</b>
<b class="nc"><i class="no-highlight">2093</i>&nbsp;        if(extraWarehouseDepot.isEmpty()){</b>
<b class="nc"><i class="no-highlight">2094</i>&nbsp;            resourceImages[8]=null;</b>
<b class="nc"><i class="no-highlight">2095</i>&nbsp;            resourceImages[9]=null;</b>
<i class="no-highlight">2096</i>&nbsp;        }else{
<b class="nc"><i class="no-highlight">2097</i>&nbsp;            Image resource = getImage(extraWarehouseDepot.getResourceType());</b>
<b class="nc"><i class="no-highlight">2098</i>&nbsp;            resourceImages[8]=resource;</b>
<b class="nc"><i class="no-highlight">2099</i>&nbsp;            if(extraWarehouseDepot.getStoredResources()==2)</b>
<b class="nc"><i class="no-highlight">2100</i>&nbsp;                resourceImages[9]=resource;</b>
<i class="no-highlight">2101</i>&nbsp;            else
<b class="nc"><i class="no-highlight">2102</i>&nbsp;                resourceImages[9]=null;</b>
<i class="no-highlight">2103</i>&nbsp;        }
<i class="no-highlight">2104</i>&nbsp;
<i class="no-highlight">2105</i>&nbsp;        //Gets the information from the strongbox
<b class="nc"><i class="no-highlight">2106</i>&nbsp;        RedStrongbox strongbox = player.getStrongbox();</b>
<b class="nc"><i class="no-highlight">2107</i>&nbsp;        resourceText[0]=String.valueOf(strongbox.getStoredResources().getResource(ResourceType.COINS));</b>
<b class="nc"><i class="no-highlight">2108</i>&nbsp;        resourceText[1]=String.valueOf(strongbox.getStoredResources().getResource(ResourceType.SHIELDS));</b>
<b class="nc"><i class="no-highlight">2109</i>&nbsp;        resourceText[2]=String.valueOf(strongbox.getStoredResources().getResource(ResourceType.SERVANTS));</b>
<b class="nc"><i class="no-highlight">2110</i>&nbsp;        resourceText[3]=String.valueOf(strongbox.getStoredResources().getResource(ResourceType.STONES));</b>
<i class="no-highlight">2111</i>&nbsp;
<b class="nc"><i class="no-highlight">2112</i>&nbsp;        resourceData[0]=resourceImages;</b>
<b class="nc"><i class="no-highlight">2113</i>&nbsp;        resourceData[1]=resourceText;</b>
<b class="nc"><i class="no-highlight">2114</i>&nbsp;        return resourceData;</b>
<i class="no-highlight">2115</i>&nbsp;    }
<i class="no-highlight">2116</i>&nbsp;
<i class="no-highlight">2117</i>&nbsp;    /**
<i class="no-highlight">2118</i>&nbsp;     * Sets the resourceData onto a Board
<i class="no-highlight">2119</i>&nbsp;     * @param resourceData  Object[] from getResourceData
<i class="no-highlight">2120</i>&nbsp;     */
<i class="no-highlight">2121</i>&nbsp;    protected void setResourceData(Object[] resourceData){
<i class="no-highlight">2122</i>&nbsp;                Image[] resourceImage;
<b class="nc"><i class="no-highlight">2123</i>&nbsp;                resourceImage=(Image[]) resourceData[0];</b>
<b class="nc"><i class="no-highlight">2124</i>&nbsp;                warehouse1.setImage(resourceImage[0]);</b>
<b class="nc"><i class="no-highlight">2125</i>&nbsp;                warehouse21.setImage(resourceImage[1]);</b>
<b class="nc"><i class="no-highlight">2126</i>&nbsp;                warehouse22.setImage(resourceImage[2]);</b>
<b class="nc"><i class="no-highlight">2127</i>&nbsp;                warehouse31.setImage(resourceImage[3]);</b>
<b class="nc"><i class="no-highlight">2128</i>&nbsp;                warehouse32.setImage(resourceImage[4]);</b>
<b class="nc"><i class="no-highlight">2129</i>&nbsp;                warehouse33.setImage(resourceImage[5]);</b>
<b class="nc"><i class="no-highlight">2130</i>&nbsp;                leader1resource1.setImage(resourceImage[6]);</b>
<b class="nc"><i class="no-highlight">2131</i>&nbsp;                leader1resource2.setImage(resourceImage[7]);</b>
<b class="nc"><i class="no-highlight">2132</i>&nbsp;                leader2resource1.setImage(resourceImage[8]);</b>
<b class="nc"><i class="no-highlight">2133</i>&nbsp;                leader2resource2.setImage(resourceImage[9]);</b>
<i class="no-highlight">2134</i>&nbsp;                String[] resourceText;
<b class="nc"><i class="no-highlight">2135</i>&nbsp;                resourceText=(String[]) resourceData[1];</b>
<b class="nc"><i class="no-highlight">2136</i>&nbsp;                strongboxCoins.setText(resourceText[0]);</b>
<b class="nc"><i class="no-highlight">2137</i>&nbsp;                strongboxShields.setText(resourceText[1]);</b>
<b class="nc"><i class="no-highlight">2138</i>&nbsp;                strongboxServants.setText(resourceText[2]);</b>
<b class="nc"><i class="no-highlight">2139</i>&nbsp;                strongboxStones.setText(resourceText[3]);</b>
<i class="no-highlight">2140</i>&nbsp;    }
<i class="no-highlight">2141</i>&nbsp;
<i class="no-highlight">2142</i>&nbsp;    /**
<i class="no-highlight">2143</i>&nbsp;     * Gets the card data for a given Player
<i class="no-highlight">2144</i>&nbsp;     * @param player        The player to get the cards data from
<i class="no-highlight">2145</i>&nbsp;     * @return              Image[11] as described:
<i class="no-highlight">2146</i>&nbsp;     *                     ? [0-8] The images of the DevelopmentCards
<i class="no-highlight">2147</i>&nbsp;     *                     ? [9-10] The images of the LeaderCards.
<i class="no-highlight">2148</i>&nbsp;     *                      If viewing another Player&#39;s board with the cards not activated
<i class="no-highlight">2149</i>&nbsp;     *                      or if One&#39;s Leader Card have been discarded the back of the card is shown.
<i class="no-highlight">2150</i>&nbsp;     */
<i class="no-highlight">2151</i>&nbsp;    protected Image[] getCardData(Player player){
<i class="no-highlight">2152</i>&nbsp;        Image[] cardData;
<b class="nc"><i class="no-highlight">2153</i>&nbsp;        cardData = new Image[11];</b>
<i class="no-highlight">2154</i>&nbsp;
<b class="nc"><i class="no-highlight">2155</i>&nbsp;        RedLeaderCard[] leaderCards = player.getLeaderCards();</b>
<i class="no-highlight">2156</i>&nbsp;
<i class="no-highlight">2157</i>&nbsp;        //Show back of unactivated LeaderCards if looking another player&#39;s board
<b class="nc"><i class="no-highlight">2158</i>&nbsp;        if(this.client.getUserInteraction().getGame().getMyPlayer().equals(player))</b>
<i class="no-highlight">2159</i>&nbsp;        {
<b class="nc"><i class="no-highlight">2160</i>&nbsp;            cardData[9] = getImage(leaderCards[0].getCardId(),!leaderCards[0].isDiscarded());</b>
<b class="nc"><i class="no-highlight">2161</i>&nbsp;            cardData[10] = getImage(leaderCards[1].getCardId(),!leaderCards[1].isDiscarded());</b>
<i class="no-highlight">2162</i>&nbsp;        }else
<i class="no-highlight">2163</i>&nbsp;        {
<b class="nc"><i class="no-highlight">2164</i>&nbsp;            cardData[9] = getImage(leaderCards[0].getCardId(),leaderCards[0].isActive());</b>
<b class="nc"><i class="no-highlight">2165</i>&nbsp;            cardData[10] = getImage(leaderCards[1].getCardId(),leaderCards[1].isActive());</b>
<i class="no-highlight">2166</i>&nbsp;        }
<i class="no-highlight">2167</i>&nbsp;
<b class="nc"><i class="no-highlight">2168</i>&nbsp;        RedDevelopmentCardSlots developmentCardSlots = player.getSlots();</b>
<b class="nc"><i class="no-highlight">2169</i>&nbsp;        RedCardSlot[] cardSlots = developmentCardSlots.getSlots();</b>
<i class="no-highlight">2170</i>&nbsp;
<b class="nc"><i class="no-highlight">2171</i>&nbsp;        int[] cardId = new int[9];</b>
<i class="no-highlight">2172</i>&nbsp;
<b class="nc"><i class="no-highlight">2173</i>&nbsp;        int cardIndex=0;</b>
<b class="nc"><i class="no-highlight">2174</i>&nbsp;        for(int i=0;i&lt;3;i++)</b>
<i class="no-highlight">2175</i>&nbsp;        {
<b class="nc"><i class="no-highlight">2176</i>&nbsp;            if(cardSlots[i].getLevelOccupied()==0)</b>
<i class="no-highlight">2177</i>&nbsp;            {
<b class="nc"><i class="no-highlight">2178</i>&nbsp;                cardId[cardIndex]=-1;</b>
<b class="nc"><i class="no-highlight">2179</i>&nbsp;                cardIndex++;</b>
<b class="nc"><i class="no-highlight">2180</i>&nbsp;                cardId[cardIndex]=-1;</b>
<b class="nc"><i class="no-highlight">2181</i>&nbsp;                cardIndex++;</b>
<b class="nc"><i class="no-highlight">2182</i>&nbsp;                cardId[cardIndex]=-1;</b>
<b class="nc"><i class="no-highlight">2183</i>&nbsp;                cardIndex++;</b>
<b class="nc"><i class="no-highlight">2184</i>&nbsp;            }else if (cardSlots[i].getLevelOccupied()==1){</b>
<b class="nc"><i class="no-highlight">2185</i>&nbsp;                cardId[cardIndex]=cardSlots[i].getDevelopmentCards()[0].getCardId();</b>
<b class="nc"><i class="no-highlight">2186</i>&nbsp;                cardIndex++;</b>
<b class="nc"><i class="no-highlight">2187</i>&nbsp;                cardId[cardIndex]=-1;</b>
<b class="nc"><i class="no-highlight">2188</i>&nbsp;                cardIndex++;</b>
<b class="nc"><i class="no-highlight">2189</i>&nbsp;                cardId[cardIndex]=-1;</b>
<b class="nc"><i class="no-highlight">2190</i>&nbsp;                cardIndex++;</b>
<b class="nc"><i class="no-highlight">2191</i>&nbsp;            }else if (cardSlots[i].getLevelOccupied()==2){</b>
<b class="nc"><i class="no-highlight">2192</i>&nbsp;                cardId[cardIndex]=cardSlots[i].getDevelopmentCards()[0].getCardId();</b>
<b class="nc"><i class="no-highlight">2193</i>&nbsp;                cardIndex++;</b>
<b class="nc"><i class="no-highlight">2194</i>&nbsp;                cardId[cardIndex]=cardSlots[i].getDevelopmentCards()[1].getCardId();</b>
<b class="nc"><i class="no-highlight">2195</i>&nbsp;                cardIndex++;</b>
<b class="nc"><i class="no-highlight">2196</i>&nbsp;                cardId[cardIndex]=-1;</b>
<b class="nc"><i class="no-highlight">2197</i>&nbsp;                cardIndex++;</b>
<b class="nc"><i class="no-highlight">2198</i>&nbsp;            }else if (cardSlots[i].getLevelOccupied()==3){</b>
<b class="nc"><i class="no-highlight">2199</i>&nbsp;                cardId[cardIndex]=cardSlots[i].getDevelopmentCards()[0].getCardId();</b>
<b class="nc"><i class="no-highlight">2200</i>&nbsp;                cardIndex++;</b>
<b class="nc"><i class="no-highlight">2201</i>&nbsp;                cardId[cardIndex]=cardSlots[i].getDevelopmentCards()[1].getCardId();</b>
<b class="nc"><i class="no-highlight">2202</i>&nbsp;                cardIndex++;</b>
<b class="nc"><i class="no-highlight">2203</i>&nbsp;                cardId[cardIndex]=cardSlots[i].getDevelopmentCards()[2].getCardId();</b>
<b class="nc"><i class="no-highlight">2204</i>&nbsp;                cardIndex++;</b>
<i class="no-highlight">2205</i>&nbsp;            }
<i class="no-highlight">2206</i>&nbsp;        }
<i class="no-highlight">2207</i>&nbsp;
<b class="nc"><i class="no-highlight">2208</i>&nbsp;        for(int i=0;i&lt;9;i++)</b>
<i class="no-highlight">2209</i>&nbsp;        {
<b class="nc"><i class="no-highlight">2210</i>&nbsp;            if(cardId[i]==-1)</b>
<b class="nc"><i class="no-highlight">2211</i>&nbsp;                cardData[i]=null;</b>
<i class="no-highlight">2212</i>&nbsp;            else
<b class="nc"><i class="no-highlight">2213</i>&nbsp;                cardData[i]=getImage(cardId[i],true);</b>
<i class="no-highlight">2214</i>&nbsp;        }
<i class="no-highlight">2215</i>&nbsp;
<b class="nc"><i class="no-highlight">2216</i>&nbsp;        return cardData;</b>
<i class="no-highlight">2217</i>&nbsp;    }
<i class="no-highlight">2218</i>&nbsp;
<i class="no-highlight">2219</i>&nbsp;    /**
<i class="no-highlight">2220</i>&nbsp;     * Method used for setting the card data onto One&#39;s board.
<i class="no-highlight">2221</i>&nbsp;     * @param cardData  The Image[] from getCardData
<i class="no-highlight">2222</i>&nbsp;     */
<i class="no-highlight">2223</i>&nbsp;    protected void setCardData(Image[] cardData){
<b class="nc"><i class="no-highlight">2224</i>&nbsp;        dev11.setImage(cardData[0]);</b>
<b class="nc"><i class="no-highlight">2225</i>&nbsp;        dev12.setImage(cardData[1]);</b>
<b class="nc"><i class="no-highlight">2226</i>&nbsp;        dev13.setImage(cardData[2]);</b>
<b class="nc"><i class="no-highlight">2227</i>&nbsp;        dev21.setImage(cardData[3]);</b>
<b class="nc"><i class="no-highlight">2228</i>&nbsp;        dev22.setImage(cardData[4]);</b>
<b class="nc"><i class="no-highlight">2229</i>&nbsp;        dev23.setImage(cardData[5]);</b>
<b class="nc"><i class="no-highlight">2230</i>&nbsp;        dev31.setImage(cardData[6]);</b>
<b class="nc"><i class="no-highlight">2231</i>&nbsp;        dev32.setImage(cardData[7]);</b>
<b class="nc"><i class="no-highlight">2232</i>&nbsp;        dev33.setImage(cardData[8]);</b>
<b class="nc"><i class="no-highlight">2233</i>&nbsp;        leader1.setImage(cardData[9]);</b>
<b class="nc"><i class="no-highlight">2234</i>&nbsp;        leader2.setImage(cardData[10]);</b>
<i class="no-highlight">2235</i>&nbsp;    }
<i class="no-highlight">2236</i>&nbsp;
<i class="no-highlight">2237</i>&nbsp;}
</div>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
        var codeBlock = document.getElementById('sourceCode');

        if (codeBlock) {
            hljs.highlightBlock(codeBlock);
        }
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2021-07-02 23:15</div>
</div>
</body>
</html>
